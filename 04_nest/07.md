<h1>Projeto 02 - Blog Pessoal - Classes PostagemController e PostagemService - M√©todo Consultar todas as Postagens</h1>



O que veremos por aqui:

1. Criar a Classe PostagemService
2. Criar a Classe PostagemController
3. Criar o m√©todo findAll() para listar todas as Postagens
4. Registrar as 2 Classes no M√≥dulo PostagemModule
5. Registrar o M√≥dulo PostagemModule no M√≥dulo APPModule
6. Testar o M√©todo findAll() no Insomnia

<br />

<h2>1. O M√≥dulo Postagem</h2>



Na etapa anterior, come√ßamos a construir o **M√≥dulo Postagem**, a partir da **Classe Entidade (Model) Postagem**, onde implementamos todos os atributos do recurso Postagem e geramos a tabela **tb_postagens** dentro do nosso Banco de dados **db_blogpessoal**. Agora vamos come√ßar a criar os M√©todos do CRUD do recurso Postagem, listados no Diagrama de Classes abaixo, nas Classes **PostagemService** e **PostagemController**.

<div align="center"><img src="https://i.imgur.com/vmCMVTX.png" title="source: imgur.com" width="75%"/></div>

Ser√£o implementados 6 M√©todos: 

- 3 M√©todos de Busca (GET)
- 1 M√©todo de Persist√™ncia dos Objetos no Banco de dados (POST)
- 1 M√©todo de Atualiza√ß√£o dos Objetos persistidos no Banco de dados (PUT)
- 1 M√©todo para apagar Objetos persistidos no Banco de dados (DELETE)

A Classe **PostagemService** ser√° respons√°vel pelas regras de neg√≥cio e manipula√ß√£o de dados, como persistir, atualizar, buscar e deletar postagens. Ela se comunica diretamente com o banco de dados, utilizando o reposit√≥rio da entidade **Postagem**.

> **Regras de neg√≥cio:** O termo "regras de neg√≥cio" refere-se √†s **diretrizes que determinam ou restringem as a√ß√µes dentro de uma aplica√ß√£o, especificando como os m√©todos devem operar, o que deve ser validado em cada um deles e quais s√£o os limites da aplica√ß√£o**. Essas regras s√£o fundamentais para que a pessoa desenvolvedora tenha uma vis√£o clara do que deve ser feito, como implementar, e qual a raz√£o de cada a√ß√£o.

A Classe **PostagemController** √© respons√°vel por receber as requisi√ß√µes HTTP, chamar os m√©todos da **PostagemService**, e retornar as respostas HTTP apropriadas. Ela manipula os dados recebidos e encaminha para o servi√ßo realizar o processamento.

Os m√©todos do **CRUD** ser√£o implementados em ambas as classes, com os mesmos nomes, mas com responsabilidades distintas.

<br />

<h2>üë£ Passo 01 - Criar a Classe PostagemService</h2>



Vamos criar a pasta **services**, dentro do nosso **M√≥dulo Postagem** (pasta postagem):

1. Na pasta **postagem**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/uCdfiD7.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **services**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/Yv9yU9I.png?1" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a pasta services. Um erro muito comum √© criar a pasta services fora da pasta da pasta postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Na sequ√™ncia, vamos criar a Classe de Servi√ßo **PostagemService** que chamaremos de **postagem.service.ts**

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe de Servi√ßo. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest (nome_do_modulo.tipo_da_classe.ts) para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

1. Clique com o bot√£o direito do mouse sobre a **pasta services**, que foi criada dentro da pasta **postagem**, como mostra a figura abaixo, e na sequ√™ncia clique na op√ß√£o **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/4ih83IQ.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **postagem.service.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/pAlQSeP.png?1" title="source: imgur.com" /></div>

Agora vamos come√ßar a criar o c√≥digo da Classe **PostagemService**, como mostra a figura abaixo. Como iremos construir 6 M√©todos dentro da Classe de Servi√ßo, vamos construir por partes. Aqui construiremos apenas o primeiro M√©todo (**findAll()**), que tem como objetivo listar todas as Postagens persistidas no Banco de dados.

<div align="left"><img src="https://i.imgur.com/7XE7kiZ.png" title="source: imgur.com" /></div>

**Vamos analisar o c√≥digo:**

**Linha 1:** Importamos o pacote **Common** com os respectivos **decoradores**, utilizados na implementa√ß√£o da classe `PostagemService`.

**Linha 2:** Importamos o pacote **TypeORM** com os respectivos **decoradores**, utilizados na implementa√ß√£o da classe `PostagemService`.

**Linha 3:** Importamos a classe **Repository** do m√≥dulo **typeorm**.

> A classe **Repository** no **TypeORM** implementa o **Repository Pattern** (Padr√£o de Reposit√≥rio), que √© um padr√£o arquitetural amplamente utilizado no desenvolvimento de aplicativos escal√°veis e de f√°cil manuten√ß√£o. Este padr√£o tem como objetivo separar a l√≥gica de neg√≥cios da l√≥gica de acesso a dados, fornecendo uma camada intermedi√°ria entre o banco de dados e o restante da aplica√ß√£o.
>
> ### O que √© o Repository Pattern?
>
> O **Repository Pattern** √© um padr√£o de design de software que facilita a abstra√ß√£o da persist√™ncia de dados. Ele atua como uma cole√ß√£o de objetos em mem√≥ria, oferecendo m√©todos de acesso a dados (como `find`, `save`, `update`, `delete`), sem que a aplica√ß√£o precise se preocupar com os detalhes espec√≠ficos da implementa√ß√£o da base de dados, como as consultas SQL ou a configura√ß√£o de conex√µes.

**Linha 4:** Importamos a classe entidade **Postagem**, do m√≥dulo **Postagem**.

**Linha 6:** O decorador **@Injectable** indica que a classe √© um servi√ßo, ou seja, uma classe que pode ser injetada em outras classes por meio da **Inje√ß√£o de Depend√™ncias**.

> **Inje√ß√£o de depend√™ncia** √© um padr√£o de design que visa reduzir o **acoplamento** entre as classes em um sistema. Em vez de uma classe depender diretamente de outra classe concreta (ou seja, de uma implementa√ß√£o espec√≠fica), a inje√ß√£o de depend√™ncia permite que as classes dependam de abstra√ß√µes (interfaces ou classes abstratas), tornando o c√≥digo mais flex√≠vel, modular e de f√°cil manuten√ß√£o.
>
> Esse padr√£o permite que as depend√™ncias de uma classe (ou seja, os objetos de que ela precisa para funcionar) sejam fornecidas externamente, geralmente por um **container de inje√ß√£o de depend√™ncia** ou framework, ao inv√©s de serem criadas diretamente dentro da pr√≥pria classe.
>
> Por exemplo, se uma classe `A` depende de uma classe `B`, com a inje√ß√£o de depend√™ncia, a classe `A` n√£o cria uma inst√¢ncia de `B` diretamente. Em vez disso, um mecanismo externo (como um framework ou container) fornece uma inst√¢ncia de `B` para `A` no momento da execu√ß√£o.

**Linha 8:** Criamos o **construtor**, que recebe as **inje√ß√µes de depend√™ncia** necess√°rias para o desenvolvimento da classe de servi√ßo.

**Linha 9:** O decorador **@InjectRepository(Postagem)** indica a classe entidade que ser√° utilizada pela inje√ß√£o de depend√™ncia da classe `Repository`. No caso de `PostagemService`, o decorador informa ao Nest que o objeto `postagemRepository` (inje√ß√£o de depend√™ncia) est√° associado √† entidade `Postagem`.

> ### **Invers√£o de Controle (IoC)**
>
> A **Invers√£o de Controle (IoC)** √© um princ√≠pio de design que altera a sequ√™ncia tradicional de controle em um sistema. Em um sistema comum, o programador determina a ordem das chamadas de m√©todos ou a cria√ß√£o de objetos. Com a IoC, a responsabilidade de gerenciar as inst√¢ncias de objetos e a execu√ß√£o dos m√©todos √© delegada a um componente externo, geralmente chamado de **container de IoC**.
>
> Em outras palavras, **IoC** inverte o controle de fluxo, ou seja, em vez de o programador controlar explicitamente as depend√™ncias e a execu√ß√£o do c√≥digo, essa responsabilidade √© transferida para o framework ou container, permitindo uma maior flexibilidade e desacoplamento entre as classes.
>
> ### **IoC no NestJS**
>
> No *NestJS*, a **Invers√£o de Controle** √© implementada por meio da **inje√ß√£o de depend√™ncia (DI)**. Nesse modelo, as depend√™ncias de uma classe n√£o s√£o criadas diretamente dentro dela. Ao inv√©s disso, elas s√£o fornecidas pelo **container de depend√™ncias** do NestJS.
>
> #### Como funciona?
>
> Quando voc√™ cria um servi√ßo, por exemplo, o NestJS automaticamente cuida da inje√ß√£o de suas depend√™ncias (como outros servi√ßos ou reposit√≥rios). Atrav√©s do decorador `@Injectable()`, o Nest sabe quais classes devem ser injetadas em outras, sem que o desenvolvedor precise se preocupar em instanci√°-las manualmente.
>
> ### **Invers√£o de Depend√™ncia (DIP)**
>
> A **Invers√£o de Depend√™ncia** (Dependency Inversion Principle - DIP) √© um dos princ√≠pios do padr√£o **SOLID** e est√° intimamente relacionado √† **Invers√£o de Controle**.
>
> O DIP tem como objetivos principais:
>
> 1. **M√≥dulos de alto n√≠vel n√£o devem depender de m√≥dulos de baixo n√≠vel**. Ambos devem depender de abstra√ß√µes.
> 2. **Abstra√ß√µes n√£o devem depender de detalhes**. Detalhes devem depender de abstra√ß√µes.
>
> No contexto de IoC e DI, isso significa que classes de alto n√≠vel (como servi√ßos) n√£o devem depender diretamente de classes de baixo n√≠vel (como reposit√≥rios ou implementa√ß√µes espec√≠ficas). Em vez disso, elas devem depender de interfaces ou abstra√ß√µes, o que permite que as implementa√ß√µes possam ser trocadas de forma mais f√°cil e sem afetar o restante do sistema.

A principal vantagem de usar a *inje√ß√£o de depend√™ncia* √© que voc√™ consegue acessar objetos sem precisar cri√°-los manualmente, como se fazia na programa√ß√£o orientada a objetos tradicional.

> A classe **Repository** do *TypeORM* facilita a intera√ß√£o com o banco de dados, oferecendo m√©todos pr√©-implementados para manipula√ß√£o de dados de uma entidade, como salvar, deletar, consultar e atualizar registros de uma tabela.
>
> Outra vantagem da classe `Repository` √© que seus m√©todos de consulta permitem criar qualquer consulta SQL necess√°ria de forma simples e r√°pida, sem escrever SQL diretamente.

**Linha 10:** Definimos o nome do objeto da classe **Repository** (**postagemRepository**), que ser√° respons√°vel por executar os m√©todos da classe `Repository` relacionados √† entidade `Postagem`.

Observe que, ao criar a inje√ß√£o de depend√™ncia `postagemRepository`, estamos passando a classe `Postagem` como tipo gen√©rico da classe `Repository`. Essa pr√°tica implementa os princ√≠pios de invers√£o de controle, conforme demonstrado abaixo:

- A classe `Repository` **depende de abstra√ß√µes**, j√° que, ao inv√©s de estar atrelada a uma implementa√ß√£o espec√≠fica, ela pode manipular qualquer tipo de entidade (`Repository<T>`).
- A classe `Repository` n√£o possui **forte acoplamento** com outras classes, ou seja, n√£o depende diretamente de outras classes para funcionar.
- Os m√©todos da classe `Repository` est√£o implementados para trabalhar com qualquer classe entidade passada como tipo gen√©rico.

**Linha 13:** Criamos o m√©todo ass√≠ncrono (async), chamado **findAll()**, que retorna uma **Promise** contendo um array de objetos da classe `Postagem`. Como o m√©todo `findAll()` lista v√°rias postagens, √© necess√°rio um array para armazen√°-las.

> **Fun√ß√µes ass√≠ncronas** s√£o fun√ß√µes que permitem a execu√ß√£o de tarefas em segundo plano, sem bloquear a execu√ß√£o do restante do c√≥digo. Isso √© extremamente √∫til em opera√ß√µes que podem levar tempo para serem conclu√≠das, como requisi√ß√µes HTTP, leitura de arquivos ou consultas a bancos de dados, onde o tempo de resposta pode ser imprevis√≠vel.
>
> ### **Como Funciona?**
>
> Quando uma fun√ß√£o √© marcada como **ass√≠ncrona** (com a palavra-chave `async`), ela retorna automaticamente uma **Promise**. Isso permite que a execu√ß√£o do c√≥digo continue sem esperar que a fun√ß√£o ass√≠ncrona seja completada, e, quando a tarefa √© conclu√≠da, o resultado da opera√ß√£o √© disponibilizado para o fluxo do programa.

**Linha 14:** O m√©todo **find()**, da classe `postagemRepository`, √© chamado para retornar todos os registros da entidade `Postagem`. Em termos SQL, o m√©todo `find()` sem par√¢metros seria equivalente a:

```sql
SELECT * FROM tb_postagens;
```

> **Promise** √© um Objeto JavaScript/TypeScript utilizado para o **Processamento Ass√≠ncrono**. Na pr√°tica, uma Promise √© uma promessa, que representa um valor que pode estar dispon√≠vel agora, no futuro ou nunca (erro). 
>
> Uma **Promise** √© como um "procurador" para um valor que n√£o √© necessariamente conhecido quando a promessa √© criada. Isso permite a associa√ß√£o de m√©todos de tratamento para eventos da a√ß√£o ass√≠ncrona num caso eventual de sucesso ou de falha. Isto permite que os m√©todos ass√≠ncronos retornem valores como m√©todos s√≠ncronos: ao inv√©s do valor final, o m√©todo ass√≠ncrono retorna uma promessa de que receber√° o valor em algum momento no futuro.
>
> Observe na imagem abaixo, que uma **Promise** possui tr√™s estados:
>
> <div align="center"><img src="https://i.imgur.com/CoxH7Yw.png" title="source: imgur.com" /></div>
>
>   - **pending** (pendente): Estado inicial, que n√£o foi nem resolvida e nem rejeitada.
> - **fulfilled** (resolvida): sucesso na opera√ß√£o.
> - **rejected** (rejeitado):  falha na opera√ß√£o.
>
> Abaixo, vemos como criar uma Promise
>
>   **Sintaxe:**
>
>   ```ts
>   new Promise( ( resolve, reject ) => { } )
>   ```
>
>   - **resolve**: fun√ß√£o, geralmente uma **Arrow Function**, que ser√° utilizada para retornar o resultado da Promise.
>   - **reject**: fun√ß√£o, geralmente uma **Arrow Function**, que ser√° utilizada para para retornar o erro da Promise.
>
> As palavras-chave **async** e **await** representam uma sintaxe alternativa (ou uma forma mais simples de escrever uma *Promise*) criada para simplificar a programa√ß√£o ass√≠ncrona, facilitando tanto a leitura quanto a escrita do c√≥digo. Em outras palavras, **torna poss√≠vel escrever c√≥digo ass√≠ncrono, mas estruturado de maneira s√≠ncrona**, o que facilita o entendimento e a manuten√ß√£o do c√≥digo. O **async/await** tamb√©m opera com c√≥digo baseado em *Promises*, mas abstrai as *promises* de modo que a leitura e a escrita se tornem mais diretas e limpas.
>
> Ao declarar uma fun√ß√£o com a palavra reservada **async**, podemos utilizar a palavra-chave **await** antes de qualquer fun√ß√£o que retorne uma *Promise*. Isso faz com que a execu√ß√£o da fun√ß√£o ass√≠ncrona seja pausada at√© que a *Promise* seja resolvida.
>
> A palavra-chave **await** aguarda a execu√ß√£o de uma *Promise* e a converte em um valor de retorno (ou lan√ßa uma exce√ß√£o em caso de erro). Quando utilizamos **await**, o TypeScript/JavaScript pausa a execu√ß√£o da fun√ß√£o at√© que a *Promise* seja conclu√≠da. Se a *Promise* for resolvida com sucesso (o termo utilizado √© *fulfilled*), o valor resultante √© retornado. Caso a *Promise* seja rejeitada (o termo utilizado √© *rejected*), o erro gerado √© lan√ßado como exce√ß√£o.

Na pr√°tica, isso significa que uma requisi√ß√£o HTTP √© processada em segundo plano, enquanto a aplica√ß√£o continua funcionando normalmente, sem interromper o Backend. Assim que o processamento da requisi√ß√£o √© conclu√≠do, o Nest envia uma resposta HTTP com o status correspondente, indicando o sucesso ou a falha da opera√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/techniques/database" target="_blank"><b>Documenta√ß√£o: <i>Interface Reposit√≥rio</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="4%"/> <a href="https://typeorm.io/working-with-repository" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - Reposit√≥rios</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="4%"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Statements/async_function" target="_blank"><b>Documenta√ß√£o: Fun√ß√µes Ass√≠ncronas</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/04_Listar_Postagens/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemService</b></a></div>


<br />

<h2>üë£ Passo 02 - Criar a Classe PostagemController</h2>



Vamos criar a pasta **controllers**, dentro do nosso **M√≥dulo Postagem** (pasta postagem):

1. Na pasta **postagem**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/xNQlpAd.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **controllers**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/i9iN8Rh.png?1" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a pasta controllers. Um erro muito comum √© criar a pasta controllers fora da pasta postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Na sequ√™ncia, vamos criar a Classe Controladora **PostagemController** que chamaremos de **postagem.controller.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe de Servi√ßo. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest (nome_do_modulo.tipo_da_classe.ts) para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

1. Clique com o bot√£o direito do mouse sobre a **pasta controllers**, que foi criada dentro da pasta **postagem**, como mostra a figura abaixo, e clique na op√ß√£o **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/bvtqoYT.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **postagem.controller.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/HaoDWSZ.png?1" title="source: imgur.com" /></div>

Agora vamos come√ßar a criar o c√≥digo da Classe **PostagemController**, como mostra a figura abaixo. Como iremos construir 6 M√©todos dentro da Classe Controladora, vamos construir por partes. Aqui construiremos apenas o primeiro M√©todo, o **findAll()**, que tem como objetivo executar o M√©todo com o mesmo nome na **Classe PostagemService**.

<div align="left"><img src="https://i.imgur.com/WG0tKT3.png" title="source: imgur.com" /></div>

**Vamos analisar o c√≥digo:**

**Linha 1:** Importamos o pacote **Common** com os respectivos **decoradores**, que ser√£o utilizados na implementa√ß√£o da Classe **PostagemController**.

**Linha 2:** Importamos a Classe **Postagem**, do m√≥dulo **Postagem**.

**Linha 3:** Importamos a Classe **PostagemService**, que √© respons√°vel pela l√≥gica de neg√≥cio relacionada √† Postagem.

**Linha 5:** O decorador **@Controller** indica que a classe √© um **RestController**, ou seja, ela ser√° respons√°vel por receber e processar as requisi√ß√µes HTTP relacionadas ao recurso **Postagem**.

A **Classe Controladora** desempenha o papel de gerenciar as requisi√ß√µes e respostas, dividindo a l√≥gica de manipula√ß√£o de dados e a de controle de fluxo entre as camadas de **Servi√ßo** e a camada de **Requisi√ß√£o HTTP**.

### **A Classe Controladora ser√° respons√°vel por:**

- **Receber a requisi√ß√£o HTTP**:
  - **URL (Endpoint)**: Define o caminho da requisi√ß√£o (neste caso, "/postagens").
  - **Verbo HTTP (GET, POST, PUT, DELETE)**: Indica a opera√ß√£o desejada (neste caso, GET).
  - **Request Body**: Para requisi√ß√µes POST e PUT, o corpo da requisi√ß√£o cont√©m os dados a serem manipulados ou persistidos (neste caso, vazio, porque se trata de uma consulta - GET).
- **Responder √† requisi√ß√£o HTTP**:
  - **C√≥digo de Status HTTP**: Indica se a opera√ß√£o foi bem-sucedida (Exemplos: 200 para sucesso, 201 para cria√ß√£o, 404 para n√£o encontrado, entre outros).
  - **Response Body**: Cont√©m o resultado do processamento (por exemplo, os dados retornados ou uma mensagem de sucesso/erro).

O par√¢metro inserido dentro dos par√™nteses do decorador **@Controller** define o caminho do recurso **Postagem**. Ou seja, todas as requisi√ß√µes enviadas para o caminho **/postagens** ser√£o direcionadas para a classe controladora **PostagemController**. Ao acessar a URL do servidor seguida de `/postagens` (por exemplo, `http://localhost:4000/postagens`), a classe controladora ir√° processar a requisi√ß√£o com base no m√©todo HTTP (GET, POST, PUT ou DELETE) e os par√¢metros inseridos na URL.

Essa abordagem permite centralizar o gerenciamento das rotas e facilitar a organiza√ß√£o do c√≥digo, separando as responsabilidades da manipula√ß√£o dos dados e o controle da intera√ß√£o com o cliente (frontend ou outros servi√ßos).

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao configurar a URL do M√≥dulo. Observe que configuramos a URL (/postagens) iniciando com uma barra, com letras min√∫sculas, usando o mesmo nome do m√≥dulo no plural, sem acentos, caracteres especiais e espa√ßos em branco. Lembre-se que todos os endere√ßos na WEB seguem este padr√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 7:** O **Construtor** √© criado para receber as **Inje√ß√µes de Depend√™ncia** necess√°rias para o funcionamento da classe controladora. Neste caso, a **Classe PostagemService** √© injetada no construtor da classe **PostagemController**. Com isso, podemos acessar todos os m√©todos e funcionalidades da **PostagemService** dentro da controladora, permitindo que a l√≥gica de neg√≥cios (como a recupera√ß√£o, cria√ß√£o, atualiza√ß√£o e exclus√£o de postagens) seja delegada ao servi√ßo, mantendo a controladora focada apenas em gerenciar as requisi√ß√µes HTTP.

**Linha 9:** O decorador **@Get()** mapeia todas as requisi√ß√µes **HTTP GET** para o m√©todo indicado. Isso significa que, quando uma requisi√ß√£o **GET** for feita para o **endpoint** `http://localhost:4000/postagens/`, o m√©todo **findAll()** ser√° executado para responder a essa requisi√ß√£o. Esse comportamento √© t√≠pico de m√©todos que buscam ou retornam dados, e, no contexto da aplica√ß√£o, o m√©todo **findAll()** ir√° chamar o m√©todo correspondente na Classe **PostagemService**, para recuperar todas as postagens armazenadas no banco de dados e retorn√°-las como resposta √† requisi√ß√£o.

O uso do decorador **@Get()** facilita a defini√ß√£o das rotas HTTP dentro do controlador, alinhando-se com o padr√£o REST, onde o verbo HTTP GET √© utilizado para recuperar dados do servidor.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo do endpoint ser√° igual ao Endere√ßo do M√≥dulo apenas quando o decorador @Get() n√£o possuir um endere√ßo personalizado, como um par√¢metro por exemplo. Caso existam dois ou mais m√©todos do tipo GET ser√° necess√°rio personalizar o endere√ßo de cada M√©todo decorado com @Get("/<endere√ßo_personalizado>").* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 10:** O decorador **@HttpCode(HttpStatus.OK)** √© utilizado para definir o c√≥digo de status HTTP que ser√° retornado quando a requisi√ß√£o for processada com sucesso. Nesse caso, o status **200 OK** ser√° enviado, indicando que a opera√ß√£o foi realizada com √™xito. Isso √© importante para comunicar ao cliente da API que a requisi√ß√£o foi bem-sucedida. Caso ocorra algum erro durante o processamento (por exemplo, erro no banco de dados ou na execu√ß√£o de alguma l√≥gica de neg√≥cios), o c√≥digo de status ser√° ajustado de acordo com o tipo de erro (como **400 Bad Request**, **404 Not Found**, ou **500 Internal Server Error**).

**Linha 11:** O m√©todo **findAll()** √© um m√©todo ass√≠ncrono que retorna uma **Promise**. Isso significa que ele executa opera√ß√µes que podem levar um tempo para serem conclu√≠das (como acessar o banco de dados), mas n√£o bloqueia a execu√ß√£o do restante do c√≥digo enquanto aguarda a resposta. A **Promise** ser√° resolvida quando a opera√ß√£o de busca das postagens for conclu√≠da, e o resultado ser√° um array contendo todos os objetos da entidade **Postagem** armazenados no banco de dados.

**Linha 12:** O m√©todo **findAll()** da **PostagemService** √© chamado para realizar a busca de todas as postagens no banco de dados. Esse m√©todo ir√° interagir com o reposit√≥rio do **TypeORM** (a partir do **postagemRepository**) para buscar os dados na tabela correspondente, retornar um array de objetos **Postagem** e envi√°-lo de volta para o controlador. A resposta da requisi√ß√£o ser√° preenchida com esse array de postagens, que ser√° convertido para o formato desejado (geralmente JSON) e enviado como parte da resposta HTTP.

Essa estrutura permite que a l√≥gica de acesso aos dados (busca das postagens) seja isolada no servi√ßo, mantendo o controlador focado em lidar com as requisi√ß√µes HTTP.

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Methods Request</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="4%"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documenta√ß√£o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/04_Listar_Postagens/blogpessoal/src/postagem/controllers/postagem.controller.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemController</b></a></div>


<br />

<h2>üë£ Passo 03 - Registrar as Classes PostagemService e PostagemController na Classe PostagemModule</h2>



Na sequ√™ncia, vamos registrar as nossas duas Classes **(PostagemService** e **PostagemController**), no M√≥dulo **PostagemModule**. Este passo √© fundamental para o correto funcionamento da nossa aplica√ß√£o.

1. Abra a Classe **PostagemModule**, localizada na pasta **postagem**, conforme indicada na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/2j3S9em.png?1" title="source: imgur.com" /></div>

2. Implemente as altera√ß√µes, indicadas pelas setas na imagem abaixo:

<div align="left"><img src="https://imgur.com/dunEF67.png" title="source: imgur.com" /></div>

**Vamos analisar as altera√ß√µes no c√≥digo:**

**Linha 3:** Importamos a Classe **PostagemController**, criada anteriormente. 

**Linha 5:** Importamos a Classe **PostagemService**, criada anteriormente. 

**Linha 9:** No array **providers**, adicionamos a **Classe PostagemService** para que ela possa ser utilizada em outras classes dentro do m√≥dulo. Ao adicionar a classe **PostagemService** como um provedor, o NestJS ir√° gerenciar sua inst√¢ncia e permitir a **inje√ß√£o de depend√™ncia**. Isso significa que, sempre que a classe **PostagemService** for necess√°ria, o NestJS ir√° fornecer uma inst√¢ncia j√° configurada dessa classe, permitindo seu uso em outras classes, como o **PostagemController**.

Os **providers** no NestJS s√£o usados para registrar servi√ßos, reposit√≥rios, ou qualquer outra classe que precise ser compartilhada entre diferentes componentes dentro de um m√≥dulo. Nesse caso, o **PostagemService** estar√° dispon√≠vel para qualquer classe do m√≥dulo que precise realizar opera√ß√µes relacionadas √†s postagens.

**Linha 10:** No array **controllers**, adicionamos a **Classe PostagemController**, permitindo que os endpoints definidos dentro dessa classe sejam acess√≠veis para processar as requisi√ß√µes HTTP. O controlador ir√° definir as rotas e mape√°-las para m√©todos espec√≠ficos, como **GET**, **POST**, **PUT** e **DELETE**. Ao adicionar o **PostagemController** no array de **controllers**, estamos fazendo com que o NestJS registre essas rotas, tornando-as acess√≠veis para o cliente que enviar as requisi√ß√µes para o servidor.

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/04_Listar_Postagens/blogpessoal/src/postagem/postagem.module.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemModule</b></a></div>

<br />

<h2>üë£ Passo 04 - Executar o projeto</h2>



1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/JgNkmDv.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/hGAUI1Z.png" title="source: imgur.com" /></div>

4. Observe na imagem acima, na regi√£o destacada em amarelo, que o endpoint do tipo **GET** , apontando para o caminho (rota) **/postagens**, foi disponibilizado (mapeado).

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/04_Listar_Postagens" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br />

<h2>üë£ Passo 05 - Inserir dados no Banco de dados</h2>



Como ainda n√£o criamos um M√©todo para Cadastrar Postagens (criaremos em breve), vamos inserir dois registros diretamente no Banco de Dados **db_blogpessoal**  na Tabela **tb_postagens** para testarmos o nosso M√©todo findAll().

1. Abra o <b>MySQL Workbench</b>.

2. Crie um novo arquivo SQL **(SQLFile)** e digite os comandos abaixo:

   ```sql
   USE db_blogpessoal;
   
   INSERT INTO tb_postagens (data, texto, titulo) 
   VALUES (current_timestamp(), 'Texto da postagem 01', 'Postagem 01');
   INSERT INTO tb_postagens (data, texto, titulo) 
   VALUES (current_timestamp(), 'Texto da postagem 02', 'Postagem 02');
   
   SELECT * FROM tb_postagens;
   ```

3. Selecione todas as linhas e clique no primeiro raio <img src="https://i.imgur.com/xH6Ei9O.png" title="source: imgur.com" /> para inserir os dados na tabela **tb_postagens**.

<div align="center"><img src="https://i.imgur.com/6yEc6tE.png" title="source: imgur.com" /></div>

4. A imagem acima mostra que os dados foram inseridos com sucesso!

<br />

<h2>üë£ Passo 06 - Testar no Insomnia</h2>



Para testar a aplica√ß√£o, utilizaremos o **Insomnia**. 

Para organizar os nossos testes, vamos criar uma **Collection** para guardar todas as nossas **Requisi√ß√µes do Projeto Blog Pessoal**. Na sequ√™ncia vamos criar dentro da Collection uma pasta chamada **Postagem** para guardar todas as requisi√ß√µes do M√≥dulo Postagem. Para concluir, vamos criar uma requisi√ß√£o do tipo **GET**, dentro da pasta Postagem, para testar o nosso M√©todo **findAll()**.

<br />

<h3>7.1. Criando a Collection Blog Pessoal</h3>



1. Na janela principal do **Insomnia**, clique no bot√£o **Create** e clique na op√ß√£o **Request Collection**.

<div align="center"><img src="https://i.imgur.com/NhdF4d0.png" title="source: imgur.com" /></div>

2. Na janela que ser√° aberta, informe o nome da Collection (**Blog Pessoal**) e clique no bot√£o **Create** para concluir. 

<div align="center"><img src="https://i.imgur.com/eYp2qUL.png" title="source: imgur.com" width="80%"/></div>

<br />

<h3>7.2. Criando a  Pasta Postagem</h3>



Vamos criar dentro da **Collection Blog Pessoal**, na **Pasta Postagem**, que guardar√° todas as requisi√ß√µes do **M√≥dulo Postagem**.

1. Na **Collection Blog Pessoal**, clique no bot√£o <img src="https://i.imgur.com/3Ou2SAZ.png" title="source: imgur.com" width="6%"/>. No menu que ser√° aberto, clique na op√ß√£o **New Folder**.

<div align="center"><img src="https://i.imgur.com/gIGZFHc.png" title="source: imgur.com" /></div>

2. Na janela que ser√° aberta, informe o nome da pasta (**Postagem**) e clique no bot√£o **Create** para concluir. 

<div align="center"><img src="https://i.imgur.com/2rUhRGT.png" title="source: imgur.com" width="80%"/></div>

<br />

<h3>7.3. Criando a  Requisi√ß√£o - Consultar todas as postagens - findAll()</h3>



Agora vamos criar a Requisi√ß√£o para o **M√©todo findAll()**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New HTTP Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

<div align="center"><img src="https://i.imgur.com/ZIi9kJp.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/3eD6Zwy.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/NXrdnR4.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo do endpoint da Requisi√ß√£o. A Requisi√ß√£o **Consultar Todas as postagens** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (**http://localhost:4000**) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem.
- A segunda parte do endere√ßo √© o **endpoint** configurado no decorador ***@Controller()***, em nosso caso  **/postagens**. 

7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/iUfzYul.png" title="source: imgur.com" width="75%"/></div>

9. Observe que a aplica√ß√£o al√©m de exibir os dados de todos os Objetos da Classe Postagem persistidos no Banco de dados, no Corpo da Resposta, ela tamb√©m retornar√° um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!
9. Caso o Projeto Nest n√£o esteja em Execu√ß√£o, o Insomnia retornar√° a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/Y2iNu9v.png" title="source: imgur.com" /></div>

11. Execute o seu Projeto e teste novamente!

<br />

<div align="left"><img src="https://i.imgur.com/g1HCNZy.png" title="source: imgur.com" width="4%" /><a href="https://docs.insomnia.rest/" target="_blank"><b>Documenta√ß√£o: Insomnia Rest</b></a></div>

<div align="left"><img src="https://i.imgur.com/14IR5P4.png" title="source: imgur.com" width="4%"/><a href="https://www.json.org/json-pt.html" target="_blank"><b>Site Oficial do JSON</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/04_Listar_Postagens" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
