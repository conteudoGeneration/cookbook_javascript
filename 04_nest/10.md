<h1>Projeto 02 - Blog Pessoal - Classe PostagemController e PostagemService - Mﾃｩtodos Cadastrar e Atualizar Postagem</h1>

O que veremos por aqui:

1. Criar o mﾃｩtodo create(postagem: Postagem) na Classe PostagemService
2. Criar o mﾃｩtodo create(postagem: Postagem) na Classe PostagemController
3. Criar o mﾃｩtodo update(postagem: Postagem) na Classe PostagemService
4. Criar o mﾃｩtodo update(postagem: Postagem) na Classe PostagemController
5. Testar os Mﾃｩtodos no Insomnia

<h2>1. O Mﾃｳdulo Postagem</h2>

Nas etapas anteriores, comeﾃｧamos a construir as Classes **PostagemService** e **PostagemController** e implementamos os seguintes Mﾃｩtodos:

-  **findAll()**  ｡ｪ Retorna todos os Objetos da Classe Postagem persistidos no Banco de dados.
-  **findById(id: number)** ｡ｪ Retorna um Objeto especﾃｭfico da Classe Postagem persistido no Banco de dados. A Postagem ﾃｩ identificada pelo atributo id. 
-  **findByTitulo(titulo: string)** ｡ｪ Retorna  todos os Objetos da Classe Postagem persistidos no Banco de dados, cujo atributo titulo contenha (em qualquer parte) a String enviada no parﾃ｢metro titulo do Mﾃｩtodo.   

Vamos continuar a construﾃｧﾃ｣o das Classes **PostagemService** e  **PostagemController** implementando os Mﾃｩtodos **create(postagem: Postagem)**, que persistirﾃ｡ um novo Objeto da Classe Postagem no Banco de dados e  **update(postagem: Postagem)**, que atualizarﾃ｡ um Objeto da Classe Postagem persistido no Banco de dados.

<div align="center"><img src="https://i.imgur.com/EIm56Zk.png" title="source: imgur.com" width="75%"/></div>

<h2>促 Passo 01 - Criar o Mﾃｩtodo create(postagem: Postagem) na Classe PostagemService</h2>

Vamos implementar o Mﾃｩtodo **create(postagem: Postagem)** na Classe PostagemService. Traﾃｧando um paralelo com o MySQL, seria o equivalente a instruﾃｧﾃ｣o: <code>INSERT INTO tb_postagens (titulo, texto, data) VALUES ("Tﾃｭtulo", "Texto", CURRENT_TIMESTAMP());</code>.

1. Abra a Classe **Postagem Service**, localizada na pasta **src/postagem/services**.

<div align="center"><img src="https://i.imgur.com/K9AHCEo.png?1" title="source: imgur.com" /></div>

2. Insira o cﾃｳdigo abaixo depois do Mﾃｩtodo **findByTitulo(titulo: string)**.

<div align="left"><img src="https://i.imgur.com/LarxRND.png" title="source: imgur.com" /></div>

Vamos analisar o cﾃｳdigo do Mﾃｩtodo:

**Linha 39:** Criamos o Mﾃｩtodo Assﾃｭncrono (async), chamado **create(postagem: Postagem)**, que promete retornar uma **Promise** contendo um Objeto da Classe Postagem, que foi persistido no Banco de dados da aplicaﾃｧﾃ｣o. 

Observe que o Mﾃｩtodo **create(postagem: Postagem)** possui um parﾃ｢metro do tipo **Postagem**, chamado **postagem**. Esta variﾃ｡vel receberﾃ｡ um Objeto da Classe Postagem, que foi enviado no Corpo da Requisiﾃｧﾃ｣o (Request Body), conforme as regras definidas na Entidade Postagem (Tamanho, Pode ser Nulo, Pode ser vazio, entre outras). O Objeto postagem serﾃ｡ enviado pelo Mﾃｩtodo da **Classe PostagemController**, atravﾃｩs de um **JSON**, semelhante ao exemplo abaixo: 

```json
{
    "titulo" : "Postagem 01",
    "texto" : "Texto da Postagem 01"
}
```

Observe que apenas os Atributos **titulo e texto** serﾃ｣o enviados, porquﾃｪ o **id serﾃ｡ atribuﾃｭdo pelo Banco de dados** apﾃｳs o Objeto ser persistido e a **data serﾃ｡ atribuﾃｭda pelo Nest** (timestamp).

> **Timestamp:** Basicamente representa um instante ﾃｺnico, um ponto especﾃｭfico na linha  do tempo, e seu valor corresponde a uma determinada quantidade de tempo decorrida a partir de um instante inicial. Dentro do nosso contexto, a aplicaﾃｧﾃ｣o consultarﾃ｡ o Sistema Operacional para obter a data e a hora e gravarﾃ｡ em um Atributo do Objeto (data, por exemplo) o momento exato em que ele foi criado ou atualizado.

**Linha 40:** Retorna a execuﾃｧﾃ｣o do Mﾃｩtodo **save()**, da Interface **postagemRepository**. O resultado da execuﾃｧﾃ｣o do Mﾃｩtodo **save()**, serﾃ｡ um Objeto da Classe Postagem persistido (salvo) no Banco de dados, na tabela **tb_postagens**.  

Observe que na instruﾃｧﾃ｣o **return** foi inserido o comando **await** (aguarde), que na prﾃ｡tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja persistido), antes de retornar a execuﾃｧﾃ｣o do Mﾃｩtodo e o valor resolvido para a Classe que acionou o Mﾃｩtodo.

No caso de uma persistﾃｪncia dos dados, o retorno esperado do Mﾃｩtodo **save()** serﾃ｡ a confirmaﾃｧﾃ｣o do Objeto persistido, no formato JSON, como mostra o exemplo abaixo:

```json
{
    "id" : 1
    "titulo" : "Postagem 01",
    "texto" : "Texto da Postagem 01"
    "data": "2022-07-12T18:12:46.161Z"
}
```

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores - Classe de Serviﾃｧo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores Customizados - Classe de Serviﾃｧo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>TypeORM - Mﾃｩtodo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documentaﾃｧﾃ｣o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documentaﾃｧﾃ｣o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documentaﾃｧﾃ｣o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/07_Cadastrar_Atualizar_Postagem/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe PostagemService</b></a></div>

<br />

<h2>促 Passo 02 - Criar o Mﾃｩtodo create(postagem: Postagem) na Classe PostagemController</h2>

Vamos implementar o Mﾃｩtodo **create(@Body() postagem: Postagem)** na Classe PostagemController, que tem como objetivo executar o Mﾃｩtodo com o mesmo nome na Classe de Serviﾃｧo PostagemService. 

1. Abra a Classe **PostagemController**, localizada na pasta **src/postagem/controllers**.

<div align="center"><img src="https://i.imgur.com/HaoDWSZ.png?1" title="source: imgur.com" /></div>

2. Insira o cﾃｳdigo depois do Mﾃｩtodo **findByTitulo(titulo: string)**.

<div align="left"><img src="https://i.imgur.com/RR5TZYT.png" title="source: imgur.com" /></div>

Vamos analisar o cﾃｳdigo do Mﾃｩtodo:

**Linha 27:** O decorator **@Post()** mapeia todas as Requisiﾃｧﾃｵes **HTTP POST**, enviadas para um endereﾃｧo especﾃｭfico, chamado **endpoint**, dentro do Mﾃｳdulo Postagem, para um Mﾃｩtodo especﾃｭfico que responderﾃ｡ a Requisiﾃｧﾃ｣o, ou seja, ele indica que o Mﾃｩtodo **create(@Body() postagem: Postagem)**, responderﾃ｡ a todas as requisiﾃｧﾃｵes do tipo **HTTP POST**, enviadas no endereﾃｧo **http://localhost:4000/postagens/**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATENﾃﾃグ:** *O Endereﾃｧo do endpoint do Mﾃｩtodo create(@Body() postagem: Postagem) serﾃ｡ igual ao endereﾃｧo do Mﾃｩtodo findAll(). Como os verbos HTTP dos dois Mﾃｩtodos sﾃ｣o diferentes, o mesmo endereﾃｧo pode ser de utilizado.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 28:** O decorator **@HttpCode(HttpStatus.CREATED)** indica que o Mﾃｩtodo **create(@Body() postagem: Postagem)**, terﾃ｡ como **Resposta HTTP** padrﾃ｣o o status **CREATED ｡ｪ 201**, ou seja, quando a Resposta da Requisiﾃｧﾃ｣o for positiva (o Objeto for persistido no Banco de dados), serﾃ｡ retornado o **HTTP Status CREATED ｡ｪ 201**. Caso a Resposta seja negativa (algo deu errado), a Resposta dependerﾃ｡ do erro.

**Linha 29:** Criamos o Mﾃｩtodo **create(@Body() postagem: Postagem)**, que promete retornar uma **Promise**, que serﾃ｡ enviada pela Classe PostagemService, contendo um Objeto da Classe Postagem. 

**@Body():** Este decorator **insere o Objeto postagem enviado no corpo da Requisiﾃｧﾃ｣o**, no Objeto postagem (parﾃ｢metro) do Mﾃｩtodo **create(@Body() postagem: Postagem)**;

**Linha 30:** Executa o mﾃｩtodo **create(postagem: Postagem)**, **Mﾃｩtodo da Classe PostagemService**, que retornarﾃ｡ o Objeto da Classe Postagem persistido no Banco de dados. 

3. Apﾃｳs a implementaﾃｧﾃ｣o do Mﾃｩtodo **create(@Body() postagem: Postagem)**, observe que a linha 1 do cﾃｳdigo serﾃ｡ atualizada com alguns novos pacotes, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/BGbky4w.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Methods Request</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/07_Cadastrar_Atualizar_Postagem/blogpessoal/src/postagem/controllers/postagem.controller.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe PostagemController</b></a></div>

<br /><br />


<h2>促 Passo 03 - Executar o projeto</h2>

1. Verifique se vocﾃｪ estﾃ｡ dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/67GK3fX.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso nﾃ｣o esteja em execuﾃｧﾃ｣o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, observe na imagem abaixo, na regiﾃ｣o indicada em amarelo, que o endpoint do tipo **POST**, apontando para o caminho (rota) **/postagens**, foi disponibilizado.

<div align="center"><img src="https://i.imgur.com/avX3X6b.png" title="source: imgur.com" /></div>

<br />


<h2>促 Passo 04 - Testar o Mﾃｩtodo create no Insomnia</h2>

Agora vamos criar a Requisiﾃｧﾃ｣o para o **Mﾃｩtodo create(postagem: Postagem)**:

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/bFUVP3h.png" title="source: imgur.com" width="45%"/></div>

2.  Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Postagem**.

<div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. Dﾃｪ um duplo clique sobre a nova Requisiﾃｧﾃ｣o (**New Request**), informe o nome da Requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/z1mf3na.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**POST**) na Requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/TLBY2tJ.png" title="source: imgur.com" /></div>

5. No item **Body**, vamos alterar para **JSON**, como mostra a imagem abaixo. Desta forma poderemos enviar os dados do Objeto Postagem no Corpo da Requisiﾃｧﾃ｣o, no formato JSON.

<div align="center"><img src="https://i.imgur.com/PxOpzFd.png" title="source: imgur.com" /></div>

6. Observe que o item **Body** serﾃ｡ renomeado para **JSON**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8hDNIbh.png" title="source: imgur.com" /></div>

7. Configure a Requisiﾃｧﾃ｣o conforme a imagem abaixo: 

<div align="center"><img src="https://i.imgur.com/L9D1Gvq.png" title="source: imgur.com" /></div>

8. No item marcado em amarelo na imagem acima, informe o endereﾃｧo (endpoint) da Requisiﾃｧﾃ｣o. A requisiﾃｧﾃ｣o **Cadastrar Postagem** foi configurada da seguinte maneira:

- A primeira parte do endereﾃｧo (http://localhost:4000) ﾃｩ o endereﾃｧo do nosso servidor local. Quando a aplicaﾃｧﾃ｣o estiver na nuvem, ele serﾃ｡ substituﾃｭdo pelo endereﾃｧo da nuvem (**Exemplo:** http://nomedaaplicacao.herokuapp.com).
- A segunda parte do endereﾃｧo ﾃｩ o **endpoint** configurado no decorator ***@Controller***, em nosso caso **/postagens**.  

9. Na guia **JSON**, precisamos inserir um **JSON** com os dados que serﾃ｣o inseridos na nova postagem. Lembrando que no padrﾃ｣o JSON: **o texto antes dos 2 pontos** (:) ﾃｩ o **atributo** da Classe e **o texto depois dos 2 pontos** (:) ﾃｩ o **dado** que serﾃ｡ cadastrado no atributo.  Os atributos sﾃ｣o separados por virgula, como mostra a imagem acima.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATENﾃﾃグ:** Observe que no mﾃｩtodo **POST nﾃ｣o ﾃｩ necessﾃ｡rio enviar os atributos id** (serﾃ｡ gerado pelo Banco de dados) e **data** (serﾃ｡ enviada pelo Nest) no JSON.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

10. Para testar a requisiﾃｧﾃ｣o, com a aplicaﾃｧﾃ｣o rodando, clique no botﾃ｣o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="50px"/>.

11. O resultado da requisiﾃｧﾃ｣o vocﾃｪ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/NRsnpOR.png" title="source: imgur.com" /></div>

12. Observe que a aplicaﾃｧﾃ｣o retorna alﾃｩm dos dados que foram persistidos no Banco de dados com o id e a data, ela tambﾃｩm retorna um **HTTP Status 201 ｡ｪ CREATED** (indicado em verde na imagem acima). Este Status indica que a Requisiﾃｧﾃ｣o foi bem sucedida!

13. Caso os Atributos **titulo** ou **texto** sejam nulos ou em branco (indicado em amarelo), a aplicaﾃｧﾃ｣o retornarﾃ｡ o **HTTP Status 400 ｡ｪ BAD_REQUEST** (indicado em verde), devido a validaﾃｧﾃ｣o que foi inserida na Classe Postagem (**@IsNotEmpty**), como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/hPVAV1u.png" title="source: imgur.com" /></div>

<br />

<h2>促 Passo 05 - Criar o Mﾃｩtodo update(postagem: Postagem) na Classe PostagemService</h2>

Vamos implementar o Mﾃｩtodo **update(postagem: Postagem)** na Classe PostagemService. Traﾃｧando um paralelo com o MySQL, seria o equivalente a instruﾃｧﾃ｣o: <code>UPDATE tb_postagens SET titulo = "titulo", texto = "texto", data = CURRENT_TIMESTAMP() WHERE id = id;</code>.

1. Abra a Classe **Postagem Service**, localizada na pasta **src/postagem/services**.

<div align="center"><img src="https://i.imgur.com/K9AHCEo.png?1" title="source: imgur.com" /></div>

2. Insira o cﾃｳdigo depois do Mﾃｩtodo **create(@Body() postagem: Postagem)**.

<div align="left"><img src="https://i.imgur.com/ge3IjsS.png" title="source: imgur.com" /></div>

Vamos analisar o cﾃｳdigo do Mﾃｩtodo:

**Linha 43:** Criamos o Mﾃｩtodo Assﾃｭncrono (async), chamado **update(postagem: Postagem)**, que promete retornar uma **Promise** contendo um Objeto da Classe Postagem, que foi atualizado no Banco de dados da aplicaﾃｧﾃ｣o. 

Observe que o Mﾃｩtodo **update(postagem: Postagem)** possui um parﾃ｢metro do tipo **Postagem**, chamado **postagem**. Esta variﾃ｡vel receberﾃ｡ um Objeto da Classe Postagem, que serﾃ｡ enviado no Corpo da Requisiﾃｧﾃ｣o (Request Body), conforme as regras definidas na Entidade Postagem (Tamanho, Pode ser Nulo, Pode ser vazio, entre outras). O Objeto postagem serﾃ｡ enviado pelo Mﾃｩtodo da **Classe PostagemController**, atravﾃｩs de um **JSON**, semelhante ao exemplo abaixo: 

```json
{
    "id" : 3,
    "titulo" : "Postagem 03 atualizada",
    "texto" : "Texto da Postagem 03 atualizado"
}
```

Observe que dieferente do Mﾃｩtodo **create(postagem: Postagem)**, alﾃｩm dos Atributos **titulo e texto**, **o id tambﾃｩm deve ser enviado para identificar a postagem que serﾃ｡ atualizada**. O Atributo **data** nﾃ｣o precisa ser enviado.

**Linha 45:** Criamos um Objeto da Classe Postagem, chamado **buscaPostagem**, para receber o resultado da execuﾃｧﾃ｣o do Mﾃｩtodo **findById(id: number)**, da Classe **PostagemService**. O objetivo ﾃｩ checar se a Postagem que serﾃ｡ atualizada existe, atravﾃｩs da busca pelo id.  Observe que na chamada do Mﾃｩtodo **findById(id: number)** foi inserido o comando **await** (aguarde), que na prﾃ｡tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja encontrado), antes de retornar a execuﾃｧﾃ｣o do Mﾃｩtodo e o valor resolvido para a Classe que acionou o Mﾃｩtodo.

**Linha 47:** Verifica se **buscaPostagem ﾃｩ nulo** ou se o **id da postagem(JSON) ﾃｩ nulo**. Caso o usuﾃ｡rio digite um id que nﾃ｣o exista, o Objeto buscaPostagem serﾃ｡ nulo, causando um erro na nossa aplicaﾃｧﾃ｣o. Caso o usuﾃ｡rio nﾃ｣o informe o valor do Atributo id no Objeto postagem (JSON), que foi enviado no Corpo da Requisiﾃｧﾃ｣o, serﾃ｡ criado um novo Objeto, com um novo id. Estas duas checagens sﾃ｣o para evitar estes dois erros.

**Linha 48:** Se o Objeto buscaPostagem ou o Atributo id do Objeto postagem(JSON) for nulo, serﾃ｡ retornado o HTTP Status **NOT FOUND ｡ｪ 404** (Nﾃ｣o Encontrado!).

**Linha 50:** Retorna a execuﾃｧﾃ｣o do Mﾃｩtodo **save()**, da Interface **postagemRepository**. O resultado da execuﾃｧﾃ｣o do Mﾃｩtodo **save()**, serﾃ｡ um Objeto da Classe Postagem atualizado no Banco de dados, na tabela **tb_postagens**. 

Observe que na instruﾃｧﾃ｣o **return** foi inserido o comando **await** (aguarde), que na prﾃ｡tica significa espere que a **Promise** seja resolvida (os Objetos Postagem sejam atualizados), antes de retornar a execuﾃｧﾃ｣o do Mﾃｩtodo e o valor resolvido para a Classe que acionou o Mﾃｩtodo.

No caso de uma atualizaﾃｧﾃ｣o dos dados, o retorno esperado do Mﾃｩtodo **save()** serﾃ｡ a confirmaﾃｧﾃ｣o do Objeto persistido com as atualizaﾃｧﾃｵes, no formato JSON, como mostra o exemplo abaixo:

```json
{
    "id" : 3,
    "titulo" : "Postagem 03 atualizada",
    "texto" : "Texto da Postagem 03 atualizado"
    "data": "2022-07-13T18:13:48.167Z"
}
```

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores - Classe de Serviﾃｧo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores Customizados - Classe de Serviﾃｧo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>TypeORM - Mﾃｩtodo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documentaﾃｧﾃ｣o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documentaﾃｧﾃ｣o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documentaﾃｧﾃ｣o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/07_Cadastrar_Atualizar_Postagem/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe PostagemService</b></a></div>

<br />

<h2>促 Passo 06 - Criar o Mﾃｩtodo update(postagem: Postagem) na Classe PostagemController</h2>

Vamos implementar o Mﾃｩtodo **update(@Body() postagem: Postagem)** na Classe PostagemController, que tem como objetivo executar o Mﾃｩtodo com o mesmo nome na Classe de Serviﾃｧo PostagemService. 

1. Abra a Classe **PostagemController**, localizada na pasta **src/postagem/controllers**.

<div align="center"><img src="https://i.imgur.com/HaoDWSZ.png?1" title="source: imgur.com" /></div>

2. Insira o cﾃｳdigo depois do Mﾃｩtodo **create(@Body() postagem: Postagem)**.

<div align="left"><img src="https://i.imgur.com/CsgqXzI.png" title="source: imgur.com" /></div>

Vamos analisar o cﾃｳdigo do Mﾃｩtodo:

**Linha 33:** O decorator **@Put()** mapeia todas as Requisiﾃｧﾃｵes **HTTP PUT**, enviadas para um endereﾃｧo especﾃｭfico, chamado **endpoint**, dentro do Mﾃｳdulo Postagem, para um Mﾃｩtodo especﾃｭfico que responderﾃ｡ a Requisiﾃｧﾃ｣o, ou seja, ele indica que o Mﾃｩtodo **update(@Body() postagem: Postagem)**, responderﾃ｡ a todas as requisiﾃｧﾃｵes do tipo **HTTP PUT**, enviadas no endereﾃｧo **http://localhost:4000/postagens/**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATENﾃﾃグ:** *O Endereﾃｧo do endpoint do Mﾃｩtodo update(@Body() postagem: Postagem) serﾃ｡ igual ao endereﾃｧo do Mﾃｩtodo findAll() e do Mﾃｩtodo create(@Body() postagem: Postagem). Como os verbos HTTP dos trﾃｪs Mﾃｩtodos sﾃ｣o diferentes, o mesmo endereﾃｧo pode ser utilizado.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 34:** O decorator **@HttpCode(HttpStatus.OK)** indica que o Mﾃｩtodo **update(@Body() postagem: Postagem)**, terﾃ｡ como **Resposta HTTP** padrﾃ｣o **OK ｡ｪ 200**, ou seja, quando a Resposta da Requisiﾃｧﾃ｣o for positiva, serﾃ｡ retornado o **HTTP Status OK ｡ｪ 200**. Caso a Resposta seja negativa (algo deu errado), a Resposta dependerﾃ｡ do erro.

**Linha 35:** Criamos o Mﾃｩtodo **update(@Body() postagem: Postagem)**, que promete retornar uma **Promise**, que serﾃ｡ enviada pela Classe PostagemService, contendo um Objeto da Classe Postagem. 

**@Body():** Este decorator **insere o Objeto postagem enviado no corpo da Requisiﾃｧﾃ｣o**, no Objeto **postagem** (parﾃ｢metro) do Mﾃｩtodo **update(@Body() postagem: Postagem)**;

**Linha 36:** Executa o mﾃｩtodo **update(postagem: Postagem)**, **Mﾃｩtodo da Classe PostagemService**, que retornarﾃ｡ **o Objeto da Classe Postagem** atualizado no Banco de dados. 

3. Apﾃｳs a implementaﾃｧﾃ｣o do Mﾃｩtodo **update(@Body() postagem: Postagem)**, observe que a linha 1 do cﾃｳdigo serﾃ｡ atualizada com um novo pacote, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/PE1Vfqr.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Request Methods</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/07_Cadastrar_Atualizar_Postagem/blogpessoal/src/postagem/controllers/postagem.controller.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe PostagemController</b></a></div>

<br />


<h2>促 Passo 07 - Testar no Insomnia o Mﾃｩtodo update</h2>

Agora vamos criar a Requisiﾃｧﾃ｣o para o **Mﾃｩtodo update(postagem: Postagem)**:

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/bFUVP3h.png" title="source: imgur.com" width="50%"/></div>

2.  Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Postagem**.

<div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. Dﾃｪ um duplo clique sobre a nova Requisiﾃｧﾃ｣o (**New Request**), informe o nome da Requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/ZQKmphk.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**PUT**) na Requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/z6dWHYj.png" title="source: imgur.com" /></div>

5. No item **Body**, vamos alterar para **JSON**, como mostra a imagem abaixo. Desta forma poderemos enviar os dados do Objeto Postagem no Corpo da Requisiﾃｧﾃ｣o, no formato JSON.

<div align="center"><img src="https://i.imgur.com/PxOpzFd.png" title="source: imgur.com" /></div>

6. Observe que o item **Body** serﾃ｡ renomeado para **JSON**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8hDNIbh.png" title="source: imgur.com" /></div>

7. Configure a Requisiﾃｧﾃ｣o conforme a imagem abaixo: 

<div align="center"><img src="https://i.imgur.com/yhn142h.png" title="source: imgur.com" /></div>

4. No item marcado em amarelo na imagem acima, informe o endereﾃｧo (endpoint)) da Requisiﾃｧﾃ｣o. A requisiﾃｧﾃ｣o **Editar Postagem** foi configurada da seguinte maneira:

   - A primeira parte do endereﾃｧo (http://localhost:4000) ﾃｩ o endereﾃｧo do nosso servidor local. Quando a aplicaﾃｧﾃ｣o estiver na nuvem, ele serﾃ｡ substituﾃｭdo pelo endereﾃｧo da nuvem (**Exemplo:** http://nomedaaplicacao.herokuapp.com).
   - A segunda parte do endereﾃｧo ﾃｩ o **endpoint** configurado no decorator ***@Controller***, em nosso caso **/postagens**.  
   
5. Na guia **JSON**, precisamos inserir um **JSON** com os dados que serﾃ｣o inseridos na nova postagem. Lembrando que no padrﾃ｣o JSON: **o texto antes dos 2 pontos** (:) ﾃｩ o **atributo** da Classe e **o texto depois dos 2 pontos** (:) ﾃｩ o **dado** que serﾃ｡ cadastrado no atributo.  Os atributos sﾃ｣o separados por virgula, como mostra a imagem acima.

   | <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATENﾃﾃグ:** Observe que no mﾃｩtodo **PUT ﾃｩ necessﾃ｡rio enviar o atributo id** no JSON para identificar a Postagem que serﾃ｡ atualizada. A data nﾃ｣o precisa ser enviada, porquﾃｪ ela serﾃ｡ atualizada pela prﾃｳpria aplicaﾃｧﾃ｣o.</div> |
   | ------------------------------------------------------------ | ------------------------------------------------------------ |

6. Para testar a requisiﾃｧﾃ｣o, com a aplicaﾃｧﾃ｣o rodando, clique no botﾃ｣o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

7. O resultado da requisiﾃｧﾃ｣o vocﾃｪ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/cX3ZGv8.png" title="source: imgur.com" /></div>

8. Observe que a aplicaﾃｧﾃ｣o retorna alﾃｩm dos dados que foram atualizados no Banco de dados, ela tambﾃｩm retorna um **HTTP Status 200 ｡ｪ OK** (indicado em verde na imagem acima). Este Status indica que a Requisiﾃｧﾃ｣o foi bem sucedida!

9. Caso a Postagem nﾃ｣o seja encontrada, serﾃ｡ retornado o **HTTP Status 404 ｡ｪ NOT_FOUND**, ou seja, a postagem nﾃ｣o foi encontrada, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/ygGQ0TE.png" title="source: imgur.com" /></div>

10. Caso os Atributos **titulo** ou **texto** sejam nulos ou em branco (indicado em amarelo), a aplicaﾃｧﾃ｣o retornarﾃ｡ o **HTTP Status 400 ｡ｪ BAD_REQUEST** (indicado em verde), devido a validaﾃｧﾃ｣o que foi inserida na Classe Postagem (**@IsNotEmpty**), como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/NrDMu75.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/07_Cadastrar_Atualizar_Postagem" target="_blank"><b>Cﾃｳdigo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>