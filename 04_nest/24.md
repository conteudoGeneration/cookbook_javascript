<h1>Documenta√ß√£o com o NestJS - Swagger</h1>

Uma API bem constru√≠da deve ser simples de ser consumida, por isso √© fundamental documentar a API da  maneira correta. O objetivo da Documenta√ß√£o √© apresentar uma esp√©cie de "manual de instru√ß√µes" que permita que qualquer pessoa (Desenvolvedora ou n√£o), que ainda n√£o tenha pleno conhecimento do dom√≠nio da sua aplica√ß√£o, **consuma a API de maneira f√°cil, r√°pida, eficaz e aut√¥noma**. Neste guia veremos como documentar a API de forma simples utilizando o **Swagger**.

<h2>1. OpenApi</h2>

A **OpenApi**, trata-se de uma especifica√ß√£o Open Source, que auxilia as pessoas desenvolvedoras nos processos de **definir, criar, documentar e consumir** API's REST e RESTful. A OpenApi tem por objetivo padronizar este tipo de integra√ß√£o, descrevendo os recursos que uma API possui, os respectivos endpoints, os dados que ser√£o solicitados nas Requisi√ß√µes, os dados que ser√£o retornados nas Respostas, os Status HTTP, os modelos de dados, os m√©todos de autentica√ß√£o, entre outros.

API's REST s√£o frequentemente usadas para a integra√ß√£o de aplica√ß√µes, seja para consumir servi√ßos de terceiros, seja para prover novos servi√ßos. Para estas API's, a especifica√ß√£o OpenApi facilita a modelagem, a documenta√ß√£o e a gera√ß√£o de c√≥digo.

<br />

<div align="left"><img src="https://i.imgur.com/EWMO1wL.png" title="source: imgur.com" width="25px"/> <a href="https://www.openapis.org/" target="_blank"><b>Site Oficial: <i>OpenApi</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/EWMO1wL.png" title="source: imgur.com" width="25px"/> <a href="https://spec.openapis.org/oas/latest.html#introduction" target="_blank"><b>Documenta√ß√£o: <i>Especifica√ß√£o OpenApi</i></b></a></div>

<br />

<h2>2. Swagger</h2>

O Swagger √© uma poderosa ferramenta que ajuda pessoas Desenvolvedoras a **projetar, desenvolver, documentar e consumir servi√ßos** web REST e RESTful, de forma interativa e din√¢mica, aproveitando ao m√°ximo todos os Recursos da especifica√ß√£o OpenApi.
Apesar de ser conhecida principalmente por sua interface **Swagger UI**, o software inclui suporte para documenta√ß√£o automatizada da API, gera√ß√£o de c√≥digo e testes.

<br />

<div align="left"><img src="https://i.imgur.com/IJNY0uR.png" title="source: imgur.com" width="25px"/> <a href="https://swagger.io/" target="_blank"><b>Site Oficial: Swagger</b></a>
<br />
<br />

<h3>2.1. Swagger-UI</h3>

O **Swagger-UI** √© a Interface Gr√°fica do Swagger para a WEB. Na imagem abaixo vemos o Swagger sendo executado no Navegador da Internet:

<div align="center"><img src="https://i.imgur.com/JKxWgN5.png?1" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/IJNY0uR.png" title="source: imgur.com" width="25px"/> <a href="https://swagger.io/tools/swagger-ui/" target="_blank"><b>Site Oficial: Swagger-UI</b></a>
<br />
<br />

<h2>3. NestJS - Swagger</h2>

O Pacote **NestJS - Swagger** √© uma implementa√ß√£o da OpenApi + Swagger, que ajuda a automatizar a gera√ß√£o de documenta√ß√£o API em projetos Nest. O NestJS - Swagger examina um aplicativo em tempo de execu√ß√£o para criar a Documenta√ß√£o da API, com base nas configura√ß√µes do Nest, na estrutura das Classes e alguns decorators que iremos inserir nas **Classes Entidade e Controladora**.  A documenta√ß√£o √© gerada automaticamente no formato JSON / YAML e HTML. Esta documenta√ß√£o pode ser completada por coment√°rios usando decorators do Swagger. 

> **YAML** √© um formato de serializa√ß√£o (codifica√ß√£o de dados) de dados leg√≠veis por humanos inspirado no XML, sendo amplamente utilizada em arquivos de configura√ß√£o, assim como o XML e o JSON. YAML √© um acr√≥nimo recursivo que significa "YAML Ain't Markup Language" (em portugu√™s, "YAML n√£o √© linguagem de marca√ß√£o"). 

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="30px"/> <a href="https://docs.nestjs.com/openapi/introduction" target="_blank"><b>Documenta√ß√£o: NestJS - Swagger</b></a></div>

<div align="left"><img src="https://i.imgur.com/EWMO1wL.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/nestjs/swagger#readme" target="_blank"><b>Documenta√ß√£o: <i>API NestJS - Swagger</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/APWERdF.png" title="source: imgur.com" width="25px"/> <a href="https://yaml.org" target="_blank"><b>Site Oficial: <i>YAML</i></b></a></div>

<br />

Vamos criar a Documenta√ß√£o do nosso Projeto Blog Pessoal no formato Digital atrav√©s do Pacote **NestJS Swagger**.

<br />

<h2>üë£ Passo 01- Instala√ß√£o do Pacote NestJS Swagger</h2>

Vamos instalar o Pacote NestJS Swagger atrav√©s do NPM.

1. Abra o **Terminal** do VSCode atrav√©s do menu **Terminal ü°™ New Terminal**
2. Ser√° aberta janela do **Power Shell** na parte inferior da janela do VSCode.
3. Para instalar o **NestJS Swagger**, digite o comando abaixo:

```bash
npm install --save @nestjs/swagger swagger-ui-express
```

4. Ao concluir a instala√ß√£o ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/t5t1DeK.png?1" title="source: imgur.com" /></div>


<br />

<h2>üë£ Passo 02- Configurar a Classe Main</h2>

Vamos atualizar a **Classe Main**, no arquivo **main.ts**, localizado na pasta **src** do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/bKna97v.png" title="source: imgur.com" /></div>

1) Abra a Classe **main.ts**
2) Vamos inserir as linhas abaixo na Classe **Main**, logo abaixo da **const app**, antes da configura√ß√£o do fuso hor√°rio (**process.env.TZ = '-03:00'**)

```javascript
const config = new DocumentBuilder()
  .setTitle('Blog Pessoal')
  .setDescription('Projeto Blog Pessoal')
  .setContact("Generation Brasil","http://www.generationbrasil.online","generation@email.com")
  .setVersion('1.0')
  .addBearerAuth()
  .build();
  const document = SwaggerModule.createDocument(app, config);
  SwaggerModule.setup('/swagger', app, document);
```

A altera√ß√£o acima est√° destacada na imagem abaixo na cor verde:

<div align="left"><img src="https://i.imgur.com/2T1w3wR.png" title="source: imgur.com" /></div>

Vamos detalhar as linhas que foram inseridas na Classe Main:

**Linha 09:** Cria a **const config** que receber√° a execu√ß√£o do **M√©todo DocumentBuilder()**, respons√°vel por construir o Swagger. Dentro deste M√©todo ser√£o enviados alguns par√¢metros.

**Linha 10:** Informa o Nome do projeto (Title).

**Linha 11:** Insere uma Descri√ß√£o sobre o Projeto.

**Linha 12:** Insere as informa√ß√µes de contato da pessoa Desenvolvedora (Nome, Site Pessoal e E-mail)

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao configurar o Swagger. As informa√ß√µes de Contato devem ser preenchidas com os seus dados (Nome, Site Pessoal ou Github e o E-mail).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 13:** Informa a  Vers√£o do Projeto.

**Linha 14:** Adiciona a Autentica√ß√£o com Token JWT, ou seja, para acessar os recursos do Swagger ser√° necess√°rio efetuar o **Login e Enviar o Token JWT**.

**Linha 15:** Constr√≥i a p√°gina do Swagger com todos os Par√¢metros acima, atrav√©s do **M√©todo build()**.

**Linha 16:** Cria a **const document** que receber√° a execu√ß√£o do **M√©todo createDocument()**, respons√°vel por criar o **M√≥dulo do Swagger**. Dentro deste M√©todo ser√£o enviados 2 par√¢metros: A **Aplica√ß√£o (app)** e o **Swagger (config)**.

**Linha 17:** Configura o endpoint do Swagger, atrav√©s do **M√©todo setup()**. Dentro deste M√©todo ser√£o enviados 3 par√¢metros: O **Endpoint do Swagger (/swagger)**, a **Aplica√ß√£o (app)** e o **M√≥dulo do Swagger (document)**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *O par√¢metro endere√ßo do endpoint (primeiro par√¢metro do M√©todo setup), n√£o pode ficar vazio ou ser preenchido com uma /, sen√£o o Swagger n√£o ir√° funcionar.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="30px"/> <a href="https://docs.nestjs.com/openapi/introduction" target="_blank"><b>Documenta√ß√£o: NestJS - Swagger</b></a></div>

<div align="left"><img src="https://i.imgur.com/EWMO1wL.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/nestjs/swagger#readme" target="_blank"><b>Documenta√ß√£o: <i>API NestJS - Swagger</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="30px"/> <a href="" target="_blank"><b>C√≥digo fonte: Classe Main</b></a>

<br />
<br />

<h2>4. Decorators do Swagger</h2>

Para o Swagger reconhecer os Endpoints da API e o Modelo de Dados (Entidades), o SwaggerJS utiliza alguns Decorators que iremos adicionar nas Classes Entidade e nas Classes Controladoras. Veja os mais utilizados na tabela abaixo:

| Decorator                 | Descri√ß√£o                                                    |
| ------------------------- | ------------------------------------------------------------ |
| **@ApiProperty()**        | Mapeia o atributo da Classe Entidade. Todos os Atributos de todas as Classes Entidade precisam estar "decorados" com este decorator, sen√£o o Atributo ou toda a Entidade n√£o estar√° dispon√≠vel no Swagger. |
| **@ApiTags()**            | Mapeia a Classe Controladora. Todas as Classes Controladoras precisam estar  "decoradas" com este decorator, sen√£o os enpoints n√£o estar√£o dispon√≠veis no Swagger. |
| **@ApiBearerAuth()**      | Habilita a Autentica√ß√£o JWT em todos os endpoints da Classe Controladora, exceto os endpoints liberados na Configura√ß√£o da seguran√ßa. Todas as Classes Controladoras precisam estar  "decoradas" com este decorator, sen√£o os endpoints n√£o estar√£o acess√≠veis no Swagger, mesmo que estejam dispon√≠veis. |
| **@ApiExcludeEndpoint()** | Oculta um endpoint espec√≠fico no Swagger. Caso tenha algum endpoint que voc√™  n√£o deseja deixar vis√≠vel no Swagger, basta adicionar este decorator. |

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="30px"/> <a href="https://docs.nestjs.com/openapi/introduction" target="_blank"><b>Documenta√ß√£o: NestJS - Swagger</b></a></div>

<div align="left"><img src="https://i.imgur.com/EWMO1wL.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/nestjs/swagger#readme" target="_blank"><b>Documenta√ß√£o: <i>API NestJS - Swagger</i></b></a></div>

<br />

<h2>üë£ Passo 03 - Altera√ß√µes no M√≥dulo Usuario</h2>

Vamos configurar as Classes **Usuario e UsuarioController**.

<h3>Classe Usuario - Entidade</h3>

Vamos adicionar o decorator **@ApiProperty()** em todos os atributos da Classe Usuario:

**Exemplo:**

```javascript
    @IsNotEmpty()
    @Column({length: 255, nullable: false}) 
    @ApiProperty() 
    public nome: string
```

Observe no exemplo acima, que o decorator **@ApiProperty()** foi adicionado acima do Atributo **nome**.

No Atributo usuario, vamos adicionar dentro do decorator **@ApiProperty()** o par√¢metro **example**. Esse par√¢metro tem a fun√ß√£o de lembrar que o **Atributo usuario** deve ser preenchido com um **endere√ßo de e-email**.

**Exemplo:**

```javascript
    @IsEmail()
    @Column({length: 255, nullable: false })
    @ApiProperty({example: "email@email.com.br"}) 
    public usuario: string
```

Ap√≥s adicionar os decorators, nossa Classe Entidade Usuario ter√° a seguinte implementa√ß√£o:

```javascript
import { ApiProperty } from "@nestjs/swagger"
import { IsEmail, IsNotEmpty, MinLength } from "class-validator"
import { Column, Entity, OneToMany, PrimaryGeneratedColumn } from "typeorm"
import { Postagem } from "../../postagem/entities/postagem.entity"

@Entity({name: "tb_usuarios"})
export class Usuario {

    @PrimaryGeneratedColumn() 
    @ApiProperty() 
    public id: number

    @IsNotEmpty()
    @Column({length: 255, nullable: false}) 
    @ApiProperty() 
    public nome: string

    @IsEmail()
    @Column({length: 255, nullable: false })
    @ApiProperty({example: "email@email.com.br"}) 
    public usuario: string

    @IsNotEmpty()
    @MinLength(8)
    @Column({length: 255, nullable: false }) 
    @ApiProperty() 
    public senha: string

    @Column({length: 5000 }) 
    @ApiProperty() 
    public foto: string

    @ApiProperty() 
    @OneToMany(() => Postagem, (postagem) => postagem.usuario)
    postagem: Postagem[]

}
```

Observe que todos os Atributos est√£o decorados com o decorator **@ApiProperty()**.


<h3>Classe UsuarioController - Controladora</h3>

Vamos adicionar os decorators **@ApiTags()** e **@ApiBearerAuth()** na Classe UsuarioController:

Ap√≥s adicionar os decorators, nossa Classe Controladora UsuarioController ter√° a seguinte implementa√ß√£o:

```javascript
import { Body, Controller, Get, HttpCode, HttpStatus, Post, Put, UseGuards } from "@nestjs/common";
import { ApiBearerAuth, ApiTags } from "@nestjs/swagger";
import { JwtAuthGuard } from "../../auth/guard/jwt-auth.guard";
import { Usuario } from "../entities/usuario.entity";
import { UsuarioService } from "../services/usuario.service";

@ApiTags('Usuario')
@Controller("/usuarios")
@ApiBearerAuth()
export class UsuarioController {
    constructor(private readonly usuarioService: UsuarioService) { }

    @UseGuards(JwtAuthGuard)
    @Get('/all')
    @HttpCode(HttpStatus.OK)
    findAll(): Promise<Usuario[]> {
        return this.usuarioService.findAll();
    }

    @HttpCode(HttpStatus.CREATED)
    @Post('/cadastrar')
    async create(@Body() usuario: Usuario): Promise<Usuario> {
        return await this.usuarioService.create(usuario);
    }

    @UseGuards(JwtAuthGuard)
    @Put('/atualizar')
    @HttpCode(HttpStatus.OK)
    async update(@Body() usuario: Usuario): Promise<Usuario> {
        return this.usuarioService.update(usuario);
    }

}
```

Observe que os 2 decorators foram adicionados na assinatura da Classe e no decorator **@ApiTags()** foi inserido dentro dos parenteses o nome do M√≥dulo (**Usuario**).

<br />



<h2>üë£ Passo 04 - Altera√ß√µes no M√≥dulo Tema</h2>

Vamos configurar as Classes **Tema e TemaController**. Abaixo voc√™ confere o c√≥digo com os decorators implementados:

<h3>Classe Tema - Entidade</h3>

```javascript
import { ApiProperty } from "@nestjs/swagger";
import { IsNotEmpty } from "class-validator";
import { Column, Entity, OneToMany, PrimaryGeneratedColumn } from "typeorm";
import { Postagem } from "../../postagem/entities/postagem.entity";

@Entity({name: "tb_temas"})
export class Tema {

    @PrimaryGeneratedColumn()  
    @ApiProperty()   
    id: number

    @IsNotEmpty()
    @Column({length: 255, nullable: false})
    @ApiProperty() 
    descricao: string

    @ApiProperty() 
    @OneToMany(() => Postagem, (postagem) => postagem.tema)
    postagem: Postagem[]
    
}
```

<h3>Classe TemaController - Controladora</h3>

```javascript
import { Body, Controller, Delete, Get, HttpCode, HttpStatus, Param, ParseIntPipe, Post, Put, UseGuards } from "@nestjs/common";
import { ApiBearerAuth, ApiTags } from "@nestjs/swagger";
import { JwtAuthGuard } from "../../auth/guard/jwt-auth.guard";
import { Tema } from "../entities/tema.entity";
import { TemaService } from "../services/tema.service";

@ApiTags('Tema')
@UseGuards(JwtAuthGuard)
@Controller("/tema")
@ApiBearerAuth()
export class TemaController {
  constructor(private readonly temaService: TemaService) { }

  @Get()
  @HttpCode(HttpStatus.OK)
  findAll(): Promise<Tema[]> {
    return this.temaService.findAll();
  }

  @Get('/:id')
  @HttpCode(HttpStatus.OK)
  findById(@Param('id', ParseIntPipe) id: number): Promise<Tema> {
    return this.temaService.findById(id);
  }

  @Get('/descricao/:descricao')
  @HttpCode(HttpStatus.OK)
  findBydescricao(@Param('descricao') descricao: string): Promise<Tema[]> {
    return this.temaService.findByDescricao(descricao);
  }

  @Post()
  @HttpCode(HttpStatus.CREATED)
  create(@Body() Tema: Tema): Promise<Tema> {
    return this.temaService.create(Tema);
  }

  @Put()
  @HttpCode(HttpStatus.OK)
  update(@Body() Tema: Tema): Promise<Tema> {
    return this.temaService.update(Tema);
  }

  @Delete('/:id')
  @HttpCode(HttpStatus.NO_CONTENT)
  delete(@Param('id', ParseIntPipe) id: number){
    return this.temaService.delete(id);
  }

}
```
<br />

<h2>üë£ Passo 05 - Altera√ß√µes no M√≥dulo Auth</h2>

Vamos configurar as Classes **UsuarioLogin e AuthController**. Abaixo voc√™ confere o c√≥digo com os decorators implementados:

<h3>Classe UsuarioLogin - Entidade</h3>

Observe que embora a Classe UsuarioLogin n√£o tenha o papel de criar uma Tabela no Banco de dados, precisamos "decorar" os Atributos com o decorator **@ApiProperty()**, porqu√™ esta Classe √© utilizada no endpoint **/logar**. 

```javascript
import { ApiProperty } from "@nestjs/swagger"

export class UsuarioLogin {

    @ApiProperty() 
    public usuario: string

    @ApiProperty() 
    public senha: string

}
```

<h3>Classe AuthController - Controladora</h3>

Observe que na Classe Controladora AuthController **n√£o iremos adicionar o decorator @ApiBearerAuth()**, porqu√™ o √∫nico endpoint desta classe (**/logar**) √© um endpoint liberado, ou seja, n√£o necessita de um token. No decorator **@ApiTags() configuramos o nome do M√≥dulo como Usuario** para n√£o deixar este endpoint sozinho no Swagger.

```javascript
import { Body, Controller, HttpCode, HttpStatus, Post, UseGuards } from '@nestjs/common';
import { ApiTags } from '@nestjs/swagger';
import { LocalAuthGuard } from '../guard/local-auth.guard';
import { AuthService } from '../services/auth.service';
import { UsuarioLogin } from './../entities/usuariologin.entity';

@ApiTags('Usuario')
@Controller("/auth")
export class AuthController {
    constructor(private authService: AuthService) { }

    @UseGuards(LocalAuthGuard)
    @HttpCode(HttpStatus.OK)
    @Post('/logar')
    async login(@Body() user: UsuarioLogin): Promise<any> {
        return this.authService.login(user);
    }

}
```

<br />

<h2>üë£ Passo 06 - Altera√ß√µes no M√≥dulo Postagem</h2>

Vamos configurar as Classes **Postagem e PostagemController**. Abaixo voc√™ confere o c√≥digo com os decorators implementados:

<h3>Classe Postagem - Entidade</h3>

Observe que nos Atributos **tema e usuario** foi inserido o par√¢metro **type** dentro do decorator **@ApiProperty()**. Este par√¢metro indica ao Swagger o tipo do Objeto que ser√° armazenado no Atributo que est√° relacionado com outra Classe, que representa a Chave Estrangeira da Rela√ß√£o. Observe que nas **Classes Tema e Usuario este par√¢metro n√£o foi adicionado**. 

```javascript
import { ApiProperty } from "@nestjs/swagger";
import { IsNotEmpty } from "class-validator";
import { Column, Entity, ManyToOne, PrimaryGeneratedColumn, UpdateDateColumn } from "typeorm";
import { Tema } from "../../tema/entities/tema.entity";
import { Usuario } from './../../usuario/entities/usuario.entity';

@Entity({name: "tb_postagens"})
export class Postagem {

    @ApiProperty()  
    @PrimaryGeneratedColumn()    
    id: number

    @ApiProperty()  
    @IsNotEmpty()
    @Column({length: 100, nullable: false})
    titulo: string

    @ApiProperty()  
    @IsNotEmpty()
    @Column({length: 1000, nullable: false})
    texto: string

    @ApiProperty()  
    @UpdateDateColumn()
    data: Date
    
    @ApiProperty({ type: () => Tema })  
    @ManyToOne(() => Tema, (tema) => tema.postagem, {
        onDelete: "CASCADE"
    })
    tema: Tema

    @ApiProperty({ type: () => Usuario })  
    @ManyToOne(() => Usuario, (usuario) => usuario.postagem, {
        onDelete: "CASCADE"
    })
    usuario: Usuario

}
```

<h3>Classe PostagemController - Controladora</h3>

```javascript
import { Body, Controller, Delete, Get, HttpCode, HttpStatus, Param, ParseIntPipe, Post, Put, UseGuards } from "@nestjs/common";
import { ApiBearerAuth, ApiTags } from "@nestjs/swagger";
import { JwtAuthGuard } from "../../auth/guard/jwt-auth.guard";
import { Postagem } from "../entities/postagem.entity";
import { PostagemService } from "../services/postagem.service";

@ApiTags('Postagem')
@UseGuards(JwtAuthGuard)
@Controller("/postagens")
@ApiBearerAuth()
export class PostagemController {
  constructor(private readonly postagemService: PostagemService) { }

  @Get()
  @HttpCode(HttpStatus.OK)
  findAll(): Promise<Postagem[]> {
    return this.postagemService.findAll();
  }

  @Get('/:id')
  @HttpCode(HttpStatus.OK)
  findById(@Param('id', ParseIntPipe) id: number): Promise<Postagem> {
    return this.postagemService.findById(id);
  }

  @Get('/titulo/:titulo')
  @HttpCode(HttpStatus.OK)
  findByTitulo(@Param('titulo') titulo: string): Promise<Postagem[]> {
    return this.postagemService.findByTitulo(titulo);
  }

  @Post()
  @HttpCode(HttpStatus.CREATED)
  create(@Body() postagem: Postagem): Promise<Postagem> {
    return this.postagemService.create(postagem);
  }

  @Put()
  @HttpCode(HttpStatus.OK)
  update(@Body() postagem: Postagem): Promise<Postagem> {
    return this.postagemService.update(postagem);
  }

  @Delete('/:id')
  @HttpCode(HttpStatus.NO_CONTENT)
  delete(@Param('id', ParseIntPipe) id: number){
    return this.postagemService.delete(id);
  }

}
```

<br />

<h2>üë£ Passo 07 - Configurar o Swagger como P√°gina principal</h2>

Para finalizar, vamos configurar o Swagger como a p√°gina inicial da nossa API, ou seja, quando abrirmos o endere√ßo da nossa aplica√ß√£o no Navegador da Internet, veremos o Swagger como p√°gina inicial, ao inv√©s da mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/gEmFlF8.png" title="source: imgur.com" width="65%"/></div>

Vamos fazer algumas altera√ß√µes na **Classe AppController**, para que ela redirecione o endere√ßo principal (**http://localhost:4000/**) para o endere√ßo do Swagger (**http://localhost:4000/swagger**).

1. Abra o arquivo **app.controller.ts** localizado na pasta **src**.
2. Atualmente a **Classe AppController** deve estar com o conte√∫do abaixo (Hello World):

```javascript
import { Controller, Get } from '@nestjs/common';
import { AppService } from './app.service';

@Controller()
export class AppController {
  constructor(private readonly appService: AppService) {}

  @Get()
  getHello(): string {
    return this.appService.getHello();
  }
}
```

3. Substitua o c√≥digo atual por este:

```javascript
import { Controller, Get, Res } from '@nestjs/common';
import { ApiExcludeEndpoint } from '@nestjs/swagger';

@Controller()
export class AppController {
  constructor() {}

  @ApiExcludeEndpoint()
  @Get()
  async redirect(@Res() resposta: any) {
    return resposta.redirect('/swagger');
  }
}
```

Vamos entender as altera√ß√µes que foram realizadas na **Classe AppController**:

<div align="center"><img src="https://i.imgur.com/Zcyt5yd.png?1" title="source: imgur.com" /></div>

**Linha 6:** Removemos a Inje√ß√£o de Depend√™ncia da **Classe AppService**, porqu√™ n√£o iremos precisar do M√©todo **getHello()**.

**Linha 8:** Inserimos o decorator **@ApiExcludeEndpoint()**, porqu√™ n√£o iremos precisar deste endpoint no Swagger.

**Linha 9:** O decorator **@Get()** mapeia todas as Requisi√ß√µes **HTTP GET**, enviadas para o endere√ßo local (seu computador) **http://localhost:4000/** (endere√ßo principal da aplica√ß√£o). 

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Depois de efetuar o Deploy da aplica√ß√£o (publicar na nuvem), o endere√ßo principal da aplica√ß√£o ser√° o endere√ßo criado no servi√ßo de hospedagem. No Heroku, por exemplo, ser√° https://nomedoseuprojeto.herokuapp.com/* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 10:** Criamos o M√©todo (ass√≠ncrono) **redirect()**, com o decorator **@Res()**, que receber√° a Resposta da Requisi√ß√£o **GET**. Essa Resposta ser√° inserida na vari√°vel **resposta**.

**Linha 11:** Atrav√©s do M√©todo **redirect()**, vamos redirecionar a Requisi√ß√£o para o endpoint do Swagger (/swagger). Desta forma, toda a vez que uma Requisi√ß√£o do tipo **GET** chegar na aplica√ß√£o apontando para o endere√ßo principal: http://localhost:4000/, ela ser√° encaminhada para o endere√ßo do Swagger: http://localhost:4000/swagger/.

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe AppController</b></a></div>

<br />

<h2>üë£ Passo 08 - Registrar a Classe AppController no M√≥dulo AppModule</h2>

Para finalizar, vamos registrar a Classe **PostagemController** no M√≥dulo principal da  aplica√ß√£o, a Classe **AppModule**. 

1. Abra a Classe **AppModule**, localizada na pasta **src**.

2. No array **controllers** (Linha 29), adicione a **Classe AppController**, conforme indicado pela seta amarela na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/B0XytYJ.png" title="source: imgur.com" /></div>

<br />
  
| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *Se a Classe AppController, n√£o for registrada no M√≥dulo principal da aplica√ß√£o (AppModule), o endpoint do Swagger n√£o ficar√° dispon√≠vel.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte da Classe AppModule</b></a></div>

<br />

<h2>üë£ Passo 09 - Executar o Swagger</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/67GK3fX.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/OSMGswU.png" title="source: imgur.com" /></div>

4. Observe que foi criado um novo endpoint no endere√ßo **/** 

5. Abra o Navegador da Internet de sua prefer√™ncia e digite o endere√ßo: **http://localhost:4000/**

6. Se tudo estiver correto, ser√° aberta a janela abaixo

<div align="center"><img src="https://i.imgur.com/JKxWgN5.png?1" title="source: imgur.com" /></div>

Observe que o Swagger est√° Bloqueado (os cadeados ao lado dos endpoints est√£o cinza - desabilitado), precisamos **Autenticar (logar) um usu√°rio** para obter o **Token** e desta forma desbloquear o Swagger. Vamos criar um usu√°rio padr√£o e autenticar para obter o token.

1. Abra o Insomnia e crie o usu√°rio **root** com os dados da imagem abaixo:

<div align="center"><img src="https://i.imgur.com/R4hVWFV.png" title="source: imgur.com" /></div>

2. Fa√ßa login com este usu√°rio para obter o Token

<div align="center"><img src="https://i.imgur.com/uiPiCb0.png" title="source: imgur.com" /></div>

3. Copie apenas a parte codificada do token, ou seja, tudo menos a palavra **Bearer**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/VEL2eiT.png" title="source: imgur.com" /></div>

4. Volte para o Swagger e clique no bot√£o **Authorize**, localizado no lado direito da tela.

<div align="center"><img src="https://i.imgur.com/8YmwsLv.png" title="source: imgur.com" /></div>

5. Cole o token no campo **Value** e clique no bot√£o **Authorize**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/R6onfh2.png" title="source: imgur.com" /></div>

6. Ser√° exibida a mensagem **Authorized** (Autorizado!). Clique no bot√£o **Close**.

<div align="center"><img src="https://i.imgur.com/suHAPUF.png" title="source: imgur.com" /></div>

7. O Swagger est√° desbloqueado e pronto para uso. Observe que os cadeados est√£o todos na cor preta (desbloqueados).

<div align="center"><img src="https://i.imgur.com/RSqkqzk.png" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **IMPORTANTE:** O Token est√° configurado para durar 24h, ou seja, daqui a 24h voc√™ ter√° que repetir o processo acima para desbloquear o Swagger novamente.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="30px"/> <a href="" target="_blank"><b>C√≥digo fonte: Projeto Completo</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
