<h1>Projeto 02 - Blog Pessoal - Criar o Projeto no NestJS</h1>

<br />

O que veremos por aqui:

1. Apresenta√ß√£o do Projeto Blog Pessoal
2. Criar o Projeto no Nest
3. Configurar a Classe Main

<br />

<h2>1. O Projeto Blog Pessoal</h2>



O Projeto Blog Pessoal ser√° o nosso Projeto Guia no aprendizado do Framework NestJS e suas principais funcionalidades. Todo o c√≥digo que implementarmos no projeto Blog Pessoal servir√° de base para a constru√ß√£o do Projeto Integrador, que sempre receber√° novas funcionalidades depois que voc√™ adquirir os conhecimentos necess√°rios atrav√©s do Projeto Blog Pessoal. Veja o Diagrama de Classes do Projeto Blog Pessoal completo na figura abaixo:

<div align="center"><img src="https://i.imgur.com/FAub3ao.jpg" title="source: imgur.com" /></div>

<br />

O Projeto ser√° composto por 3 Recursos (*Conjunto de Classes e Interfaces respons√°veis por mapear um tipo de Objeto e persistir no Banco de dados Relacional*), que no Nest chamaremos de M√≥dulos, al√©m de 1 M√≥dulo auxiliar para gerir a seguran√ßa.

| M√≥dulo       | Descri√ß√£o                                                    |
| ------------ | ------------------------------------------------------------ |
| **Postagem** | M√≥dulo respons√°vel por definir o Objeto Postagem (posts) do Blog Pessoal. |
| **Tema**     | M√≥dulo respons√°vel por classificar as postagens atrav√©s do Objeto tema. |
| **Usuario**  | M√≥dulo respons√°vel por definir o Objeto Usuario, que ser√° utilizado pelo M√≥dulo Auth na implementa√ß√£o da seguran√ßa e na identifica√ß√£o do autor das postagens do Blog Pessoal. |
| **Auth**     | M√≥dulo respons√°vel pela seguran√ßa da aplica√ß√£o.              |

Cada M√≥dulo ir√° gerar uma tabela no Banco de dados da aplica√ß√£o. O **M√≥dulo Auth** n√£o criar√° Tabelas no Banco de dados da aplica√ß√£o, porqu√™ ela ter√° a fun√ß√£o de implementar a Seguran√ßa. Os M√≥dulos ser√£o implementados na mesma sequ√™ncia da tabela acima. Veja o Diagrama de Entidade e Relacionamentos do Projeto Blog Pessoal completo. com todas as tabelas que ser√£o geradas e os respectivos relacionamentos na figura abaixo:

<div align="center"><img src="https://i.imgur.com/53Ekpkw.png" title="source: imgur.com" /></div>

Antes de come√ßarmos a implementar as Classes, vamos criar o nosso Projeto Nest, instalar alguns pacotes e configurar a Classe Main.

<br />

<h2>üë£ Passo 01 - Configurar o VSCode para utilizar Caminhos Relativos</h2>



Existem 2 formas de se importar uma Classe ou Pacote dentro do Nest:

- A primeira √© utilizando **Caminho Absoluto** (path), que fornece o **endere√ßo completo** de um arquivo ou diret√≥rio, come√ßando pela **pasta raiz do projeto**. Independentemente da sua localiza√ß√£o atual, um caminho absoluto descreve cada passo que voc√™ deve seguir para chegar ao local de destino.

**Exemplo:**

	**Caminho Absoluto:** *src/bcrypt/bcrypt*

- A segunda √© utilizando **Caminho Relativo** (path), que fornece o **endere√ßo completo** de um arquivo ou diret√≥rio, come√ßando pela **pasta atual**, sem indicar as pastas anteriores at√© chegar na pasta raiz do projeto. Em outras palavras, cont√©m um **endere√ßo parcial** relativo ao diret√≥rio ao qual est√° vinculado.

**Exemplo:**	

	**Caminho Relativo:** *./bcrypt/bcrypt*

Como o **Jest** (Framework de testes), que utilizaremos no final do projeto para implementar testes automatizados, n√£o aceita Classes e Pacotes importados com o caminho absoluto, para n√£o termos o trabalho de mudar todas Classes no momento de escrever os testes automatizados, j√° vamos configurar o VSCode para sempre importar Classes e Pacotes atrav√©s do caminho relativo.

Vamos alterar 2 configura√ß√µes no VSCode para nos auxiliar no Desenvolvimento da aplica√ß√£o Nest:

1. Abra as **Configura√ß√µes do VSCode** atrav√©s do menu **File ü°™ Preferences ü°™ Settings** (Arquivo ü°™ Prefer√™ncias ü°™ Configura√ß√µes)

   <div align="center"><img src="https://i.imgur.com/HHV5tH8.png" title="source: imgur.com" /></div>

2. Ser√° aberta janela do **Settings** (Configura√ß√µes)

   <div align="center"><img src="https://i.imgur.com/FAIEW4J.png" title="source: imgur.com" /></div>

3. No item **Search Settings** (Procurar Configura√ß√µes), digite: **Preferences: Import Module Specifier**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/tU5rygR.png" title="source: imgur.com" /></div>

4. Altere as propriedades **JavaScript ‚Ä∫ Preferences: Import Module Specifier** e **TypeScript ‚Ä∫ Preferences: Import Module Specifier** para **relative**, conforme indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8Vwvvco.png" title="source: imgur.com" /></div>

5. Esta op√ß√£o "for√ßa" o VSCode a toda vez que importar um pacote TypeScript ou do Nest utilizar o Caminho Relativo ao inv√©s de utilizar o Caminho Absoluto. 

<br />

<h2>üë£ Passo 02 - Criar o Projeto com o NestCLI</h2>



1. No **VSCode**, abra a pasta **nestjs** (criada na √Årea de trabalho do Windows), atrav√©s do menu **File ü°™ Open Folder...** (Abrir Pasta...)

<div align="center"><img src="https://i.imgur.com/TgvVW26.png" title="source: imgur.com" /></div>

2. Abra o **Terminal do VSCode** atrav√©s do menu **Terminal ü°™ New Terminal** (caso n√£o esteja aberto), ou utilize o atalho **( CTRL + SHIFT + ' )**. 

<div align="center"><img src="https://i.imgur.com/4rdobXK.png?1" title="source: imgur.com" /></div>

3. Ser√° aberta a tela do **Power Shell** na parte inferior da janela do **VSCode**. Certifique-se de que voc√™ esteja dentro da pasta **nestjs** como mostra a figura abaixo:

<div><img src="https://i.imgur.com/SdFWNCZ.png" title="source: imgur.com" /></div>

4. Caso n√£o esteja, feche o Terminal e abra novamente ou abra a pasta novamente.
5. Digite o comando ***nest new <nome do projeto>***, onde <nome do projeto> √© o nome do seu projeto. O nome do projeto ser√° **blogpessoal**. 

```bash
nest new blogpessoal
```

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes! Observe que o nome do projeto est√° escrito em letras min√∫sculas, sem espa√ßos em branco, acentos ou caracteres especiais.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

6. O **Nest CLI** criar√° a estrutura de pastas, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/zTloJ5J.png" title="source: imgur.com" /></div>

7. Na sequ√™ncia, o NestCLI perguntar√° **Qual o Gerenciador de Pacotes que voc√™ deseja utilizar?** Mantenha o **npm** selecionado e pressione tecla **enter** do seu teclado (No Terminal n√£o se utiliza o mouse).

<div align="center"><img src="https://i.imgur.com/uvo9mbB.png" title="source: imgur.com" /></div>

8. Ao finalizar a cria√ß√£o do projeto, ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/kCQbElH.png" title="source: imgur.com" /></div>

9. O Projeto **blogpessoal** est√° criado!

10. Para n√£o ficarmos com v√°rios projetos abertos no VSCode, vamos abrir apenas pasta **blogpessoal**, atrav√©s do menu **File ü°™ Open Folder...** (Abrir Pasta...)

<div align="center"><img src="https://i.imgur.com/l9KGMpo.png" title="source: imgur.com" /></div>

11. Selecione a pasta **blogpessoal** que foi criada dentro da pasta **nestjs** e clique no bot√£o **Selecionar pasta**.

<div align="center"><img src="https://i.imgur.com/mQLtm9L.png" title="source: imgur.com" /></div>

12. Observe que na **Guia Explorer** (lado esquerdo da tela) ficar√° vis√≠vel apenas o projeto **Blog Pessoal**.

<div align="center"><img src="https://i.imgur.com/D75uaF2.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 03 - Instalar os primeiros pacotes</h2>



Para configurarmos o Banco de dados da aplica√ß√£o, precisamos instalar os pacotes **TypeORM**, **MySQL2** e **Validation** atrav√©s do NPM, via linha de comando. 

1. No Terminal do VSCode, dentro da pasta do projeto (**blogpessoal**), digite o comando abaixo para instalar os pacotes **TypeORM** e o **MySQL2** :

```bash
npm install --save @nestjs/typeorm typeorm mysql2
```

2. Ao finalizar a instala√ß√£o, o Terminal exibir√° uma mensagem semelhante a figura abaixo:

<div align="center"><img src="https://i.imgur.com/sqzx1Hc.png?1" title="source: imgur.com" /></div>

3. No Terminal do VSCode, digite o comando abaixo para instalar o pacote **Validation**

```bash
npm install --save class-validator class-transformer
```

4. Ao finalizar a instala√ß√£o, o Terminal exibir√° uma mensagem semelhante a figura abaixo:

<div align="center"><img src="https://i.imgur.com/pry0O4y.png?1" title="source: imgur.com" /></div>

<br />


| Pacote           | Descri√ß√£o                                                    |
| ---------------- | ------------------------------------------------------------ |
| **Validator**    | Pacote que fornece um conjunto de decorators que permitem validar os atributos das Classes Entidade (veremos mais adiante). <br />**Exemplo:** No atributo e-mail o validation checar√° se o usu√°rio digitou realmente um endere√ßo de e-mail no atributo |
| **Transformer**  | Pacote utilizado para mapear os Objetos Simples (Objetos n√£o criados por uma Classe com M√©todo Construtor) em Objetos de Classe, permitindo que sejam aplicadas as transforma√ß√µes (valida√ß√µes) necess√°rias, atrav√©s de fun√ß√µes TypeScript, geralmente Arrow Functions. |
| **TypeORM**      | Pacote respons√°vel por conectar e criar as tabelas no Banco de dados, al√©m de interagir com os  Objetos persistidos no Bancos de dados, atrav√©s do Mapeamento Objeto Relacional (ORM - Object Relation Mapping). Para mais detalhes, veja o Cookbook sobre <a href="03.md" target="_blank">TypeORM</a>. |
| **MySQL Driver** | Pacote respons√°vel por criar a conex√£o entre nossa aplica√ß√£o e o Banco de Dados MySQL. Se o SGBD (PostgreSQL, SQL Server, entre outros), for trocado no futuro precisaremos instalar um novo pacote com o driver espec√≠fico para o novo SGBD. |

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://sidorares.github.io/node-mysql2/docs" target="_blank"><b>Documenta√ß√£o: <i>Driver MySQL2</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/6knlnLz.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/typestack/class-transformer" target="_blank"><b>Documenta√ß√£o: <i>Pacote Class Transformer</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/6knlnLz.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/typestack/class-validator" target="_blank"><b>Documenta√ß√£o: <i>Pacote Class Validator</i></b></a></div>

<br />

<h2>üë£ Passo 04 - Configurar a Classe Main</h2>



A Classe **Main** √© a Classe principal da nossa aplica√ß√£o. Nesta Classe definimos algumas configura√ß√µes sobre como a nossa aplica√ß√£o ser√° inicializada. Durante o desenvolvimento do projeto, faremos outras atualiza√ß√µes e configura√ß√µes nesta Classe.

1. Abra a Classe **main.ts**, localizada na pasta **src** como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/UUo7mFN.png" title="source: imgur.com" /></div>

2. Implemente as atualiza√ß√µes na Classe **Main** conforme a imagem abaixo.

<div align="center"><img src="https://i.imgur.com/Q5TLfxR.png" title="source: imgur.com" /></div>

**Vamos detalhar as altera√ß√µes realizadas:**

**Linha 1:** Importa√ß√£o da Classe **ValidationPipe** do Nest.

**Linha 8:** Configura√ß√£o do fuso hor√°rio. Atrav√©s do comando **process.env** estamos enviando uma vari√°vel de ambiente chamada **TZ** (Time Zone), com o conte√∫do **-03:00** (hor√°rio de Bras√≠lia no padr√£o UTC - Coordenadas Universais de Tempo). Sem esta configura√ß√£o, o Nest mostrar√° os atributos do tipo hora com 3 horas √† frente (12:00 seria exibido como 15:00 por exemplo), porqu√™ o Nest trabalha com o fuso hor√°rio padr√£o UTC 00:00 e o Brasil est√° √† UTC -03:00 em rela√ß√£o a Greenwich.

**Linha 10:** A Classe **ValidationPipe** est√° sendo habilitada em todas as Requisi√ß√µes HTTP. Desta forma, atrav√©s das Bibliotecas **Class Validator** e **Class Transformer**, criaremos regras de valida√ß√£o dos atributos das Classes Entidade (Model). Estas regras de valida√ß√£o ser√£o checadas em todas as Requisi√ß√µes, especialmente as do tipo POST e PUT,  cujo os atributos possuam regras de valida√ß√£o definidas, no momento em que os dados forem enviados no Corpo da  Requisi√ß√£o.

> As regras de valida√ß√£o dos dados no Nest s√£o criadas pelos **Pipes**. 
>
> **Pipes** no Nest s√£o o canivete su√≠√ßo do processamento de dados. Eles facilitam a transforma√ß√£o, a sanitiza√ß√£o (higieniza√ß√£o) e a valida√ß√£o cont√≠nua dos dados recebidos √† medida que eles atravessam v√°rias partes do seu aplicativo. Isso garante que os dados estejam em conformidade com requisitos especificados na Classe Entidade antes de serem usados nas Classes Controladoras ou enviados de volta como Respostas das Requisi√ß√µes.

**Linha 11:** Habilita a propriedade **Cross Origin Resource Sharing** (Cors) em toda a aplica√ß√£o.

> **Cross Origin:** Indica que todas as Classes Controladoras aceitar√£o todas as requisi√ß√µes realizadas de fora do Dom√≠nio (atualmente o seu dom√≠nio √© **localhost** e futuramente o seu dom√≠nio ser√° o endere√ßo da sua aplica√ß√£o na nuvem), ao qual ela pertence. 
>
> Essa propriedade √© essencial  para que o Frontend, que voc√™ ir√° desenvolver no pr√≥ximo Bloco, tenha acesso √† sua aplica√ß√£o (O termo t√©cnico √© consumir a API). Al√©m de liberar todas as **Origens das requisi√ß√µes** (**origins**), libera tamb√©m o acesso as propriedades do **Cabe√ßalho das Requisi√ß√µes** (**allowedHeaders**), que em alguns casos trazem informa√ß√µes essenciais para o correto funcionamento da aplica√ß√£o. 
>
> Um bom exemplo √© o **Token de Seguran√ßa**, que veremos mais √† frente em Seguran√ßa da aplica√ß√£o, que tem a fun√ß√£o de liberar o acesso √† um endpoint espec√≠fico. 
>
> **Em produ√ß√£o, recomenda-se fixar o endere√ßo do deploy do front-end no M√©todo enableCors().**
>
> **CORS na Pr√°tica**
>
> Enquanto voc√™ estiver rodando o Back-end e o Front-end Localmente (localhost), n√£o haver√° nenhum problema, como mostra a imagem abaixo:
>
> <div align="center"><img src="https://i.imgur.com/3xYVwLt.png" title="source: imgur.com" /></div>
>
> Todas as Requisi√ß√µes tem como origem o mesmo Servidor (localhost). Agora ao efetuar o Deploy, o seu Front-end estar√° em um Servidor e o seu Back-end estar√° em outro:
>
> <div align="center"><img src="https://i.imgur.com/KKWo2Kv.png" title="source: imgur.com" /></div>
>
> No exemplo acima, o Front-end est√° em um servidor diferente do Back-end, logo quando o Front-end enviar uma Requisi√ß√£o para o Back-end, voc√™ receber√° uma mensagem de erro de CORS. Para evitar este erro e permitir o recebimento de Requisi√ß√µes HTTP de outras origens (servidores), habilitamos o CORS em todas as Classes Controladoras atrav√©s da **Classe Program**.
>
> <div align="center"><img src="https://i.imgur.com/GFqpXeG.png" title="source: imgur.com" /></div>
>
> Com o CORS habilitado, nosso Back-end estar√° pronto para receber Requisi√ß√µes do Front-end.

**Linha 12:** Como o React tamb√©m utiliza a porta 3000, vamos alterar a porta do Nest para **4000**.

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/pipes" target="_blank"><b>Documenta√ß√£o: <i>Pipes</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/security/cors#getting-started" target="_blank"><b>Documenta√ß√£o: <i>CORS - Cross Origin Resource Sharing</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/01_criar_projeto/blogpessoal/src/main.ts" target="_blank"><b>C√≥digo fonte da Classe main.ts</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/01_criar_projeto" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
