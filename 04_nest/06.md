<h1>Projeto 02 - Blog Pessoal - M√≥dulo Postagem</h1>

O que veremos por aqui:

1. Apresenta√ß√£o do M√≥dulo Postagem
2. Criar a estrutura de Pastas do M√≥dulo Postagem
3. Criar a Classe Entidade Postagem
4. Registrar a Classe Postagem nos M√≥dulos PostagemModule e AppModule

<h2>1. O M√≥dulo Postagem</h2>

Nesta etapa vamos come√ßar a construir o M√≥dulo Postagem. Veja o Diagrama de Classes abaixo: 

<div align="center"><img src="https://i.imgur.com/EIm56Zk.png" title="source: imgur.com" width="75%"/></div>

<br />

Primeiro vamos construir a **Classe Entidade Postagem (Model no modelo MVC)**, que ser√° utilizada como modelo para construir a tabela **tb_postagens** (Entidade) dentro do nosso Banco de dados **db_blogpessoal**. Os campos (Atributos) da tabela ser√£o os mesmos que est√£o definidos no Diagrama de Classes acima. Na pr√≥xima etapa vamos come√ßar a construir as Classes **PostagemService** (Regras de neg√≥cio da aplica√ß√£o) e **PostagemController** (Os m√©todos do CRUD descritos no Diagrama de Classes).

> **CRUD:** √â um acr√¥nimo para **Create** (Persistir dados na tabela), **Read** (Pesquisar dados na tabela), **Update** (Atualizar dados da tabela) e **Delete** (Apagar dados da tabela), ou seja, s√£o os M√©todos para interagirmos com as tabelas do nosso Banco de dados.

Depois de criar a Classe Entidade Postagem, vamos executar o projeto Blog Pessoal no Nest. Ap√≥s a execu√ß√£o veremos que ser√° criado dentro do Banco de dados **db_blogpessoal**, a tabela **tb_postagens**. Veja abaixo como ficar√° a estrutura da nossa tabela atrav√©s do **Diagrama de Entidade e Relacionamentos (DER)** da tabela tb_postagens:

<div align="center"><img src="https://i.imgur.com/0Q38YWr.jpg" title="source: imgur.com" width="50%"/></div>

O **Dicion√°rio de dados da nossa tabela tb_postagens** ser√° o seguinte:

| Atributo   | Tipo de dado  | Descri√ß√£o                                         | Chave |
| ---------- | ------------- | ------------------------------------------------- | ----- |
| **id**     | INT           | Identificador √∫nico                               | PK    |
| **titulo** | VARCHAR(100)  | T√≠tulo da postagem                                |       |
| **texto**  | VARCHAR(1000) | Conte√∫do da postagem                              |       |
| **data**   | DATETIME(6)   | Data e hora da publica√ß√£o/atualiza√ß√£o da postagem |       |

<h2>üë£ Passo 01 - Criar o M√≥dulo Postagem</h2>

O **M√≥dulo**, no contexto Nest, √© uma pasta utilizada para organizar a estrutura da nossa aplica√ß√£o em componentes. Para cada tabela que inserirmos no Banco de dados da nossa aplica√ß√£o ser√° necess√°rio criar um M√≥dulo para interagir com os dados da tabela (CRUD). O M√≥dulo tamb√©m √© utilizado para adicionar outras funcionalidades na sua aplica√ß√£o, como a seguran√ßa, por exemplo.

O M√≥dulo √© composto basicamente por 4 Classes:

| Classes        | Descri√ß√£o                                                    |
| -------------- | ------------------------------------------------------------ |
| **Module**     | Classe principal do M√≥dulo, onde s√£o definidas as Estruturas de dados, Relacionamentos e Depend√™ncias. As Classes Entidade, Service e Controller obrigatoriamente devem ser Registradas na Classe M√≥dulo, assim como a Classe M√≥dulo tamb√©m deve ser registrada no M√≥dulo raiz da aplica√ß√£o (**AppModule**). |
| **Entidade**   | Classe respons√°vel pela abstra√ß√£o dos nossos Objetos em Registros (linhas) nas Tabelas do Banco de dados. As Classes Entidade representam os Objetos que ser√£o persistidos no Banco de dados. As Classes Entidade tamb√©m s√£o utilizadas pelo TypeORM como modelo para criar automaticamente as nossas tabelas no Banco de dados. |
| **Service**    | Classe respons√°vel por implementar as regras de neg√≥cio da aplica√ß√£o e o tratamento dos dados, antes de serem persistidos no Banco de dados. <br />**Exemplo:** N√£o √© permitido salvar no Banco de dados 2 usu√°rios com o mesmo endere√ßo de e-mail. <br />O M√©todo Cadastrar Usu√°rio implementaria esta regra para checar se o e-mail j√° foi cadastrado, antes de Salvar os dados do novo usu√°rio. |
| **Controller** | Classe respons√°vel por receber todas as Requisi√ß√µes HTTP (HTTP Request), enviadas por um Cliente HTTP (Client de testes ou o front-end), para a nossa aplica√ß√£o e Responder (HTTP Response) as requisi√ß√µes de acordo com o resultado do processamento da requisi√ß√£o na Classe de Servi√ßo. |

A estrutura de M√≥dulo descrita acima √© a estrutura b√°sica. Dependendo das necessidades da aplica√ß√£o, pode ser necess√°rio gerar mais de uma Classe Entidade, Service e Controller. Pode ser necess√°rio tamb√©m a implementa√ß√£o de Classes auxiliares, com fun√ß√µes espec√≠ficas dentro do M√≥dulo. Apenas a Classe M√≥dulo ser√° √∫nica dentro do M√≥dulo. Para utilizar uma Classe Servi√ßo ou auxiliar em outro M√≥dulo √© necess√°rio registrar a exporta√ß√£o na Classe M√≥dulo.

Vamos criar o nosso primeiro M√≥dulo:

1. Na pasta **src**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/XtQcMuL.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **postagem**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/eRaRCwg.png" title="source: imgur.com" /></div>

3. Caso voc√™ precise alterar o nome da pasta, clique com o bot√£o direito do mouse e clique na op√ß√£o **Rename** (Renomear) como mostra a figura abaixo. Digite o novo nome da pasta e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/oNO8mqB.png" title="source: imgur.com" /></div>

Na sequ√™ncia, vamos criar a pasta **entities**, dentro do nosso **M√≥dulo Postagem** (pasta postagem):

1. Na pasta **postagem**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

<div align="center"><img src="https://i.imgur.com/uCdfiD7.png" title="source: imgur.com" /></div>

2. O nome da pasta ser√° **entities**, como mostra a figura abaixo. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/GntV6yy.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a Classe Entidade. Um erro muito comum √© criar a pasta entities fora da pasta do M√≥dulo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>üë£ Passo 02 - Criar a Classe PostagemModule na pasta Postagem</h2>

Agora vamos criar a Classe **PostagemModule** que chamaremos de **postagem.module.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="220px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe Module. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest *(nome_do_modulo.tipo_da_classe.ts)* para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta postagem**, que foi criada dentro da pasta **src**, como mostra a figura abaixo, e clique na op√ß√£o **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/GMaZPav.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **postagem.module.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/9ZigO6B.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 03 - Criar a Classe Postagem na pasta Entities</h2>

Antes de implementarmos o c√≥digo da Classe **PostagemModule**, vamos criar a Classe Entidade **Postagem** que chamaremos de **postagem.Entidade.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="220px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe Entidade. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest *(nome_do_modulo.tipo_da_classe.ts)* para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta entities**, que foi criada dentro da pasta **postagem**, como mostra a figura abaixo, e clique na op√ß√£o **New File** (Novo Arquivo).

<div align="center"><img src="https://i.imgur.com/3epbRgA.png" title="source: imgur.com" /></div>

2. O nome do arquivo ser√° **postagem.entity.ts**, como mostra a figura abaixo. Ap√≥s digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/ttqqIuG.png" title="source: imgur.com" /></div>

Agora vamos criar o c√≥digo da Classe **Postagem**, como mostra a figura abaixo:

<div align="left"><img src="https://i.imgur.com/stg9rcJ.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Importamos o pacote **Validation** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe Postagem.

**Linha 2:** Importamos o pacote **TypeORM** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe Postagem.

**Linha 4:** O decorator **@Entity** indica que esta classe define uma entidade, ou seja, ela ser√° utilizada para gerar uma tabela no Banco de dados da aplica√ß√£o. O par√¢metro name, indica o nome da tabela no Banco de dados (**tb_postagens**). Caso este par√¢metro n√£o seja declarado, o TypeORM criar√° a tabela com o mesmo nome da Classe Entidade (Postagem). 

Observe que o nome da Tabela segue o padr√£o **tb_nome_da_tabela** (tb_postagens). O prefixo **tb** indica que se trata de uma Table (Tabela). O nome da Tabela √© recomendado que seja **o mesmo da Classe Entidade** (postagem), em **letras min√∫sculas**, **sem espa√ßos em branco ou caracteres especiais e acentos**. 

**Linhas 7, 12, 16 e 19:** foram criados os Atributos da Classe Postagem, que foram definidos no Diagrama de Classes acima. Veja na tabela abaixo a convers√£o de **Tipo de dados TypeScript ü°™ MySQL**

| Atributo   | Tipo de dado TypeScript                                 | Tipo de dado MySQL |
| ---------- | ------------------------------------------------------------ | ------------------ |
| **id**     | <i>number</i> | INT             |
| **titulo** | <i>string</i> | VARCHAR(100)       |
| **texto**  | <i>string</i> | VARCHAR(1000)      |
| **data**   | <i>Date</i> | DATETIME(6)               |

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">**DICA:** *Para relembrar os tipos de dados do TypeScript, <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html">clique aqui</a> e explore os principais tipos de dados oferecidos pelo TypeScript.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Observe que acima de cada atributo foram adicionados alguns **decorators**. Estes decorators tem a fun√ß√£o de configurar as propriedades dos atributos e criar valida√ß√µes para os dados que ser√£o inseridos no Objeto (tamanho, formato e etc)

**Linhas 7:** O decorator **@PrimaryGeneratedColumn** inidica que o Atributo id ser√° a **Chave Prim√°ria** (Primary Key - PK) da Tabela **tb_postagens** e que esta **Chave Prim√°ria** ser√° gerada pelo Banco de dados, atrav√©s da propriedade **auto-incremento** (auto-increment), que gera uma sequ√™ncia num√©rica iniciando em 1.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *N√£o confundir o auto-incremento do Banco de Dados que inicia em 1 com o indice de um array (Vetor ou Matriz) que inicia em 0.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Nas linhas 10 e 14:** O decorator **@IsNotEmpty** faz parte do pacote **Validation** e define que o valor do Atributo n√£o pode ser vazio, ou seja, precisa ser enviado algum valor. 

**Nas linhas 11 e 15:** O decorator **@Column** define que o atributo ser√° inserido na estrutura da Tabela, ou seja, se voc√™ n√£o declarar o decorator **@Column** (exceto nos atributos **Chave Prim√°ria** e **Timestamp**), o atributo n√£o ser√° inserido na  estrutura da tabela. 

<h4>Propriedades do decorator @Column</h4>

| Propriedade  | Descri√ß√£o                                                    |
| ------------ | ------------------------------------------------------------ |
| **length**   | Define o tamanho do atributo string no Banco de dados.       |
| **nullable** | Define se o atributo pode ser nulo (null). <br />**false** = N√£o pode ser nulo<br />**true** = pode ser nulo |

Existem outras propriedades que podem ser consultadas na documenta√ß√£o do **TypeORM** nos links abaixo.

**Na linha 18:** O decorator **@UpdateDateColumn** configura o atributo **data** como **Timestamp**, ou seja, o Nest se encarregar√° de obter a data e a hora do Sistema Operacional e inserir no atributo **data** toda vez que um Objeto da Classe Postagem for criado ou atualizado. 

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database" target="_blank"><b>Documenta√ß√£o: <i>Banco de dados com Nest</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/entities" target="_blank"><b>Documenta√ß√£o: <i>Entidades no TypeORM</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/6knlnLz.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/typestack/class-validator" target="_blank"><b>Documenta√ß√£o: <i>Pacote Validation</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="3%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/03_Entity_Postagem/blogpessoal/src/postagem/entities/postagem.entity.ts" target="_blank"><b>C√≥digo fonte da Classe Postagem</b></a>


<br />

<h2>üë£ Passo 04 - Registrar a Classe Postagem na Classe PostagemModule</h2>

Vamos implementar o c√≥digo da Classe **PostagemModule** e registrar a Classe **Postagem** no M√≥dulo Postagem. O c√≥digo da Classe **Postagem** ser√° implementado conforme a figura abaixo:

<div align="left"><img src="https://i.imgur.com/oPmx2MK.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Importamos o pacote **Common** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe PostagemModule.

**Linha 2:** Importamos o pacote **TypeORM** com os respectivos **decorators**, utilizados na implementa√ß√£o da Classe PostagemModule.

**Linha 3:** Importamos a Classe **Postagem**, criada anteriormente. Observe que na importa√ß√£o da Classe foi utilizado o caminho relativo (**./entities/postagem.entity.ts**) ao inv√©s do caminho absoluto (**src/entities/postagem.entity.ts**) por quest√µes de boas pr√°ticas. 

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Se uma Classe for importada com o caminho absoluto, os testes da aplica√ß√£o com o framework Jest n√£o ser√£o executados. O Jest n√£o reconhece caminho absoluto, apenas caminho relativo* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 5:** O decorator **@Module** indica que esta classe ser√° a Classe principal do M√≥dulo, ou seja, nela registraremos todas as Classes (Entidade, Service e Controller) criadas dentro do M√≥dulo. 

**Linha 6:** No array **imports** vamos importar todas as **Classes Entidade** (Model) do M√≥dulo, atrav√©s do M√©todo **forFeature**, da Classe **TypeOrmModule**. Observe que importamos a Classe Entidade **Postagem**.

**Linha 7:** No array **providers** vamos importar todas as **Classes de Servi√ßo** do M√≥dulo. Como n√£o temos nenhuma Classe de servi√ßo implementada, vamos deix√°-lo vazio.

**Linha 8:** No array **controllers** vamos importar todas as **Classes Controladora** do M√≥dulo. Como n√£o temos nenhuma Classe controladora implementada, vamos deix√°-lo vazio.

**Linha 9:** No array **exports** vamos importar todas as **Classes** do M√≥dulo que precisam estar dispon√≠veis para outros M√≥dulos. Como teremos que registrar a Classe **Postagem** no M√≥dulo principal da aplica√ß√£o (**AppModule**), vamos inserir no array a Classe do TypeORM utilizada para registrar a Classe Postagem (**TypeOrmModule**).

**Linha 11:** Exportamos a Classe **PostagemModule**. Desta forma, o M√≥dulo **PostagemModule** ficar√° dispon√≠vel para ser registrado no M√≥dulo principal **AppModule**.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a>
<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/03_Entity_Postagem/blogpessoal/src/postagem/postagem.module.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemModule</b></a>

<br />

<h2>üë£ Passo 05 - Registrar a Classe Postagem na Classe AppModule</h2>

Para finalizar, vamos registrar a Classe **Postagem** no M√≥dulo principal da  aplica√ß√£o (**AppModule**). 

1. Abra a Classe **AppModule**, localizada na pasta **src**, conforme indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/wd1xAZQ.png" title="source: imgur.com" /></div>

2. Implemente as duas altera√ß√µes, indicadas pelas setas na imagem abaixo:

<div align="left"><img src="https://i.imgur.com/MMeneU1.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 3:** Importamos a Classe **Postagem**, criada anteriormente. Observe que na importa√ß√£o da Classe foi utilizado o caminho relativo (**./postagem/entities/postagem.entity.ts**) ao inv√©s do caminho absoluto (**src/postagem/entities/postagem.entity.ts**) por quest√µes de boas pr√°ticas. 

**Linha 14:** No array **entities** vamos importar todas as **Classes Entidade** (Model) do m√≥dulo. Insira no array a Classe **Postagem**.

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Todas as Classes Entidade devem ser registradas no M√≥dulo principal da aplica√ß√£o (AppModule), caso contr√°rio a Tabela n√£o ser√° criada no Banco de dados.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/03_Entity_Postagem/blogpessoal/src/app.module.ts" target="_blank"><b>C√≥digo fonte da Classe AppModule</b></a></div>

<br />

<h2>üë£ Passo 06 - Executar o projeto</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/JgNkmDv.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso ele n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/nEAKeP5.png" title="source: imgur.com" /></div>

<br /><br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="30px"/> <a href="mudar" target="_blank"><b>C√≥digo fonte do projeto</b></a>
<br />

<h2>üë£ Passo 07 - Checar se a Tabela foi criada no Banco de Dados</h2>

Vamos checar no Banco de Dados **db_blogpessoal** se a Tabela **tb_postagens** foi criada.

1. Abra o MySQL Workbench
2. Na janela **Navigator**, Clique no bot√£o <img src="https://i.imgur.com/UANRDni.png" title="source: imgur.com" /> (Atualizar)

<div align="center"><img src="https://i.imgur.com/G7z3ED6.png" title="source: imgur.com" /></div>

3. Verifique no Banco de dados **db_blogpessoal** se a tabela **tb_postagens** foi criada corretamente, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/BQ2tMkw.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="3%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/03_Entity_Postagem" target="_blank"><b>C√≥digo fonte do Projeto</b></a></div>

<br />

<h2>Anexo I - Erros comuns</h2>

| Erro                                     | Descri√ß√£o                                                    |
| ---------------------------------------- | ------------------------------------------------------------ |
| **No metadata for 'Postagem' was found** | A Classe Postagem n√£o foi registrada no M√≥dulo AppModule. Verifique se voc√™ fez o registro da Classe Postagem na Classe AppModule e na Classe PostagemModule. |

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>