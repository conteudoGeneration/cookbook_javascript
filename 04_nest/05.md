<h1>Projeto 02 - Blog Pessoal - Configurar o Banco de dados</h1>



O que veremos por aqui:

1. Criar o Banco de dados no MySQL
2. Configurar o Banco de dados na Classe AppModule
3. Executar a Aplica√ß√£o

<br />

<h2>üë£ Passo 01 - Criar o Banco de Dados</h2>



O Nest n√£o consegue criar o Banco de dados sozinho por padr√£o, por isso precisamos criar o Banco de dados dentro do MySQL antes de configuramos a conex√£o na aplica√ß√£o.

1. Abra o **MySQL Workbench**

2. Abra uma nova **Query** 

3. Utilize o comando abaixo para criar o Banco de dados **db_blogpessoal** 


```sql
CREATE DATABASE db_blogpessoal;
```

4. Execute a Query clicando no primeiro raio <img src="https://i.imgur.com/9FtJQlk.png" title="source: imgur.com" width="30px"/>.
5. Ao executar a query, ser√° criado o **Banco de Dados**. 
6. Na janela **Navigator**, localizada no lado esquerdo da tela, ser√° exibido o Banco de dados **db_blogpessoal** na lista de **Schemas**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/YtmyBSY.png" title="source: imgur.com" width="50%"/></div>

7. Caso o Banco de dados **db_blogpessoal** n√£o esteja aparecendo na lista, clique no bot√£o <img src="https://i.imgur.com/YGV5zIh.png" title="source: imgur.com" width="4%"/> **Refresh**, localizado ao lado direito da palavra **Schemas**, na janela **Navigator**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/kVeQuNX.png" title="source: imgur.com" width="50%"/></div>

<br />

<div align="left"><img src="https://i.imgur.com/Mh2KzWe.png" title="source: imgur.com" width="4%"/> <a href="https://www.w3schools.com/sql/sql_create_db.asp" target="_blank"><b>Documenta√ß√£o: <i>Create database - W3Schools</i></b></a></div>


<br />

<h2>üë£ Passo 02 - Configurar a Conex√£o com o Banco de dados</h2>



Diferentemente do projeto **Hello World**, no **Projeto Blog Pessoal** utilizaremos um banco de dados para persistir os objetos. Isso significa que os dados dos objetos ser√£o armazenados como registros (linhas) nas tabelas do banco.

A primeira coisa que faremos √© configurar a conex√£o com o banco de dados **db_blogpessoal**. Essa configura√ß√£o ser√° realizada na classe **app.module.ts**, localizada na pasta **src**, conforme ilustrado na figura abaixo:

<div align="center"><img src="https://i.imgur.com/ROTAiMw.png" title="source: imgur.com" /></div>

1. Abra a Classe **app.module.ts**

<div align="center"><img src="https://i.imgur.com/t5KJ16u.png" title="source: imgur.com" /></div>

2. A sua classe estar√° com o c√≥digo semelhante a imagem acima. 
2. Antes de configurar o Banco de dados, vamos remover alguns itens da Classe **AppModule**.

* Apagar as linhas 2 e 3
* Na linha 7 apagar a Classe **AppController**
* Na linha 8 apagar a Classe **AppService**

4. A Classe **AppModule** ficar√° igual a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/aw6lv99.png" title="source: imgur.com" /></div>

5. Ap√≥s a remo√ß√£o dos itens, vamos implementar a configura√ß√£o do Banco de dados igual a imagem abaixo: 

<div align="center"><img src="https://i.imgur.com/big6Uwe.png" title="source: imgur.com" /></div>

Vamos detalhar as altera√ß√µes realizadas:

**Linha 2:** Importamos o pacote **TypeORMModule**, previamente instalado no projeto.

**Linha 5:** Adicionamos o m√≥dulo **TypeORMModule** ao array **imports**. Neste m√≥dulo, utilizaremos o m√©todo **forRoot()** para configurar a conex√£o com o banco de dados.

**Linha 7:** A propriedade **type** especifica o tipo de banco de dados que ser√° utilizado, neste caso, **MySQL**.

**Linha 8:** A propriedade **host** define o endere√ßo do servidor onde o banco de dados est√° hospedado. O valor **localhost** refere-se ao seu computador local. Caso o banco estivesse na nuvem, seria necess√°rio informar o endere√ßo web correspondente.

**Linha 9:** A propriedade **port** indica o n√∫mero da porta associada ao banco de dados. O valor **3306** √© a porta padr√£o do MySQL.

**Linha 10:** A propriedade **username** define o usu√°rio que ser√° utilizado para acessar o banco de dados. O valor **root** refere-se ao usu√°rio administrador padr√£o do MySQL.

**Linha 11:** A propriedade **password** especifica a senha do usu√°rio definido anteriormente. O valor **root** √© a senha padr√£o do MySQL (recomenda-se alterar esta senha para produ√ß√£o por quest√µes de seguran√ßa).

**Linha 12:** A propriedade **database** define o nome do banco de dados que ser√° utilizado, neste caso, **db_blogpessoal**, que deve ter sido previamente criado no MySQL.

**Linha 13:** A propriedade **entities** √© configurada inicialmente com um array vazio. Ap√≥s a cria√ß√£o das **Classes Entidade**, elas ser√£o adicionadas a esse array para que o **TypeORM** possa gerar as tabelas correspondentes no banco de dados.

**Linha 14:** A propriedade **synchronize**, definida como **true**, permite que as tabelas do banco de dados sejam criadas ou atualizadas automaticamente sempre que a aplica√ß√£o for inicializada. √â importante ressaltar que essa configura√ß√£o afeta apenas a estrutura das tabelas e **n√£o** os dados contidos nelas. Para ambientes de produ√ß√£o, recomenda-se definir **synchronize** como **false**, a fim de evitar altera√ß√µes indesejadas na estrutura do banco.

<br />

> [!IMPORTANT]
>
> Em ambientes de produ√ß√£o, os valores atribu√≠dos a todas as propriedades de conex√£o com o banco de dados devem ser protegidos para garantir a seguran√ßa da aplica√ß√£o. Normalmente, essas configura√ß√µes s√£o armazenadas em **vari√°veis de ambiente**, em vez de serem diretamente expostas no c√≥digo. Aqui estamos fazendo desta forma para simplificar o entendimento.
>
> Essa pr√°tica impede que informa√ß√µes sens√≠veis, como o endere√ßo do servidor, credenciais de acesso (**username** e **password**) e outros detalhes, fiquem vulner√°veis a acessos indevidos, especialmente em reposit√≥rios p√∫blicos.
>
> Por exemplo, no **NestJS**, √© comum utilizar bibliotecas como **dotenv** para carregar essas vari√°veis de ambiente de um arquivo `.env`. Assim, as propriedades de conex√£o seriam configuradas da seguinte forma: 
>
> ```typescript
> TypeOrmModule.forRoot({
>   type: 'mysql',
>   host: process.env.DB_HOST,
>   port: +process.env.DB_PORT,
>   username: process.env.DB_USERNAME,
>   password: process.env.DB_PASSWORD,
>   database: process.env.DB_NAME,
>   entities: [],
>   synchronize: 'true',
> });
> ```
>
> As vari√°veis de ambiente (itens escritos com letras mai√∫sculas), ser√£o criadas internamente no servidor de produ√ß√£o.

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: TypeOrmModule</b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="30px"/> <a href="https://typeorm.io/data-source-options#mysql--mariadb-data-source-options" target="_blank"><b>Documenta√ß√£o: TypeOrmModule - Op√ß√µes de configura√ß√£o - MySQL</b></a></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao inserir as configura√ß√µes do Banco de dados na Classe AppModule, especialmente o nome do Banco de dados (database) e a senha do usu√°rio root (password).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/02_configurar_typeorm/blogpessoal/src/app.module.ts" target="_blank"><b>C√≥digo fonte da Classe AppModule</b></a></div>


<br />

<h2>Observa√ß√µes importantes:</h2>

- O **nome do banco de dados** deve seguir o padr√£o **db_nome_do_banco**. O prefixo **db** identifica que se trata de um banco de dados. Recomenda-se que o nome do banco seja **igual ao nome do projeto** (por exemplo, blogpessoal), utilizando apenas **letras min√∫sculas**, **sem espa√ßos em branco, caracteres especiais ou acentos**. Para nomes compostos, utilize o **underline** (_) como separador. **Exemplo:** `db_blog_pessoal`.

- O endere√ßo **localhost** refere-se ao servidor local, ou seja, o seu pr√≥prio computador. Quando a aplica√ß√£o for migrada para a nuvem, o endere√ßo do banco de dados ser√° substitu√≠do por um endere√ßo remoto fornecido pelo provedor de hospedagem.
- Para fins de aprendizagem, estamos utilizando o usu√°rio **root** no SGBD MySQL. Por√©m, no mercado de trabalho, **jamais** utilize o usu√°rio root em produ√ß√£o, pois ele √© o administrador do banco e possui acesso total ao servidor, o que representa um risco √† seguran√ßa. Normalmente, o DBA (Administrador de Banco de Dados) ou o l√≠der t√©cnico do time criar√° um usu√°rio com permiss√µes restritas, suficientes para o funcionamento da aplica√ß√£o.
- A configura√ß√£o correta do **fuso hor√°rio** no **servidor da aplica√ß√£o** √© fundamental para evitar inconsist√™ncias nas datas e hor√°rios persistidos no banco de dados ou exibidos nas consultas. Isso √© especialmente importante para atributos do tipo **Timestamp**, que utilizam a data e a hora do servidor. No servidor de produ√ß√£o, pode n√£o ser necess√°rio adicionar uma configura√ß√£o espec√≠fica na Classe main, como fizemos localmente.
- **Aten√ß√£o √† propriedade `synchronize`:** nunca utilize-a em produ√ß√£o, pois ela pode causar a **perda de todos os dados do cliente** ao recriar ou atualizar automaticamente as tabelas do banco. Essa op√ß√£o deve ser habilitada apenas durante o **desenvolvimento** da aplica√ß√£o para facilitar a cria√ß√£o/atualiza√ß√£o da estrutura do banco de dados.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Caso a senha do seu MySQL n√£o seja **root**, atualize a propriedade  **password** inserindo a senha que voc√™ cadastrou no MySQL no momento da instala√ß√£o no seu computador.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left"> **DICA:** *Caso voc√™ tenha esquecido a senha que voc√™ cadastrou para o usu√°rio root do MySQL do seu computador, consulte o <a href="../00_ambiente/04_uninstall_mysql.md"><b>Guia de Reinstala√ß√£o do MySQL</b></a> e siga as instru√ß√µes.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

Para finalizar, vamos apagar a Classe **app.controller.spec.ts**, localizada na pasta **src**, como mostra a figura abaixo. 

<div align="center"><img src="https://i.imgur.com/43VJsvV.png" title="source: imgur.com" /></div>

A Classe **app.controller.spec.ts** √© uma Classe para implementa√ß√£o de testes na Classe Controladora **AppController**. Como n√£o iremos implementar testes nesta Classe, podemos apagar. Selecione o arquivo **app.controller.spec.ts** e apague pressionando a tecla **Delete** do seu teclado. Veja como ficar√° a pasta **src** ap√≥s apagar Classe **app.controller.spec.ts**

<div align="center"><img src="https://i.imgur.com/CPARkPK.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 03 - Executar a aplica√ß√£o</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto **blogpessoal**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/JgNkmDv.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o projeto **blogpessoal**. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/nEAKeP5.png" title="source: imgur.com" /></div>

<br />

<h2>Anexo I - Erros comuns</h2>

| Erro                                                         | Descri√ß√£o                                                    |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| **Access denied for user 'root'@'localhost' (using password: NO)** | Senha incorreta. Verifique se voc√™ digitou corretamente a senha do usu√°rio root do MySQL. |
| **Unknown database 'db_blogpessoal2'**                       | Banco de dados n√£o encontrado. Verifique se voc√™ criou o Banco de dados no MySQL ou se o nome est√° correto. |

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/02_configurar_typeorm" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>


<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>