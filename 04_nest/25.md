<h1>Deploy do Backend no Render</h1>

<br />

<h2>1. O que √© Deploy?</h2>



O verbo **deploy**, em ingl√™s, significa **implantar**.

Em programa√ß√£o, seu sentido est√° intimamente relacionado √† sua tradu√ß√£o literal: fazer um deploy, em termos pr√°ticos, significa colocar na nuvem, ou seja, publicar na Internet alguma aplica√ß√£o que teve seu desenvolvimento conclu√≠do.
Quando um site √© finalizado por uma pessoa desenvolvedora, ele passa pelos √∫ltimos testes e finalmente ele √© hospedado na nuvem atrav√©s do processo chamado deploy.
Do mesmo modo, quando um sistema sofre alguma melhoria ou altera√ß√£o em seu c√≥digo-fonte, implementar essa altera√ß√£o ao sistema que est√° publicado (em Produ√ß√£o), tamb√©m √© chamado de deploy, s√≥ que incremental.

<br />

<h2>2. O que veremos por aqui?</h2>



Esse documento √© um passo a passo para voc√™ enviar a sua aplica√ß√£o NestJS, gratuitamente para a nuvem do Servi√ßo de Hospedagem **Render**. Este processo ir√° gerar um link de acesso a sua aplica√ß√£o, que poder√° ser acessado de qualquer lugar, a partir de qualquer dispositivo com acesso a Internet. 
Para efetuar o Deploy vamos precisar fazer algumas modifica√ß√µes em nosso projeto, que ser√£o detalhadas nos pr√≥ximos passos.

<br />

<h2>üë£ Passo 01 - Criar a Documenta√ß√£o da API</h2>



Para criar a Documenta√ß√£o da API no Swagger, caso voc√™ ainda n√£o tenha criado, utilize o <a href="24.md" target="_blank">**Guia de Configura√ß√£o do Swagger**</a>.

<br />

<h2 id="local">üë£Passo 02 - Testar a API no seu computador</h2>



1. Execute a sua aplica√ß√£o atrav√©s do comando ***npm run start:dev***, para compilar e executar o projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

2. Abra o Navegador da Internet de sua prefer√™ncia e digite o endere√ßo: **http://localhost:4000/**
3. Verifique se o **Swagger** est√° inicializando automaticamente, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/JKxWgN5.png?1" title="source: imgur.com" /></div>

4. Teste a sua aplica√ß√£o atrav√©s do **Insomnia** e verifique se tudo est√° funcionando. 
5. Em especial, verifique se o M√©todo **cadastrar** est√° **criptografando a senha** e se o M√©todo **logar** est√° devolvendo o **Token**.
6. Antes de continuar a configura√ß√£o do projeto para efetuar o Deploy, n√£o esque√ßa de **parar a execu√ß√£o do Projeto no Visual Studio Code**.
7. Para finalizar a execu√ß√£o do projeto, utilize as teclas **Ctrl + C** do teclado. 

<br />

> [!WARNING]
>
> **Lembre-se que antes de fazer o Deploy √© fundamental que a API esteja funcionando e sem erros. Recomendamos que os testes sejam feitos atrav√©s do Insomnia.**

<br />

<h2>üë£ Passo 03 - Criar uma conta gr√°tis no Render</h2>

<br />

<h3>3.1 O que √© o Render?</h3>



O Render √© uma plataforma unificada para criar e executar todos os seus aplicativos e sites. O Render permite criar e executar todos os seus aplicativos e sites com SSL gratuito, um CDN global, redes privadas e implanta√ß√µes autom√°ticas do Git. 

> Uma **CDN** (Rede de Entrega de Conte√∫do) √© um grupo de servidores geograficamente distribu√≠dos que aceleram a entrega do conte√∫do da Web, aproximando-o de onde os usu√°rios est√£o. 

O Render √© classificado como um **PaaS** (plataforma como servi√ßo), ou seja, √© um conjunto de servi√ßos para criar e gerenciar  aplicativos na nuvem. PaaS fornece os componentes de infraestrutura, que permitem que as pessoas Desenvolvedoras criem, integrem, migrem,   implementem, protejam e gerenciem aplicativos m√≥veis e da web, de forma  simples e r√°pida.

> **Modelos de Servi√ßos na Nuvem:**
>
> - **Plataforma como um servi√ßo (PaaS):** Um provedor de  servi√ßos oferece acesso a um ambiente baseado em cloud no qual os  usu√°rios podem desenvolver e fornecer aplicativos. Al√©m do **Render**, o **Render** e o **Azure** da Microsoft tamb√©m utilizam este modelo.
> - **Infraestrutura como um servi√ßo (IaaS):**  Um provedor de servi√ßos fornece aos clientes acesso Pay As You Go (Pague pelo que  voc√™ usar), para  armazenamento, rede, servidores e outros recursos de  computa√ß√£o na  cloud. O **AWS da Amazon e a Digital Ocean** seguem este modelo.
> - **Software como um servi√ßo (SaaS):** Um provedor de  servi√ßos oferece softwares e aplicativos por meio da  Internet. Os  usu√°rios subscrevem ao software e o acessam por meio da web ou de API's  do fabricante. o **Google Apps e do Microsoft Office 365** seguem este modelo.

Um grande diferencial do Render √© que ele oferece **contas gratu√≠tas**, com algumas limita√ß√µes, que permitem hospedar aplica√ß√µes desenvolvidas em diversas linguagens e **01 Banco de dados PostgreSQL**.

<br />

**Principais Limita√ß√µes do Plano Gratuito:**

- Se a aplica√ß√£o ficar **muito tempo sem receber nenhuma Requisi√ß√£o HTTP**, o aplicativo √© finalizado e ser√° reiniciado somente quando receber uma nova Requisi√ß√£o HTTP, para economizar os recursos da plataforma.
- Os servidores do Render est√£o dispon√≠veis apenas na Europa, √Åsia e nos Estados Unidos.
- Os recursos de Mem√≥ria, Disco e Processamento s√£o  limitados, logo a aplica√ß√£o e principalmente o Banco de dados n√£o podem  ser muito grandes.
- Aceita **apenas um Banco de dados por conta**;
- O **Banco de dados tem prazo de validade de 30 dias**. Ao completar os 30 dias voc√™ ser√° notificado por e-mail da expira√ß√£o do Banco de dados.
- O **tr√°fego mensal √© limitado a 750 horas somando todas as aplica√ß√µes e o Banco de dados**, ou seja, se ultrapassar este valor antes do m√™s acabar, sua conta ficar√° suspensa at√© o m√™s seguinte;
- Dependendo da linguagem, o Deploy da aplica√ß√£o dever√° ser realizado via Docker.

<br />

<div align="left"><img src="https://i.imgur.com/4jjzlmy.png" title="source: imgur.com" width="4%"/> <a href="https://render.com/docs/free" target="_blank"><b>Documenta√ß√£o: Render - Plano Gratu√≠to</b></a></div>

<br />

Vamos criar a conta no Render para fazermos o Deploy:

1) Acesse o endere√ßo: **https://www.render.com** e clique na op√ß√£o **Get Started**

<div align="center"><img src="https://i.imgur.com/RvNS3D0.png" title="source: imgur.com"/></div>

2. Existem diversas formas de criar uma conta no Render. Neste Guia utilizaremos a conta do Github. Clique no link **GitHub**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/f0IlI7J.png" title="source: imgur.com" /></div>

3. Na pr√≥xima janela, digite o endere√ßo do e-mail e a senha da sua conta do Github, e em seguida clique no bot√£o **Sign in**

<div align="center"><img src="https://i.imgur.com/twQ24M4.png" title="source: imgur.com" /></div>

4. Na pr√≥xima janela, autorize o Render a acessar a sua conta do Github, clicando no bot√£o **Authorize Render**.

<div align="center"><img src="https://i.imgur.com/0egaZCm.png" title="source: imgur.com" /></div>

5. Na pr√≥xima janela, confirme se o endere√ßo do e-mail est√° correto e clique no bot√£o **COMPLETE SIGN UP**

6. Na pr√≥xima janela, ser√° exibida uma mensagem solicitando que voc√™ verifique se recebeu uma mensagem no seu e-mail para validar a sua conta no Render. Abra a sua conta de e-mail e verifique se o e-mail foi recebido. Caso n√£o tenha recebido, clique no bot√£o **RESEND VERIFICATION EMAIL**.

7. Abra o e-mail enviado pelo Render (semelhante a imagem abaixo) e **clique no link para validar a sua conta**.

<div align="center"><img src="https://i.imgur.com/wlXD6G8.png" title="source: imgur.com" /></div>

8. Depois de clicar no link, sua conta ser√° validada e ser√° redirecionada para a tela do **Dashboard**.

<div align="center"><img src="https://i.imgur.com/gdzXBqU.png" title="source: imgur.com" /></div>

<br />

> [!WARNING]
>
> **Conclua todas etapas do processo de cria√ß√£o da conta no Render antes de avan√ßar para o pr√≥ximo passo do Deploy.**

<br />

<h2>üë£ Passo 04 - Instalar o Pacote @nestjs/config</h2>



Vamos instalar o Pacote **@nestjs/config** atrav√©s do NPM. Este pacote √© respons√°vel por gerenciar as configura√ß√µes do Nest enviadas atrav√©s das vari√°veis de ambiente. Como iremos configurar uma vari√°vel de ambiente no Render, vamos precisar deste Pacote.

1. Abra o **Terminal** do Visual Studio Code
2. Instale o **Pacote @nestjs/config**, atrav√©s do comando abaixo:

```bash
npm install --save @nestjs/config
```

3. Ao concluir a instala√ß√£o ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/Hkv3ous.png?1" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 05 - Instalar o Pacote do PostgreSQL</h2>



O Render, na sua vers√£o gratuita, utiliza o **PostgreSQL** como **SGBD** (Sistema Gerenciador de Bando de dados). 

At√© o momento estamos utilizando o **MySQL** para desenvolver o Blog Pessoal. Ambos s√£o Banco de dados Relacionais e gra√ßas ao **TypeORM**, n√£o ser√° necess√°rio realizar nenhuma altera√ß√£o no c√≥digo da nossa aplica√ß√£o. A √∫nica mudan√ßa necess√°ria, al√©m de instalar **o pacote do PostgreSQL**, ser√° necess√°rio configurar a conex√£o com o Banco de dados PostgreSQL na nuvem. 

<br />

<div align="left"><img src="https://i.imgur.com/b3khcJI.png" title="source: imgur.com" width="25px"/> <a href="https://www.postgresql.org/" target="_blank"><b>Site Oficial: PostgreSQL</b></a></div>

<br />
	
Vamos instalar o Pacote do PostgreSQL atrav√©s do NPM.

1. Para instalar o **Pacote do PostgreSQL**, digite o comando abaixo no Terminal:

```bash
npm install --save pg
```

4. Ao concluir a instala√ß√£o ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/GlhxRBM.png?1" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 06 - Configurar o Banco de Dados na Nuvem</h2>



A Configura√ß√£o do Banco de dados Local √© diferente da configura√ß√£o que ser√° utilizada na nuvem pelo Render. 

No passo anterior, instalamos a Biblioteca do PostgreSQL, neste passo vamos configurar a aplica√ß√£o para acessar o Banco de dados remoto no Render.

Para simplificar o processo, vamos utilizar um recurso do Nest chamado **Config Service** (Servi√ßo de Configura√ß√µes), que foi instalado na nossa aplica√ß√£o no Passo 04, que nada mais √© do que criar uma Classe de Servi√ßo, contendo as configura√ß√µes necess√°rias para cada ambiente de execu√ß√£o, ou seja, uma configura√ß√£o para usar localmente com o MySQL e outra configura√ß√£o para usar na Nuvem com o Postgres SQL. 

As Classes de Configura√ß√£o do Banco de dados, ir√£o implementar a Interface **TypeOrmOptionsFactory**, que permite configurar dinamicamente a conex√£o com o Banco de dados atrav√©s do TypeORM. 

O grande benef√≠cio **Config Service** √© simplificar a troca entre a configura√ß√£o Local (**MySQL**) e a configura√ß√£o Remota do Render (**PostgreSQL**), na hora de executar a aplica√ß√£o. 

Vamos come√ßar criando o Recurso **Data**, onde ser√£o implmentadas as duas Classes de Servi√ßo, contendo as respectivas configura√ß√µes do Banco de dados Local (MySQL) e do Banco de na Nuvem (Postgres SQL):

1. Na pasta **src**, crie a pasta **data**
2. Dentro da pasta **data**, crie a pasta **services**
3. Dentro da pasta Services, vamos criar 2 Classes de Servi√ßo:

- **DevService (dev.service.ts)**
- **ProdService (prod.service.ts)**

4. Veja na imagem abaixo, o resultado esperado:

<div align="center"><img src="https://i.imgur.com/dK843sA.png" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="80px"/> | <p align="justify"> **ALERTA DE BSM:** *Mantenha a aten√ß√£o aos detalhes ao criar as Classes de Servi√ßo. Cuidado para n√£o se equivocar ao nomear os arquivos ou criar em uma pasta diferente.* </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h3>6.1. Classe DevService</h3>



Na Classe **DevService** vamos implementar as configura√ß√µes da Conex√£o com o Banco de dados Local - MySQL. Adicione o c√≥digo abaixo na Classe **DevService**:

```ts
import { Injectable } from "@nestjs/common";
import { TypeOrmModuleOptions, TypeOrmOptionsFactory } from "@nestjs/typeorm";
import { Postagem } from "../../postagem/entities/postagem.entity";
import { Tema } from "../../tema/entities/tema.entity";
import { Usuario } from "../../usuario/entities/usuario.entity";

@Injectable()
export class DevService implements TypeOrmOptionsFactory {

    createTypeOrmOptions(): TypeOrmModuleOptions {
        return {
            type: 'mysql',
            host: 'localhost',
            port: 3306,
            username: 'root',
            password: 'root',
            database: 'db_blogpessoal',
            entities: [Postagem, Tema, Usuario],
            synchronize: true,
    };
  }
}
```

Vamos analisar o c√≥digo:

<div align="center"><img src="https://i.imgur.com/gERlQZa.png" title="source: imgur.com" /></div>

**Linhas 01 a 05:** Importamos todas as Classes necess√°rias.

**Linha 08:** Assinamos a Classe DevService implementando a Interface **TypeOrmOptionsFactory**

**Linhas 10 a 20:** Implementamos o m√©todo **createTypeOrmOptions()**, da Interface **TypeOrmOptionsFactory**, que retornar√° um Objeto Type do tipo **TypeOrmModuleOptions**. 

O Type **TypeOrmModuleOptions** √© um Objeto que cont√©m as propriedades da conex√£o com o Banco de dados. Observe que copiamos as mesmas configura√ß√µes do MySQL, que foram inseridas na Classe M√≥dulo **AppModule**.

> **Type:** A palavra-chave type no TypeScript nos permite definir aliases (apelidos) para um tipo de dado personalizado. Ele fornece uma maneira de criar novos nomes para tipos existentes.
> Os aliases de tipo n√£o introduzem novos tipos; em vez disso, eles fornecem nomes alternativos para os tipos j√° existentes.

<br />

<h3>6.2. Classe ProdService</h3>



Na Classe **ProdService** vamos implementar as configura√ß√µes da Conex√£o com o Banco de dados na Nuvem - Postgres SQL. Adicione o c√≥digo abaixo na Classe **ProdService**:

```ts
import { Injectable } from "@nestjs/common";
import { ConfigService } from "@nestjs/config";
import { TypeOrmModuleOptions, TypeOrmOptionsFactory } from "@nestjs/typeorm";

@Injectable()
export class ProdService implements TypeOrmOptionsFactory {

  createTypeOrmOptions(): TypeOrmModuleOptions {
    return {
      type: 'postgres',
      url: process.env.DATABASE_URL,
      logging: false,
      dropSchema: false,
      ssl: {
        rejectUnauthorized: false,
      },
      synchronize: true,
      autoLoadEntities: true,
    };
  }
}
```

Vamos analisar o c√≥digo:

<div align="center"><img src="https://i.imgur.com/ptdrl91.png" title="source: imgur.com" /></div>

**Linhas 01 a 03:** Importamos todas as Classes necess√°rias.

**Linha 08:** Assinamos a Classe ProdService implementando a Interface **TypeOrmOptionsFactory**

**Linhas 10 a 20:** Implementamos o m√©todo **createTypeOrmOptions()**, da Interface **TypeOrmOptionsFactory**, que retornar√° um Objeto Type do tipo **TypeOrmModuleOptions**. 

O Type **TypeOrmModuleOptions** √© um Objeto que cont√©m as propriedades da conex√£o com o Banco de dados. 

A configura√ß√£o do Banco de dados na nuvem ser√° um pouco diferente da Configura√ß√£o Local, porque os dados da conex√£o ser√£o obtidos atrav√©s de uma vari√°vel de Ambiente, que ser√° adicionada no Render, durante a configura√ß√£o do Deploy.

**Linha 10:** A propriedade **type** define o tipo do Banco de dados (PostgreSQL).

**Linha 11:** A propriedade **url** define o endere√ßo do servidor, a porta, o usu√°rio, a senha e o nome do Banco de dados. Essa **url** ser√° enviada pelo Render, por isso ela est√° passada por meio de uma vari√°vel de ambiente.

**Linha 12:** A propriedade **logging** definida como false desabilita a exibi√ß√£o dos erros de SQL no console (Terminal)

**Linha 13:** A propriedade **dropSchema** foi definida como false para impedir que todas as tabelas do Banco de dados sejam apagadas (DROP TABLE) e recriadas todas as vezes que a aplica√ß√£o for reiniciada.

**Linhas 14 e 15:** Configura a seguran√ßa da conex√£o com Banco de dados na nuvem. A propriedade **rejectUnauthorized** foi configurada como **false** para desabilitar o SSL na comunica√ß√£o com o Banco de dados.

> **SSL** √© um certificado digital que autentica a identidade de  um site e possibilita uma conex√£o criptografada. O termo "SSL" significa "Secure Sockets Layer" (camada de soquete seguro), um protocolo de  seguran√ßa que cria um link criptografado entre um servidor Web e um  navegador Web.

**Linha 17:** A propriedade **synchronize** definida como true indica que as tabelas do Banco de dados ser√£o criadas/atualizadas automaticamente em cada inicializa√ß√£o da aplica√ß√£o. Essa cria√ß√£o/atualiza√ß√£o est√° relacionada a estrutura das tabelas e n√£o aos dados.

**Linha 18:** A propriedade **autoLoadEntities** carregar√° todas as Classes Entidades, ou seja, ele procura todas Classes Entidade Registradas na **Classe AppModule** e cria as respectivas tabelas no Banco de dados na nuvem.

<br />

<h3>6.3. Atualiza√ß√£o da Classe AppModule</h3>



Na Classe **AppModule**, vamos indicar qual Classe de Servi√ßo iremos utilizar para conectar ao Banco de dados. Para rodar a aplica√ß√£o na sua m√°quina, utilizaremos a Classe **DevService**, enquanto para rodar a aplica√ß√£o na Nuvem, utilizaremos a Classe **ProdService**:

1) Abra a Classe **app.module.ts**
2) O c√≥digo da Classe estar√° semelhante a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/kw7l7w4.png" title="source: imgur.com" /></div>

3. Primeiro vamos **apagar** todas as linhas da configura√ß√£o do Banco de dados local (**Linhas 15 a 24**). 
4. Na sequ√™ncia, vamos substituir as linhas apagadas, pelo trecho de c√≥digo abaixo:

```typescript
ConfigModule.forRoot(),
TypeOrmModule.forRootAsync({
	useClass: ProdService,
    imports: [ConfigModule],
}),
```

5. Na imagem abaixo, voc√™ confere como ficou o c√≥digo da Classe depois das altera√ß√µes:

<div align="center"><img src="https://i.imgur.com/ht2Rm8f.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 13:** O m√©todo **ConfigModule.forRoot()** registra o provedor **ConfigService**, que fornece os m√©todos necess√°rios para ler vari√°veis de Ambiente e Classes de Configura√ß√£o.

**Linha 14:** Como estamos utilizando a Interface **TypeOrmOptionsFactory** para definir as configura√ß√µes do Banco de dados nas 2 Classes de Servi√ßo, precisamos adicionar as Classes na Configura√ß√£o do **AppModule** de forma ass√≠ncrona. Por isso vamos utilizar o m√©todo **forRootAsync()**, ao inv√©s do m√©todo **forRoot()**.  O m√©todo **forRootAsync()** fornece diversas maneiras de lidar com a configura√ß√£o ass√≠ncrona.

**Linha 15:** Informamos atrav√©s da propriedade **useClass**, qual Classe de Servi√ßo de Configura√ß√£o vamos utilizar. Como vamos fazer o Deploy no Render, utilizaremos a Classe **ProdService**. Para executar a aplica√ß√£o localmente, precisamos alterar esta linha para a Classe **DevService**.

**Linha 16:** Importamos o **M√≥dulo ConfigModule**, para permitir que a configura√ß√£o din√¢mica funcione.

<br />

<h3>6.4. Alternando entre as Configura√ß√µes DEV e PROD</h3>



Para alternar entre as configura√ß√µes Local e Remota, na Classe **AppModule**, na propriedade **useClass**, utilize uma das 2 op√ß√µes abaixo:

<b><code>useClass: DevService</code> </b> ü°¢ O Nest executar√° a aplica√ß√£o com a configura√ß√£o do Banco de dados local (MySQL)

<b><code>useClass: ProdService</code> </b> ü°¢ O Nest executar√° a aplica√ß√£o com a configura√ß√£o do Banco de dados na nuvem (Render)

Para o Deploy, vamos deixar a configura√ß√£o **useClass: ProdService**.

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="120px"/> | <p align="justify"> **ALERTA DE BSM:** *Mantenha a aten√ß√£o aos detalhes ao executar a aplica√ß√£o. Um erro muito comum √© tentar executar o seu projeto no Visual Studio Code com a Classe ProdService habilitada na propriedade useClass. Com a Classe ProdService habilitada, o projeto n√£o ser√° inicializado localmente, apenas nuvem.* </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/configuration" target="_blank"><b>Documenta√ß√£o: <i>Config Service</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database" target="_blank"><b>Documenta√ß√£o: <i>Configura√ß√£o - Banco de dados</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/16_Deploy_Heroku/blogpessoal/src/app.module.ts" target="_blank"><b>C√≥digo fonte: Classe AppModule</b></a></div>

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/16_Deploy_Heroku" target="_blank"><b>C√≥digo fonte: Projeto finalizado</b></a></div>

<br />

<h2>üë£ Passo 07 - Atualizar o Reposit√≥rio do projeto no Github</h2>




1. Envie as atualiza√ß√µes do seu projeto para o reposit√≥rio do  Github, atrav√©s do **Git Bash**, utilizando os comandos abaixo:

   ```bash
    git add .
    
    git commit -m ‚ÄúDeploy do Projeto Blog Pessoal‚Äù
    
    git push origin main
   ```

<br />

> [!CAUTION]
>
> **Para efetuar o Deploy, o projeto Nest <u>OBRIGATORIAMENTE</u> precisa estar em um Reposit√≥rio <u>EXCLUSIVO</u> e n√£o deve estar <u>DENTRO DE UMA PASTA</u>, ou seja, ao abrir o reposit√≥rio do projeto no Github, o conte√∫do exibido ser√° semelhante ao da imagem abaixo. Se estiver diferente da imagem abaixo ser√° necess√°rio refazer o Reposit√≥rio do Github.**

<br />

<div align="center"><img src="https://i.imgur.com/g5ao5b2.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 08 - Criar o Banco de dados no Render</h2>



1. Para adicionar um novo Banco de dados, no Dashboard do Render, clique no bot√£o **+ Add new** e em seguida clique na op√ß√£o **PostgreSQL**.

<div align="center"><img src="https://i.imgur.com/ZuLknwd.png" title="source: imgur.com" /></div>

<br />

> [!CAUTION]
>
> **O Plano Gratuito do Render autoriza a cria√ß√£o de apenas 1 Banco de dados PostgreSQL por conta. **
>
> **Outro ponto importante √© que em 30 dias o Banco de dados ser√° bloqueado, ou seja, para continuar rodando aplica√ß√£o ser√° necess√°rio apagar e criar o Banco de dados novamente, al√©m de Reconfigurar a conex√£o com o novo Banco de dados no Webservice e inserir os dados novamente.**

<br />

2. Na pr√≥xima tela, informe o nome do Banco de dados (**db_blogpessoal**), na propriedade **Name**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/6uJfkZA.png" title="source: imgur.com" /></div>

3. Role a tela para baixo e selecione o Plano Gratuito (**Free**), como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/N104UGQ.png" title="source: imgur.com" /></div>

<br />

> [!WARNING]
>
> **Caso seja selecionado um plano diferente, o Render exigir√° o Cart√£o de Cr√©dito para emitir a fatura do servi√ßo.**

<br />

4. Role a tela para baixo e clique no bot√£o **Create Database**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/995JeQv.png" title="source: imgur.com" /></div>

5. Na pr√≥xima tela, aguarde at√© que o **Status** esteja **Available**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/u8fQH4z.png" title="source: imgur.com" /></div>

6. Role a tela para baixo e localize o item: **External Database URL**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/Gj2fBvP.png" title="source: imgur.com" /></div>

7. Clique no bot√£o com o **√≠cone de um olho**, para visualizar a URL de conex√£o externa, conforme indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/aQ7htUF.png" title="source: imgur.com" /></div>

8. Na sequ√™ncia, clique no bot√£o **copiar**, conforme indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/At0BmFx.png" title="source: imgur.com" /></div>

9. Abra um arquivo do **Bloco de Notas** e cole esta **URL (Endere√ßo do Banco de dados)** no arquivo, como mostra a imagem abaixo. N√≥s utilizaremos este endere√ßo no pr√≥ximo passo.

<div align="center"><img src="https://i.imgur.com/su4ZN45.png" title="source: imgur.com" /></div>

<br />

> [!WARNING]
>
> **O processo do Deploy enviar√° apenas a sua aplica√ß√£o para a nuvem, logo o Banco de dados que acabou de ser criado nesta etapa estar√° completamente vazio, inclusive sem as tabelas, que ser√£o criadas somente depois que a aplica√ß√£o for inicializada pela primeira vez.**

<br />

<h2>üë£ Passo 09 - Criar o Web Service no Render</h2>



1. Para criar um novo Webservice, na barra de Navega√ß√£o do Render, clique no bot√£o **+ New** e em seguida clique na op√ß√£o **Web Service**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/EjNU1FE.png" title="source: imgur.com" /></div>

2. No item **GitHub**, clique no link **+ Connect account**, para conectar a sua conta do Render com a sua Conta do Github.

<div align="center"><img src="https://i.imgur.com/xaffIQz.png" title="source: imgur.com" /></div>

3. Na tela, **Install Render**, clique no seu usu√°rio do Github (no exemplo, rafaelproinfo), como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/ZkwMUEp.png" title="source: imgur.com" /></div>

4. Na pr√≥xima tela, clique no bot√£o **Install**, para concordar que o Render acesse a sua Conta do Github.

<div align="center"><img src="https://i.imgur.com/ucaK7wA.png" title="source: imgur.com" /></div>

5. Selecione o Reposit√≥rio onde voc√™ enviou o **Blog Pessoal** e clique no bot√£o **Connect**, para conectar o Web Service ao Reposit√≥rio do Github .

<div align="center"><img src="https://i.imgur.com/AYXxYVM.png" title="source: imgur.com" /></div>

6. Na pr√≥xima tela, informe o nome da sua aplica√ß√£o na propriedade **Name** (**blogpessoal**).

<div align="center"><img src="https://i.imgur.com/xFSci7m.png" title="source: imgur.com" /></div>

<br />

> [!IMPORTANT]
>
> **O NOME DO PROJETO N√ÉO PODE CONTER <u>LETRAS MAIUSCULAS</u>, <u>APENAS NUMEROS</u> OU <u>CARACTERES ESPECIAIS</u>.**

<br />

7. Role a tela para baixo e verifique se a propriedade **Environment** est√° com a op√ß√£o **Node** selecionada.

<div align="center"><img src="https://i.imgur.com/kazoMSr.png" title="source: imgur.com" width="90%"/></div>

8. Role a tela para baixo e verifique se o Plano Gratuito (**Free**) est√° selecionado.

<div align="center"><img src="https://i.imgur.com/GenKLYn.png" title="source: imgur.com" /></div>

<br />

> [!WARNING]
>
> **Caso seja selecionado um plano diferente, o Render exigir√° o Cart√£o de Cr√©dito para emitir a fatura do servi√ßo.**

<br />

<h2>üë£Passo 10 - Configurar a Vari√°vel de Ambiente</h2>



Depois de definir o tipo de servi√ßo no item **Instance Type**, vamos configurar uma vari√°vel de ambiente, que armazenar√° a string de conex√£o com o Banco de dados no item **Environment Variables**:

1. Role a tela a para abaixo e localize a op√ß√£o **Environment Variables**.

<div align="center"><img src="https://i.imgur.com/nZtUEtg.png" title="source: imgur.com" /></div>

<br />

> As **vari√°veis de ambiente** s√£o configura√ß√µes que afetam o comportamento do sistema operacional e dos programas em seu computador. Elas podem ser usadas para apontar diret√≥rios importantes, definir informa√ß√µes espec√≠ficas ou personalizar certos aspectos do sistema, como por exemplo, a string de conex√£o com o Banco de dados de uma aplica√ß√£o. 

<br />

2. No item **NAME_OF_VARIABLE**, vamos definir o nome da nossa vari√°vel de ambiente (**DATABASE_URL**):

<div align="center"><img src="https://i.imgur.com/GVhz93Q.png" title="source: imgur.com" /></div>

3. No arquivo do Bloco de Notas, onde copiamos a URL do Banco de dados, acrescente depois do **.com**, o numero da porta de conex√£o com o Banco de dados PostgreSQL **:5432**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/4JIRm3p.png" title="source: imgur.com" /></div>

4. Copie o endere√ßo atualizado e cole no item **value** da Vari√°vel de Ambiente **DATABASE_URL**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/XpSDPIb.png" title="source: imgur.com" /></div>

5. Observe que a porta foi adicionada no endere√ßo do Banco de dados, como indicado na imagem acima.
6. Clique no bot√£o **Deploy Web Service** para criar o Web Service e iniciar o Deploy.

<div align="center"><img src="https://i.imgur.com/oh39h2L.png" title="source: imgur.com" /></div>

7. Acompanhe o processo do Deploy no **Log do Web Service**

<div align="center"><img src="https://i.imgur.com/VGYv8H6.png" title="source: imgur.com" /></div>

8. Ao finalizar o Deploy, ser√° exibida a mensagem: **Build sucessful** e na sequ√™ncia a aplica√ß√£o ser√° iniciada.

<div align="center"><img src="https://i.imgur.com/Y0QAS8G.png" title="source: imgur.com" /></div>

9. Observe na imagem abaixo, que a mensagem informando que a aplica√ß√£o est√° em execu√ß√£o √© igual a mensagem exibida no Console do Visual Studio Code.

<div align="center"><img src="https://i.imgur.com/oK9ZSJt.png" title="source: imgur.com" /></div>

<br />

> [!IMPORTANT]
>
> **Caso o Servidor do Render esteja sobrecarregado, o console pode n√£o exibir todo o processo. Fique atento a mensagem de status localizada acima do console. Caso a mensagem de status fique verde com a palavra Live, como vemos na imagem abaixo, significa que o Deploy foi finalizado com sucesso!**

<br />

<div align="center"><img src="https://i.imgur.com/OKl7yI3.png" title="source: imgur.com" /></div>

10. Para abrir a aplica√ß√£o no Navegador da Internet, clique no link da aplica√ß√£o, indicado na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/KdRorYF.png" title="source: imgur.com" /></div>

11. Outra forma de abrir a aplica√ß√£o √© digitando o endere√ßo: **https://nomedoprojeto.onrender.com** no navegador. (No exemplo acima: https://blogpessoal.onrender.com)

<br />

> [!IMPORTANT]
>
> **Ao clicar no link da aplica√ß√£o, pode acontecer do projeto n√£o abrir automaticamente no navegador. Como o Render precisa finalizar alguns processos, ele pode demorar alguns minutos para abrir a aplica√ß√£o no Navegador WEB.**

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <p align="justify"> **ALERTA DE BSM:** *Mantenha a aten√ß√£o aos detalhes. Caso o nome do projeto j√° seja um endere√ßo em uso no Render, ele acrescentar√° caracteres aleat√≥rios depois do nome do projeto ao criar o endere√ßo da aplica√ß√£o. Exemplo: blogpessoal-wrtc.onrender.com*. </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>‚ùå O Deploy n√£o Abriu!</h2>



Se o **Deploy no Render n√£o abrir** e/ou aparecer a mensagem **Failed**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/7SaAc4l.png" title="source: imgur.com" /></div>

- Caso n√£o tenha aparecido mensagens de erro no **Console, na janela chamada Log do Webservice**, clique no bot√£o **Manual Deploy** e em seguida, clique na op√ß√£o **Clear build cache & deploy** para refazer o deploy manualmente, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/dRdNYQ7.png" title="source: imgur.com" /></div>

- Se o erro persistir, verifique se a **Vari√°vel de Ambiente est√° configurada corretamente**. 

- Caso seja necess√°rio atualizar o valor de qualquer Vari√°vel de Ambiente, o Render iniciar√° um novo Deploy automaticamente ap√≥s a atualiza√ß√£o.

- Caso tenha aparecido algum erro no **Log do Web Service**, identifique o tipo do erro:
  - Se for erro de c√≥digo (Erro do Framework Nest ou Erro no c√≥digo TypeScript), siga as instru√ß√µes do t√≥pico: <a href="#update">**3. Como atualizar o Deploy no Render?**</a>, corrija o erro localmente, fa√ßa os respectivos testes e atualize o Reposit√≥rio do Github do Projeto.
  
- Caso o Deploy exiba a mensagem de conclu√≠do com sucesso, entretanto ao tentar abrir no navegador n√£o aparece nada na tela, experimente refazer o Deploy manualmente.

- Caso o mesmo erro persista, recrie o Banco de dados e o Webservice da aplica√ß√£o, s√≥ que desta vez trocando o servidor (**Region**) de hospedagem. O Render possui 5 servidores (Oregon, Ohio, Frankfurt, Virginia e Singapore), como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/75v6aQq.png" title="source: imgur.com" /></div>

- Apague o Banco de dados e o WebService da aplica√ß√£o, e na sequ√™ncia recrie ambos (Passos 08 a 10), desta vez alterando servidor. D√™ a prefer√™ncia para os Servidores Americanos (Oregon, Ohio e Virginia), por serem mais pr√≥ximos do Brasil. Lembre-se que Singapore (√Åsia) e Frankfurt (Europa) est√£o mais distantes do Brasil.

<br />

<h2>üë£ Passo 11 - Abrir o Deploy no Navegador</h2>



1. Ao abrir a sua aplica√ß√£o no Navegador, ser√° exibida a tela abaixo:

<div align="center"><img src="https://i.imgur.com/JKxWgN5.png?1" title="source: imgur.com" /></div>

2. Observe que o endere√ßo do deploy ser√° composto pelo **https://nomedoseuprojeto.onrender.com**. No Deploy exemplo, o link ficou: **https://blogpessoal.onrender.com**, como mostra a imagem abaixo. 

<div align="center"><img src="https://i.imgur.com/Bsf7inS.png" title="source: imgur.com" /></div>

<br />

> [!IMPORTANT]
>
> **Note que o Render tem como pol√≠tica de seguran√ßa padr√£o o uso <u>OBRIGAT√ìRIO</u> do protocolo https (protocolo http com a camada seguran√ßa - SSL), nos endere√ßos das aplica√ß√µes hospedadas nos seus servidores.**

<br />

Como o Banco de dados e as tabelas da aplica√ß√£o acabaram de ser criadas no Render, elas est√£o completamente vazias, logo precisamos adicionar dados para testarmos a aplica√ß√£o na nuvem. Para testarmos a aplica√ß√£o, precisamos criar uma conta de usu√°rio e efetuar o login com esta conta para obter o token JWT e habilitarmos o Swagger, que tamb√©m est√° protegido pelo Passport. 

1. Abra o **Insomnia** e acesse a Collection **Blog Pessoal**.
2. Crie uma pasta chamada **Blog Pessoal** e arraste as 3 pastas (**Postagem, Tema e Usuario**) para dentro dela.
3. Duplique a pasta **Blog Pessoal** clicando sobre a pasta com o bot√£o direito do mouse e clicando na op√ß√£o **Duplicate** do menu que ser√° aberto.
4. Na pr√≥xima janela, defina o nome da nova pasta como **Blog Pessoal - Render**.

<div align="center"><img src="https://i.imgur.com/hE8xkGA.png" title="source: imgur.com" /></div>

5. Abra a requisi√ß√£o **Cadastrar Usu√°rio** na pasta **Blog Pessoal - Render**.

6. Altere o caminho atual: **http://localhost:4000/usuarios/cadastrar** 

<div align="center"><img src="https://i.imgur.com/mxpZa0m.png" title="source: imgur.com" /></div>

7. Para o endere√ßo do seu Deploy no Render: **https://meuprojeto.onrender.com/usuarios/cadastrar** (No exemplo acima: **https://blogpessoal.onrender.com/usuarios/cadastrar**)

<div align="center"><img src="https://i.imgur.com/HmopPqF.png" title="source: imgur.com" /></div>

8. Ap√≥s efetuar as altera√ß√µes, crie o usu√°rio **root@root.com** com os dados da imagem abaixo:

<div align="center"><img src="https://i.imgur.com/3GD5gh1.png" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="120px"/> | <p align="justify"> **ALERTA DE BSM:** *Mantenha a aten√ß√£o aos detalhes. Crie o usu√°rio root exatamente como mostra a figura acima. Ser√° atrav√©s deste usu√°rio que os Instrutores da sua turma ir√£o corrigir o seu projeto*. </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

9. Fa√ßa login com este usu√°rio para obter o Token. N√£o esque√ßa de alterar o endere√ßo da Requisi√ß√£o, assim como foi feito na Requisi√ß√£o **Cadastrar Usu√°rio**.

<div align="center"><img src="https://i.imgur.com/d3H9BEl.png" title="source: imgur.com" /></div>

10. Copie apenas a parte codificada do token, ou seja, tudo menos a palavra **Bearer**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/9ZXB79L.png" title="source: imgur.com" /></div>

11. Volte para o Swagger e clique no bot√£o **Authorize**, localizado no lado direito da tela.

<div align="center"><img src="https://i.imgur.com/8YmwsLv.png" title="source: imgur.com" /></div>

12. Cole o token no campo **Value** e clique no bot√£o **Authorize**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/R6onfh2.png" title="source: imgur.com" /></div>

13. Ser√° exibida a mensagem **Authorized** (Autorizado!). Clique no bot√£o **Close**.

<div align="center"><img src="https://i.imgur.com/suHAPUF.png" title="source: imgur.com" /></div>

14. O Swagger est√° desbloqueado e pronto para uso. Observe que os cadeados est√£o todos na cor preta (desbloqueados).

<div align="center"><img src="https://i.imgur.com/RSqkqzk.png" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **IMPORTANTE:** O Token est√° configurado para durar 1h, ou seja, daqui a 1h voc√™ ter√° que repetir o processo acima para desbloquear o Swagger novamente.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>üë£ Passo 12 - Testar o Deploy no Insomnia</h2>



1. Volte para o **Insomnia** .
2. Atualize o endere√ßo de todas requisi√ß√µes da pasta **Blog Pessoal - Render**, assim como foi feito nas requisi√ß√µes **Cadastrar Usu√°rio e Login**.
3. Atualize o Token em todas as Requisi√ß√µes, exceto **Cadastrar Usu√°rio e Login**. Lembre-se que o token dura apenas 1 hora!

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="120px"/> | <p align="justify"> **ALERTA DE BSM:** *Mantenha a aten√ß√£o aos detalhes e a persist√™ncia. Insira dados na API atrav√©s do Insomnia em todos os recursos (Postagem, Tema e Usuario). No recurso Postagem, n√£o esque√ßa de testar o Relacionamento entre as 3 Classes*. </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2 id="update">3. Como atualizar o Deploy no Render? </h2>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="120px"/> | <p align="justify"> **ALERTA DE BSM:** *Mantenha a aten√ß√£o aos detalhes. Este item voc√™ utilizar√° apenas se voc√™ precisar alterar alguma coisa no seu projeto Nest ou efetuar alguma atualiza√ß√£o na aplica√ß√£o na nuvem*. </p> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

1. Para fazer altera√ß√µes no c√≥digo do projeto e executar localmente, no **Visual Studio Code**, abra a **Classe AppModule**, localizada na pasta **src** e **localize a linha indicada na imagem abaixo, que cont√©m a chamada para a Classe ProdService com a configura√ß√£o do Banco de dados na nuvem**.

<div align="center"><img src="https://i.imgur.com/bdvbvCe.png" title="source: imgur.com" /></div>

2. Na sequ√™ncia, substitua a **Classe ProdService** (configura√ß√£o do Banco de dados da nuvem), pela **Classe DevService** (configura√ß√£o do Banco de dados local), indicada na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/ZJcWThI.png" title="source: imgur.com" /></div>

3. Fa√ßa as altera√ß√µes necess√°rias no c√≥digo do seu projeto, execute localmente e verifique se est√° tudo funcionando **sem erros**.
4. Antes de atualizar o seu reposit√≥rio no Github e refazer o Deploy, pare a aplica√ß√£o e substitua a **Classe DevService** (configura√ß√£o do Banco de dados local), pela **Classe ProdService** (configura√ß√£o do Banco de dados da nuvem), indicada na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/bdvbvCe.png" title="source: imgur.com" /></div>

5. Envie as atualiza√ß√µes do seu projeto para o reposit√≥rio do  Github, utilizando os comandos abaixo: 

```bash
git add .
git commit -m ‚ÄúAtualiza√ß√£o do Deploy - Blog Pessoal‚Äù
git push origin main
```

6. Ao finalizar o **git push**, o Render come√ßar√° a refazer o Deploy automaticamente. Acompanhe o processo pelo **Dashboard do Render**. 

<div align="center"><img src="https://i.imgur.com/aOOoFdT.png" title="source: imgur.com" /></div>

7. Ap√≥s a conclus√£o, verifique se a Aplica√ß√£o abre no Navegador e fa√ßa todos os testes no Insomnia.

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
