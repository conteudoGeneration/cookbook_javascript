<h1>Projeto 02 - Blog Pessoal - M√≥dulo Auth - Parte 01</h1>

<br />

O que veremos por aqui:

1. Apresenta√ß√£o do M√≥dulo Auth
2. Criar o M√≥dulo Auth
3. Criar a Classe Auxiliar UsuarioLogin
4. Criar a Classe Auxiliar Bcrypt
5. Criar a Classe M√≥dulo AuthModule
6. Registrar a Classe Bcrypt na Classe AuthModule
7. Registrar a Classe AuthModule na Classe AppModule

<br />

<h2>1. O M√≥dulo Auth</h2>



Nesta etapa vamos come√ßar a construir o M√≥dulo Auth, que ser√° utilizado para habilitar e implementar a seguran√ßa do Blog Pessoal. Atrav√©s do M√≥dulo Auth ser√° poss√≠vel realizar a autentica√ß√£o dos usu√°rios a  partir de uma tabela no Banco de dados, al√©m de criar e validar o Token JWT do usu√°rio. Para isso √© necess√°rio enviar os atributos usuario (e-mail) e senha, para que o Passport valide as credenciais do usu√°rio e posteriormente valide o Token JWT , que ser√° gerado pela Biblioteca JWT do Nest, que permitir√° acessar os endpoints protegidos da aplica√ß√£o.

O M√≥dulo Auth ter√° uma Classe Entidade Auxiliar chamada **UsuarioLogin**. Chamamos esta Classe Entidade de Auxiliar porqu√™ ela n√£o ir√° gerar uma tabela no Banco de dados, ela servir√° apenas para enviar os dados do usu√°rio para o Passport. Veja no Diagrama de Classes abaixo a estrutura da Classe **UsuarioLogin**:

<div align="center"><img src="https://i.imgur.com/GdwAVgL.png" title="source: imgur.com" width="70%"/></div>

Al√©m da Classe UsuarioLogin, vamos construir uma segunda **Classe de Servi√ßo Auxiliar, chamada Bcrypt**, que ser√° respons√°vel por criptografar a senha do usu√°rio e validar a senha digitada pelo usu√°rio no login, comparando com a senha persistida no Banco de dados da aplica√ß√£o, que estar√° criptografada. 

Nas pr√≥ximas duas etapas vamos construir o M√≥dulo Usuario e na sequ√™ncia, vamos finalizar o M√≥dulo Auth em mais 2 etapas, implementando as **Classes necess√°rias para utilizar a Biblioteca Passport**, a Classe de Servi√ßo **AuthService**, que ir√° nos auxiliar nos processos de autentica√ß√£o (login) e a **Classe AuthController** que disponibilizar√° o endpoint de autentica√ß√£o (login).

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="80px"/> | <div align="left"> **DICA:** *Caso voc√™ tenha alguma d√∫vida sobre como criar o M√≥dulo, executar o projeto, entre outras, consulte a Documenta√ß√£o do M√≥dulo Postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>üë£ Passo 01- Instala√ß√£o do Pacote Bcrypt</h2>



Vamos instalar os Pacotes **Bcrypt e @types/bcrypt** atrav√©s do NPM.

1. Abra o **Terminal** do Visual Studio Code atrav√©s do menu **Terminal ü°™ New Terminal**
2. Digite o comando abaixo para instalar o Pacote **Bcrypt**:

```bash
npm install --save bcrypt
```

3. Ao concluir a instala√ß√£o ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/t5t1DeK.png?1" title="source: imgur.com" /></div>

4. Para instalar o pacote **@types/bcrypt**, digite o comando abaixo:

```bash
npm install --save @types/bcrypt
```

5. Ao concluir a instala√ß√£o ser√° exibida a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/Z5drvLA.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 02 - Criar o M√≥dulo Auth</h2>



Vamos criar o M√≥dulo Auth:

1. Na pasta **src**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

2. O nome da pasta ser√° **auth**. Ap√≥s digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 

Na sequ√™ncia, vamos criar as pastas **entities e bcrypt**, dentro do nosso **M√≥dulo Auth** (pasta auth):

1. Na pasta **auth**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

2. Digite o nome da pasta (**entities**) e pressione a tecla **enter** do seu teclado para concluir. 
3. Ainda na pasta **auth**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 
4. Digite o nome da pasta (**bcrypt**) e pressione a tecla **enter** do seu teclado para concluir. 
5. A estrutura de pastas do **M√≥dulo Auth**, ficar√° igual a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/O8YLhIz.png?1" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="90px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar as novas pastas no M√≥dulo. Um erro muito comum √© criar a pasta entities e bcrypt fora da pasta do m√≥dulo (auth).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>üë£ Passo 03 - Criar a Classe AuthModule</h2>



Agora vamos criar a Classe **AuthModule** que chamaremos de **auth.module.ts**:

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe M√≥dulo. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

1. Clique com o bot√£o direito do mouse sobre a **pasta auth**, que foi criada dentro da pasta **src** e clique na op√ß√£o **New File** (Novo Arquivo).

2. Digite o nome do arquivo (**auth.module.ts**) e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/wqk8zCn.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 04 - Criar a Classe Entidade UsuarioLogin</h2>



Antes de implementarmos o c√≥digo da Classe **AuthModule**, vamos criar a Classe Entidade Auxiliar **UsuarioLogin**, que chamaremos de **usuariologin.entity.ts**:

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe Entidade. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

1. Clique com o bot√£o direito do mouse sobre a **pasta entities**, que foi criada dentro da pasta **auth**, e clique na op√ß√£o **New File** (Novo Arquivo).

2. Digite o nome do arquivo (**usuariologin.entity.ts**) e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/tY2x3mQ.png" title="source: imgur.com" /></div>

Agora vamos criar o c√≥digo da Classe **UsuarioLogin**:

```typescript
export class UsuarioLogin {

    public usuario: string

    public senha: string

}
```

Observe que √© uma Classe bem simples, sem decoradores ou importa√ß√µes, porque ela n√£o ser√° utilizada para gerar uma nova tabela no Banco de dados.

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/11_Recurso_Auth/blogpessoal/src/auth/entities/usuariologin.entity.ts" target="_blank"><b>C√≥digo fonte da Classe UsuarioLogin</b></a>
<br /></div>

<br />

<h2>üë£ Passo 05 - Criar a Classe Auxiliar Bcrypt</h2>



Neste passo, vamos criar a Classe Auxiliar **Bcrypt**, que chamaremos de **bcrypt.ts**. Nesta Classe vamos criar alguns M√©todos, que utilizar√£o o pacote **Bcrypt** para criptografar e validar a senha do usu√°rio:

1. Clique com o bot√£o direito do mouse sobre a **pasta bcrypt**, que foi criada dentro da pasta **auth**, e clique na op√ß√£o **New File** (Novo Arquivo).

2. Digite o nome do arquivo (**bcrypt.ts**) e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/SUCuJOG.png" title="source: imgur.com" /></div>

Agora vamos criar o c√≥digo da Classe **Bcrypt**:

<div align="center"><img src="https://i.imgur.com/bKUchFU.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 1:** Importamos o pacote **Common** com os respectivos **decoradores**, utilizados na implementa√ß√£o da Classe Bcrypt.

**Linha 2:** Importamos o pacote **Bcrypt**. Esta importa√ß√£o ser√° feita manualmente.

**Linha 4:** O decorator **@Injectable** indica que a classe √© do tipo Service (Classe de Servi√ßo), que pode ser Injetada em outras Classes atrav√©s da **Inje√ß√£o de Depend√™ncias**.

**Linha 7:** Criamos o M√©todo Ass√≠ncrono (async), chamado **criptografarSenha(senha: string)**, que promete retornar uma **Promise** contendo uma String (a senha criptografada).

**Linha 9:** Criamos uma var√°vel chamada **saltos**, para armazenar o numero de Saltos (salt) que ser√£o utilizados pelo Algoritmo  **Bcrypt**, ou seja, o numero de caracteres aleat√≥rios que ser√£o inseridos na senha criptografada, com o objetivo de aumentar a seguran√ßa.

**Linha 10:** Retorna a execu√ß√£o do M√©todo **hash(senha, saltos)**, da Classe **bcrypt**. Este M√©todo retornar√° a senha criptografada atrav√©s do algoritmo **Bcrypt** (algoritmo hash).

> **Hash:** √â o processo de ‚Äúesconder a escrita‚Äù atrav√©s da aplica√ß√£o de algoritmos matem√°ticos, que modificam qualquer bloco de dados em  caracteres de comprimento fixo, chamados *hashes*. O comprimento dos dados de entrada podem ter qualquer tamanho, por√©m, os dados de sa√≠da sempre ter√£o valores de *hash* de mesmo comprimento.

Observe que o M√©todo **hash(senha, saltos)** possui dois par√¢metros: o primeiro, do tipo **string** √© a senha e o segundo do tipo **number** √© o numero de saltos. O Numero de saltos padr√£o √© 10.

**Linha 14:** Criamos o M√©todo Ass√≠ncrono (async), chamado **compararSenhas(senhaDigitada: string, senhaBanco: string)**, que promete retornar uma **Promise**, que retornar√° um objeto boolean.

**Linha 15:** Retorna a execu√ß√£o do M√©todo **compareSync(senhaDigitada, senhaBanco)**, da Classe **bcrypt**. Este M√©todo retornar√° **true** se a senha digitada for igual a senha persistida no Banco de dados.

<br />

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="120px"/> | <div align="left">Dica: Nos links abaixo, selecionamos um artigo que explica com mais detalhes o algoritmo BCrypt, al√©m de uma ferramenta on-line onde voc√™ pode testar a codifica√ß√£o e a valida√ß√£o de strings geradas atrav√©s do algoritmo BCrypt.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://medium.com/reprogramabr/uma-breve-introdu%C3%A7%C3%A3o-sobre-bcrypt-f2fad91a7420" target="_blank"><b>Artigo: <i>Uma breve introdu√ß√£o ao Algoritmo BCrypt</i></b></a></div>


<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/kelektiv/node.bcrypt.js#readme" target="_blank"><b>Documenta√ß√£o: Biblioteca Bcrypt JS</b></a> </div>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://bcrypt-generator.com" target="_blank"><b>Site: <i>Codificador BCrypt</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/11_Recurso_Auth/blogpessoal/src/auth/bcrypt/bcrypt.ts" target="_blank"><b>C√≥digo fonte da Classe Bcrypt</b></a>
<br /></div>

<br />

<h2>üë£ Passo 06 - Registrar a Classe Bcrypt na Classe AuthModule</h2>



Vamos implementar o c√≥digo da Classe **AuthModule** e registrar a Classe **Bcrypt**. Veja abaixo a implementa√ß√£o da Classe **AuthModule**:

<div align="left"><img src="https://i.imgur.com/A9VocPU.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 6:** A Classe **Bcrypt** foi registrada no array **providers**, por se tratar de uma Classe de Servi√ßo.

**Linha 8:** A Classe **Bcrypt** foi registrada no array **exports**, porqu√™ vamos precisar utilizar a Classe no M√≥dulo Usuario.

Observe que apenas a Classe **Bcrypt** foi registrada na Classe **AuthModule**. A Classe **UsuarioLogin** n√£o foi registrada porque ela n√£o ir√° gerar uma tabela no Banco de dados. 

<br />

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *Se uma Classe for importada com o caminho absoluto (src/bcrypt/bcrypt), os testes da aplica√ß√£o com o framework Jest n√£o ser√£o executados. O Jest n√£o reconhece caminho absoluto, apenas o caminho relativo (./bcrypt/bcrypt)* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/11_Recurso_Auth/blogpessoal/src/auth/auth.module.ts" target="_blank"><b>C√≥digo fonte da Classe AuthModule</b></a>
<br /></div>

<br />

<h2>üë£ Passo 07 - Registrar a Classe AuthModule na Classe AppModule</h2>



Para finalizar, vamos registrar a Classe **AuthModule** no M√≥dulo principal da  aplica√ß√£o, a Classe **AppModule**:

1. Abra a Classe **AppModule**, localizada na pasta **src**, conforme indicada na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/In0bJnz.png" title="source: imgur.com" /></div>

2. Implemente a altera√ß√£o, indicada pela seta na imagem abaixo:

<div align="left"><img src="https://i.imgur.com/JOf1Svy.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 23:** No array **imports** vamos inserir o M√≥dulo **AuthModule**.  Insira no array a Classe **AuthModule**, abaixo da Classe TemaModule, separadas por uma virgula.

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao Registrar novas Classes no M√≥dulo App. Observe que ap√≥s registrar uma nova Classe, novas importa√ß√µes de Classes ser√£o necess√°rias nas primeiras linhas da Classe AppModule.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/11_Recurso_Auth/blogpessoal/src/app.module.ts" target="_blank"><b>C√≥digo fonte da Classe AppModule</b></a></div>

<br />

Antes de finalizar o M√≥dulo Auth, vamos implementar o M√≥dulo Usuario nas pr√≥ximas duas etapas...

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/11_Recurso_Auth" target="_blank"><b>C√≥digo fonte do Projeto</b></a></div>

<br />

<br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
