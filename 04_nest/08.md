<h1>Projeto 02 - Blog Pessoal - Classe PostagemController e PostagemService - M√©todo Consultar Postagens por Id</h1>



O que veremos por aqui:

1. Criar o M√©todo findById(id: number) na Classe PostagemService
2. Criar o M√©todo findById(id: number) na Classe PostagemController
3. Testar o M√©todo no Insomnia

<br />

<h2>1. O M√≥dulo Postagem</h2>



Na etapa anterior, come√ßamos a construir as Classes **PostagemService** e  **PostagemController**, al√©m de  implementamos o M√©todo **findAll()**, que retorna todos os Objetos da Classe Postagem persistidos no Banco de dados. Vamos continuar a constru√ß√£o das nossas Classes implementando o **M√©todo findById( id: number )**.

<div align="center"><img src="https://i.imgur.com/vmCMVTX.png" title="source: imgur.com" width="75%"/></div>

<br />

<h2>üë£ Passo 01 - Criar o M√©todo findById na Classe PostagemService</h2>



Vamos implementar o M√©todo **findById(id: number)** na Classe PostagemService. Tra√ßando um paralelo com o SQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens where id = id;</code>.

1. Abra a Classe **Postagem Service**, localizada na pasta **src/postagem/services**.

<div align="center"><img src="https://i.imgur.com/K9AHCEo.png?1" title="source: imgur.com" /></div>

2. Insira o c√≥digo abaixo depois do M√©todo **findAll()**.

<div align="left"><img src="https://imgur.com/3mbEh9X.png" title="source: imgur.com" /></div>

**Vamos analisar o c√≥digo do M√©todo:**

**Linha 17:** Criamos o m√©todo ass√≠ncrono **findById(id: number)**, que promete retornar uma **Promise** com um √∫nico objeto da classe **Postagem**. Este m√©todo √© diferente do **findAll()**, que retorna uma lista de postagens. Como o objetivo do m√©todo **findById(id: number)** √© buscar uma postagem espec√≠fica com base no **id**, ser√° necess√°rio apenas um objeto para armazenar a postagem encontrada.

Observe que o m√©todo **findById(id: number)** recebe um par√¢metro do tipo **number**, denominado **id**, que ser√° o identificador √∫nico da postagem a ser buscada. Esse **id** ser√° fornecido pela **Classe PostagemController**, que √© respons√°vel por chamar este m√©todo passando o **id** na requisi√ß√£o.

**Linha 19:** Criamos um objeto **postagem**, da classe **Postagem**, que ir√° armazenar o resultado da execu√ß√£o do m√©todo **findOne()**. Esse m√©todo √© chamado na Classe **postagemRepository** (injetado no servi√ßo) e tem como objetivo retornar **um √∫nico objeto** de acordo com os crit√©rios definidos. O m√©todo **findOne()** √© equivalente √† instru√ß√£o SQL:

```sql
SELECT * FROM tb_postagens WHERE id = id;
```

Na instru√ß√£o **return**, usamos o comando **await**, que faz a execu√ß√£o aguardar at√© que a **Promise** seja resolvida. Ou seja, o c√≥digo s√≥ prossegue depois que o objeto **Postagem** for encontrado e atribu√≠do ao objeto **postagem**. Esse comportamento garante que o resultado da busca seja resolvido antes de retornar para o controlador.

**Linhas 20 e 21:** Definimos a cl√°usula **where** no m√©todo **findOne()** para buscar a postagem com o **id** igual ao par√¢metro recebido. Ou seja, a consulta ir√° procurar a postagem que corresponde ao **id** informado.

**Linha 25:** Verificamos se o objeto **postagem** √© **nulo**. Caso o **id** informado n√£o corresponda a nenhuma postagem existente no banco de dados, o m√©todo **findOne()** retornar√° **null**, e, para evitar um erro na aplica√ß√£o, fazemos a verifica√ß√£o `!postagem`.

**Linha 26:** Se o objeto **postagem** for **nulo**, isso significa que n√£o foi encontrada nenhuma postagem com o **id** fornecido. Nesse caso, retornamos o status **HTTP 404 - Not Found** para indicar que o recurso solicitado n√£o foi encontrado.

**Linha 28:** Se o objeto **postagem** for encontrado, o m√©todo retorna o objeto **postagem** para a classe que acionou o m√©todo, ou seja, o **PostagemController**. Dessa forma, a postagem encontrada ser√° enviada como resposta da requisi√ß√£o.

3. Ap√≥s a implementa√ß√£o do M√©todo findById(id: number), observe que a linha 1 do c√≥digo, ser√° atualizada com alguns novos pacotes, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/vvdo6tP.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="4%"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/05_Listar_Postagens_por_Id/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemService</b></a></div>

<br />

<h2>üë£ Passo 02 - Criar o M√©todo findById na Classe PostagemController</h2>



Vamos implementar o M√©todo **findById(id: number)** na Classe PostagemController, que tem como objetivo executar o M√©todo com o mesmo nome na Classe de Servi√ßo PostagemService. 

1. Abra a Classe **PostagemController**, localizada na pasta **src/postagem/controllers**.

<div align="center"><img src="https://i.imgur.com/HaoDWSZ.png?1" title="source: imgur.com" /></div>

2. Insira o c√≥digo depois do M√©todo **findAll()**.

<div align="left"><img src="https://i.imgur.com/nCb1kSB.png" title="source: imgur.com" /></div>

**Vamos analisar o c√≥digo do M√©todo:**

**Linha 15:** O decorador **@Get('/:id')** √© respons√°vel por mapear as requisi√ß√µes **HTTP GET** enviadas para o endpoint **/postagens/:id**. O **:id** no endpoint √© um par√¢metro de rota, que representa o identificador da postagem a ser recuperada.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste endpoint ser√° composto pelo Endere√ßo do M√≥dulo (/postagens) + a vari√°vel de caminho indicada no decorador @Get (:id). Lembre-se que n√£o pode existir dois ou mais m√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 16:** O decorador **@HttpCode(HttpStatus.OK)** especifica que o m√©todo **findById()** ter√° como resposta HTTP padr√£o o status **200 OK**. Esse status √© retornado quando a opera√ß√£o √© bem-sucedida, ou seja, quando a postagem √© encontrada com o **id** fornecido. Se houver algum erro, o status da resposta depender√° do tipo de erro (por exemplo, **404 Not Found** se o id n√£o for encontrado).

**Linha 17:** O m√©todo **findById(@Param('id', ParseIntPipe) id: number)** √© respons√°vel por buscar uma postagem espec√≠fica no banco de dados. Ele √© ass√≠ncrono e retorna uma **Promise** resolvida pela **PostagemService**, que cont√©m o objeto de postagem encontrado. Esse m√©todo utiliza o decorador **@Param('id')** para capturar o valor do par√¢metro **id** enviado na URL da requisi√ß√£o.

O decorador **@Param('id')** extrai o valor do par√¢metro **id** da URL e o insere como argumento no m√©todo **findById()**. No caso do exemplo, a URL pode ser algo como **http://localhost:4000/postagens/1**, onde o n√∫mero **1** ser√° capturado e passado para o par√¢metro **id**. 

A Classe **ParseIntPipe** √© utilizada para garantir que o valor de **id** seja tratado como um n√∫mero inteiro.

**Exemplo:**

http://localhost:4000/postagens/1

Neste exemplo, o par√¢metro **id: number**, do M√©todo  **findById( @Param('id') id: number )**, receber√° o valor 1 (Id que ser√° procurado na tabela tb_postagens), que foi enviado na vari√°vel de caminho **/:id**.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

A instru√ß√£o **ParseIntPipe** converte o valor da vari√°vel de caminho id (inicialmente uma string) em um numero. Caso n√£o seja poss√≠vel converter (o usu√°rio digitou algo diferente de um numero), ele retorna uma mensagem de erro de valida√ß√£o, informando que estava esperando por um numero e recebeu uma string, al√©m do HTTP Status **BAD REQUEST ü°™ 400** (Erro no conte√∫do da  Requisi√ß√£o), como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/Zetp0hh.png" title="source: imgur.com" /></div>

**Linha 18:** Executa o m√©todo **findById( id: number )**, **M√©todo da Classe PostagemService**, que retornar√° **apenas um Objeto espec√≠fico da Classe Postagem**, persistido no Banco de dados, caso seja encontrado. 

Caso n√£o seja encontrado, o M√©todo **findById( id: number )** retornar√° o HTTP Status **NOT FOUND ü°™ 404** (N√£o Encontrado!). 

3. Ap√≥s a implementa√ß√£o do M√©todo **findById( @Param('id', ParseIntPipe) id: number )**, observe que a linha 1 do c√≥digo ser√° atualizada com alguns novos pacotes, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/2saqzVN.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Request Methods</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documenta√ß√£o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="4%"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/05_Listar_Postagens_por_Id/blogpessoal/src/postagem/controllers/postagem.controller.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemController</b></a></div>

<br />


<h2>üë£ Passo 03 - Executar o projeto</h2>



1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:


<div align="center"><img src="https://i.imgur.com/JgNkmDv.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, observe na imagem abaixo, na regi√£o indicada em amarelo, que o endpoint do tipo **GET**, apontando para o caminho (rota) **/postagens/:id**, foi disponibilizado.

<div align="center"><img src="https://i.imgur.com/Kxerj6U.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>



Agora vamos criar a Requisi√ß√£o para o M√©todo **findById( id: number )**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New HTTP Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/reMehb6.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/j7sXi9U.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Consultar postagem por ID** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (http://localhost:4000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem.
- A segunda parte do endere√ßo √© o **endpoint** configurado no decorador ***@Controller***, em nosso caso **/postagens**.  
- A terceira parte (**/1**) √© a vari√°vel de caminho (**@Param('id')**) **id**. Informe o id da postagem que voc√™ deseja procurar.

7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/xtgJbBk.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o quando encontra o Objeto no Banco de dados, al√©m de exibir os dados do Objeto no Corpo da Resposta, respeitando o crit√©rio informado na consulta (id 1), ela tamb√©m retorna um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

10. Caso o Objeto Postagem n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), marcado em laranja na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/5lCAhBv.png" title="source: imgur.com" /></div>

11. Caso o Projeto Nest n√£o esteja em Execu√ß√£o, o Insomnia retornar√° a mensagem abaixo:

<div align="center"><img src="https://i.imgur.com/Y2iNu9v.png" title="source: imgur.com" /></div>

12. Execute o seu Projeto e teste novamente!

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="4%"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/05_Listar_Postagens_por_Id" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
