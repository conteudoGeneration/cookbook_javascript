<h1>Projeto 02 - Blog Pessoal - Classe PostagemController e PostagemService - M√©todo Deletar</h1>

O que veremos por aqui:

1. Criar o m√©todo delete(id: number) na Classe PostagemService
2. Criar o m√©todo delete(id: number) na Classe PostagemController
3. Testar o M√©todo no Insomnia

<h2>1. O M√≥dulo Postagem</h2>

Nas etapas anteriores, constru√≠mos as Classes **PostagemService** e **PostagemController** e implementamos os M√©todos:

- **findAll()**  ü°™ Retorna todos os Objetos da Classe Postagem persistidos no Banco de dados.

- **findById(id: number)** ü°™ Retorna um Objeto espec√≠fico da Classe Postagem persistidos no Banco de dados. A Postagem √© identificada pelo atributo id. 

- **findByTitulo(titulo: string)** ü°™ Retorna  todos os Objetos da Classe Postagem persistidos no Banco de  dados, cujo atributo titulo contenha (em qualquer parte) a string enviada no par√¢metro titulo do M√©todo.

- **M√©todo create(postagem: Postagem)** ü°™ Persiste (salva) um novo Objeto da Classe Postagem no Banco de dados.

  **M√©todo update(postagem: Postagem)** ü°™ Atualiza um Objeto da Classe Postagem persistido no Banco de dados.

Vamos finalizar a constru√ß√£o das Classes **PostagemService** e  **PostagemController** implementando o M√©todo **delete(id: number)**, que apagar√° um Objeto da Classe Postagem persistido no Banco de dados, identificado pelo seu id.

<div align="center"><img src="https://i.imgur.com/EIm56Zk.png" title="source: imgur.com" width="75%"/></div>

<h2>üë£ Passo 01 - Criar o M√©todo delete(id: number) na Classe PostagemService</h2>

Vamos implementar o M√©todo **delete(id: number)** na Classe **PostagemService**, que retornar√° a confirma√ß√£o da exclus√£o de um Objeto espec√≠fico persistido no Banco de dados, identificado pelo **id** (Identificador √∫nico do Objeto). Tra√ßando um paralelo com o MySQL, seria o equivalente a instru√ß√£o: <code>DELETE FROM tb_postagens WHERE id = id;</code>.

1. Abra a Classe **Postagem Service**, localizada na pasta **src/postagem/services**.

<div align="center"><img src="https://i.imgur.com/K9AHCEo.png?1" title="source: imgur.com" /></div>

2. Insira o c√≥digo depois do M√©todo **update(postagem: Postagem)**.

<div align="left"><img src="https://i.imgur.com/WctBRp9.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 53:** Criamos o M√©todo Ass√≠ncrono (async), chamado **delete(id: number)**, que promete retornar uma **Promise** com um Objeto da Classe **DeleteResult**, que confirmar√° se o Objeto identificado pelo Atributo **id** foi apagado. 

Observe que o M√©todo **findById(id: number)** possui um par√¢metro do tipo **number**, chamado **id**. Esta vari√°vel receber√° o id da Postagem que voc√™ deseja apagar. O id ser√° enviado pelo M√©todo da **Classe PostagemController**. 

> **DeleteResult:** √â uma Classe do pacote TypeORM, que armazena o resultado da opera√ß√£o delete. Se o Objeto for Nulo, significa que a opera√ß√£o delete falhou. Se n√£o for nulo, significa que a opera√ß√£o delete deu certo e o Objeto foi apagado. 

**Linha 55:** Criamos um Objeto da Classe Postagem, chamado **buscaPostagem**, para receber o resultado da execu√ß√£o do M√©todo **findById(id: number)**, da Classe **PostagemService**. O objetivo √© checar se a Postagem que ser√° apagada existe, atrav√©s da busca pelo id.  

Observe que na chamada do M√©todo **findById(id: number)** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja encontrado), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

**Linha 57:** Verifica se **buscaPostagem √© nulo**. Caso o usu√°rio digite um id que n√£o exista, o Objeto buscaPostagem ser√° nulo, causando um erro na nossa aplica√ß√£o. Esta checagem evita este erro.

**Linha 58:** Se o Objeto **buscaPostagem for nulo**, ser√° retornado o HTTP Status **NOT FOUND ü°™ 404** (N√£o Encontrado!).

**Linha 60:** Retorna a execu√ß√£o do M√©todo **delete()**, da Interface **postagemRepository**. O resultado da execu√ß√£o do M√©todo **delete()**, ser√° um Objeto da Classe **DeleteResult** indicando se a exclus√£o do Objeto foi bem sucedida. 

Observe que na instru√ß√£o **return** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja apagado), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

3. Ap√≥s a implementa√ß√£o do M√©todo **delete(id: number)**, observe que a linha 3 do c√≥digo ser√° atualizada com um novo pacote, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/yvkOu5C.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/repository-api" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo delete()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.delightful.studio/classes/_query_builder_result_deleteresult_.deleteresult.html" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - DeleteResult</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/08_Deletar_Postagem/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemService</b></a></div>

<br />

<h2>üë£ Passo 02 - Criar o M√©todo delete(id: number) na Classe PostagemController</h2>

Vamos implementar o M√©todo **delete(@Param('id', ParseIntPipe) id: number) **na Classe **PostagemController**, com o objetivo de executar o M√©todo com o mesmo nome na Classe de Servi√ßo PostagemService. 

1. Abra a Classe **PostagemController**, localizada na pasta **src/postagem/controllers**.

<div align="center"><img src="https://i.imgur.com/HaoDWSZ.png?1" title="source: imgur.com" /></div>

2. Insira o c√≥digo depois do M√©todo **update(postagem: Postagem)**.

<div align="left"><img src="https://i.imgur.com/GR8F1KG.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 39:** O decorator **@Delete('/:id')** mapeia todas as Requisi√ß√µes **HTTP DELETE**, enviadas para um endere√ßo espec√≠fico **(/:id)**, chamado **endpoint**, dentro do M√≥dulo Postagem, para um M√©todo espec√≠fico que responder√° a Requisi√ß√£o, ou seja, ele indica que o M√©todo **delete(@Param('id', ParseIntPipe) id: number)**, responder√° a todas as requisi√ß√µes do tipo **HTTP DELETE**, enviadas no endere√ßo **http://localhost:4000/postagens/:id**, onde **:id** √© o id da Postagem que voc√™ deseja apagar.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="400px"/> | <div align="left">  **ATEN√á√ÉO:** *O Endere√ßo do endpoint do M√©todo delete(@Param('id', ParseIntPipe) id: number) ser√° igual ao endere√ßo do M√©todo findAll(), do M√©todo create(@Body() postagem: Postagem) e do M√©todo update(@Body() postagem: Postagem). Como os verbos HTTP dos quatros M√©todos s√£o diferentes, o mesmo endere√ßo pode ser utilizado.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 40:** O decorator **@HttpCode(HttpStatus.NO_CONTENT)** indica que o M√©todo **delete(@Param('id', ParseIntPipe) id: number) **, ter√° como **Resposta HTTP** padr√£o o HTTP Status **NO_CONTENT ü°™ 204** (o Objeto n√£o existe), ou seja, quando a Resposta da Requisi√ß√£o for positiva (o Objeto foi apagado no Banco de dados), ser√° retornado o **HTTP Status NO_CONTENT ü°™ 204**. Caso a Resposta seja negativa (algo deu errado), a Resposta depender√° do erro.

**Linha 41:** Criamos o M√©todo **delete(@Param('id', ParseIntPipe) id: number)**, que retornar√° o resultado do M√©todo **delete(id: number)** da Classe PostagemService, contendo a confirma√ß√£o se o Objeto da Classe Postagem foi ou n√£o apagado. 

**@Param('id'):** Este decorator **insere o valor enviado na vari√°vel de caminho id (:id)**, no par√¢metro do M√©todo **delete(@Param('id', ParseIntPipe) id: number)**;

**Exemplo:**

http://localhost:4000/postagens/1

Neste exemplo, o par√¢metro **id: number**, do M√©todo **delete(@Param('id', ParseIntPipe) id: number)**, receber√° o valor 1 (Id que ser√° apagado na tabela tb_postagens), que foi enviado na vari√°vel de caminho **/:id**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo delete(@Param('id', ParseIntPipe) id: number) devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**ParseIntPipe:** Converte o valor da vari√°vel de caminho id (inicialmente uma string) em um numero. Caso n√£o seja poss√≠vel converter (o usu√°rio digitou algo diferente de um numero), ele retorna uma mensagem de erro de valida√ß√£o,  informando que estava esperando por um numero e recebeu uma string, al√©m do HTTP Status **BAD REQUEST ü°™ 400** (Erro no conte√∫do da Requisi√ß√£o), como mostra a figura abaixo

<div align="center"><img src="https://i.imgur.com/Zetp0hh.png" title="source: imgur.com" /></div>

**Linha 42:** Executa o m√©todo **delete(id: number)**, da Classe **PostagemService**, que retornar√° a confirma√ß√£o da exclus√£o **do Objeto da Classe Postagem** persistido no Banco de dados, identificado pelo **id**. Caso o Objeto tenha sido apagado, ser√° retornado o Status **NO_CONTENT ü°™ 204** (o Objeto n√£o existe), caso contr√°rio, ser√° retornado o Status **NOT FOUND ü°™ 404** (N√£o Encontrado!)

3. Ap√≥s a implementa√ß√£o do M√©todo **delete(@Param('id', ParseIntPipe) id: number)**, observe que a linha 1 do c√≥digo ser√° atualizada com um novo pacote, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/6IOJbLA.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Request Methods</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documenta√ß√£o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />
<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/08_Deletar_Postagem/blogpessoal/src/postagem/controllers/postagem.controller.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemController</b></a></div>

<br />


<h2>üë£ Passo 03 - Executar o projeto</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/67GK3fX.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, observe na imagem abaixo, na regi√£o indicada em amarelo, que o endpoint do tipo **DELETE**, apontando para o caminho (rota) **/postagens/:id**, foi disponibilizado.

<div align="center"><img src="https://i.imgur.com/Q5ouySo.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>

Agora vamos criar a Requisi√ß√£o para o **delete(id: number)**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New Request**.

<div align="center"><img src="https://i.imgur.com/bFUVP3h.png" title="source: imgur.com" width="50%"/></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/rZ0KTLu.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**DELETE**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/qvMhoEx.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/97mwVRI.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Deletar Postagem** foi configurada da seguinte maneira:

   - A primeira parte do endere√ßo (http://localhost:4000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem (Exemplo: http://nomedaaplicacao.herokuapp.com).
   - A segunda parte do endere√ßo √© o **endpoint** configurado no Decorator ***@Controller***, em nosso caso **/postagens**.  
   - A terceira parte (**/3**) √© a vari√°vel de caminho (**@Param('id')**) **id**. Informe o id da postagem que voc√™ deseja apagar.
   
7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="60px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/MTjui2P.png" title="source: imgur.com" /></div>

9. Observe que a aplica√ß√£o retorna apenas um **HTTP Status 204 ü°™ NO_CONTENT** (indicado em verde na imagem acima). Este Status indica que a Requisi√ß√£o foi bem sucedida!, o Objeto foi apagado e o seu conte√∫do n√£o existe mais.

10. Caso o Objeto n√£o seja encontrado, a aplica√ß√£o retornar√° o **HTTP Status 404 ü°™ NOT FOUND** (N√£o encontrado), como mostra a figura abaixo (marcado em laranja).

<div align="center"><img src="https://i.imgur.com/yNFhqsJ.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/08_Deletar_Postagem" target="_blank"><b>C√≥digo fonte do projeto</b></a>


<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>