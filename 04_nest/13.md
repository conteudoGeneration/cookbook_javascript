
<h1>Projeto 02 - Blog Pessoal - Relacionamento entre Classes - Mﾃｳdulo Tema - Parte 02</h1>

O que veremos por aqui:

1. Criar a Classe TemaService
2. Atualizar a Classe Postagem Service
3. Criar a Classe TemaController
4. Registrar as Classes TemaService e TemaController na Classe Mﾃｳdulo TemaModule
5. Testar todos os Mﾃｩtodos no Insomnia
6. Atualizar as Requisiﾃｧﾃｵes Cadastrar e Atualizar Postagem

<h2>1. O Mﾃｳdulo Tema</h2>

Na etapa anterior, comeﾃｧamos a construir o Mﾃｳdulo Tema e criamos o Relacionamento entre as Classes Tema e Postagem. Veja o Diagrama de Classes abaixo: 

<div align="center"><img src="https://i.imgur.com/y7cmiCu.jpg" title="source: imgur.com" width="85%"/></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Atenﾃｧﾃ｣o aos Detalhes ao criar o Mﾃｳdulo Tema. Todas as Classes construﾃｭdas no Mﾃｳdulo Postagem deverﾃ｣o ser construﾃｭdas no Mﾃｳdulo Tema com as adaptaﾃｧﾃｵes pertinentes ao Mﾃｳdulo Tema.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left"> **DICA:** *Caso vocﾃｪ tenha alguma dﾃｺvida sobre como criar as Classes TemaService e TemaController, executar o projeto, entre outras, consulte a Documentaﾃｧﾃ｣o do Mﾃｳdulo Postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<h2>促 Passo 01 - Criar a Classe TemaService</h2>

Vamos criar a pasta **services**, dentro do nosso **Mﾃｳdulo Tema** (pasta tema):

1. Na pasta **tema**, clique com o botﾃ｣o direito do mouse e clique na opﾃｧﾃ｣o **New Folder** (Nova Pasta). 

2. O nome da pasta serﾃ｡ **services**, como mostra a figura abaixo. Apﾃｳs digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 
2. A estrutura de pasta do Mﾃｳdulo Tema, ficarﾃ｡ igual a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/rapYckD.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Atenﾃｧﾃ｣o aos Detalhes ao criar a pasta services. Um erro muito comum ﾃｩ criar a pasta services fora da pasta do Mﾃｳdulo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Na sequﾃｪncia, vamos criar a Classe de Serviﾃｧo **TemaService** que chamaremos de **tema.service.ts**

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Atenﾃｧﾃ｣o aos Detalhes ao criar Classe de Serviﾃｧo. Um erro muito comum ﾃｩ digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padrﾃｵes do Nest (nome_do_modulo.tipo_da_classe.ts) para evitar erros na sua aplicaﾃｧﾃ｣o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o botﾃ｣o direito do mouse sobre a **pasta services**, que foi criada dentro da pasta **tema**, como mostra a figura abaixo, e na sequﾃｪncia clique na opﾃｧﾃ｣o **New File** (Novo Arquivo).

2. O nome do arquivo serﾃ｡ **tema.service.ts**, como mostra a figura abaixo. Apﾃｳs digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/4WAVyH0.png" title="source: imgur.com" /></div>

Veja abaixo a implementaﾃｧﾃ｣o da Classe **TemaService**:

```typescript
import { HttpException, HttpStatus, Injectable } from "@nestjs/common";
import { InjectRepository } from "@nestjs/typeorm";
import { DeleteResult, ILike, Repository } from "typeorm";
import { Tema } from "../entities/tema.entity";

@Injectable()
export class TemaService {
    constructor(
        @InjectRepository(Tema)
        private temaRepository: Repository<Tema>
    ) { }

    async findAll(): Promise<Tema[]> {
        return await this.temaRepository.find({
            relations: {
                postagem: true
            }
        });
    }

    async findById(id: number): Promise<Tema> {

        let tema = await this.temaRepository.findOne({
            where: {
                id
            },
            relations: {
                postagem: true
            }
        });

        if (!tema)
            throw new HttpException('Tema nﾃ｣o encontrado!', HttpStatus.NOT_FOUND);

        return tema;
    }

    async findByDescricao(descricao: string): Promise<Tema[]> {
        return await this.temaRepository.find({
            where: {
                descricao: ILike(`%${descricao}%`)
            },
            relations: {
                postagem: true
            }
        })
    }

    async create(Tema: Tema): Promise<Tema> {
        return await this.temaRepository.save(Tema);
    }

    async update(tema: Tema): Promise<Tema> {

        let buscaTema = await this.findById(tema.id);

        if (!buscaTema || !tema.id)
            throw new HttpException('Tema nﾃ｣o encontrado!', HttpStatus.NOT_FOUND);

        return await this.temaRepository.save(tema);
    }

    async delete(id: number): Promise<DeleteResult> {

        let buscaTema = await this.findById(id);

        if (!buscaTema)
            throw new HttpException('Tema nﾃ｣o encontrado!', HttpStatus.NOT_FOUND);

        return await this.temaRepository.delete(id);

    }

}
```

Observe que nos Mﾃｩtodos de consulta: **findAll(), findById(id: number) e findByDescricao(descricao: string)** foram acrescentadas as linhas abaixo:

<div align="center"><img src="https://i.imgur.com/hJQDhWD.png" title="source: imgur.com" /></div>

O comando **relations** tem por objetivo exibir os Objetos da Classe Postagem que estﾃ｣o relacionados com os Objetos da Classe Tema, ou seja, ao executar os Mﾃｩtodos **findAll(), findById(id: number) e findByDescricao(descricao: string)**, alﾃｩm de **exibir os Objetos da Classe Tema persistidos no Banco de dados**, serﾃ｡ exibido tambﾃｩm **a lista de Objetos da Classe Postagem associados a cada Objeto da Classe da Tema**, semelhante ao exemplo abaixo:

```json
{
		"id": 1,
		"descricao": "Tema 01",
		"postagem": [
			{
				"id": 4,
                  "titulo": "Minha Postagem 04",
                  "texto": "Texto da Postagem 04",
                  "data": "2022-07-14T11:51:00.954Z"
			},
             {
				"id": 5,
                  "titulo": "Minha Postagem 05",
                  "texto": "Texto da Postagem 05",
                  "data": "2022-07-14T11:52:00.934Z"
			}
		]
	}
```

Observe que logo apﾃｳs o Tema 01, foi criado um array contendo as duas postagens associadas.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATENﾃﾃグ:** *Se o comando relations nﾃ｣o for adicionada nos 3 Mﾃｩtodos de consulta, ao testar os 3 Mﾃｩtodos GET no Insomnia o Relacionamento entre as Classes nﾃ｣o serﾃ｡ exibido.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database#relations" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Relacionamento entre Classes</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/relations" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>TypeORM - Relacionamentos</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/many-to-one-one-to-many-relations" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>TypeORM - Relacionamentos One to Many e Many to One</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/10_CRUD_Tema_Relacionado_com_Postagem/blogpessoal/src/tema/services/tema.service.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe TemaService</b></a></div>

<br />

<h2>促 Passo 02 - Atualizar a Classe PostagemService</h2>

Da mesma forma que adicionamos o comando **relations** na Classe TemaService, tambﾃｩm iremos adicionar na Classe PostagemService, nos 3 Mﾃｩtodos de consulta: **findAll(), findById(id: number) e findByTitulo(titulo: string)**. Na imagem abaixo, vemos com ficarﾃ｡ o comando **relations** na Classe Postagem:

<div align="center"><img src="https://i.imgur.com/bnEdgjr.png" title="source: imgur.com" /></div>

Desta forma, ao executar os Mﾃｩtodos de consulta:  **findAll(), findById(id: number) e findByTitulo(titulo: string)**, os Objetos da Classe Postagem passarﾃ｣o a exibir o Objeto da Classe Tema associado, semelhante ao exemplo abaixo:

```json
{
	"id": 4,
	"titulo": "Minha Postagem 04",
     "texto": "Texto da Postagem 04",
     "data": "2022-07-14T11:51:00.954Z",
	"tema": {
		"id": 1,
		"descricao": "Tema 01"
	}
}
```

Veja abaixo a implementaﾃｧﾃ｣o atualizada da Classe **PostagemService**:

```typescript
import { HttpException, HttpStatus, Injectable } from "@nestjs/common";
import { InjectRepository } from "@nestjs/typeorm";
import { DeleteResult, ILike, Repository } from "typeorm";
import { Postagem } from "../entities/postagem.entity";

@Injectable()
export class PostagemService {
    constructor(
        @InjectRepository(Postagem)
        private postagemRepository: Repository<Postagem>
    ) { }

    async findAll(): Promise<Postagem[]> {
        return await this.postagemRepository.find({
            relations:{
                tema: true
            }
        });
    }

    async findById(id: number): Promise<Postagem> {

        let postagem = await this.postagemRepository.findOne({
            where: {
                id
            },
            relations:{
                tema: true
            }
        });

        if (!postagem)
            throw new HttpException('Postagem nﾃ｣o encontrada!', HttpStatus.NOT_FOUND);

        return postagem;
    }

    async findByTitulo(titulo: string): Promise<Postagem[]> {
        return await this.postagemRepository.find({
            where:{
                titulo: ILike(`%${titulo}%`)
            },
            relations:{
                tema: true
            }
        })
    }

    async create(postagem: Postagem): Promise<Postagem> {
        return await this.postagemRepository.save(postagem);
    }

    async update(postagem: Postagem): Promise<Postagem> {
        
        let buscaPostagem = await this.findById(postagem.id);

        if (!buscaPostagem || !postagem.id)
            throw new HttpException('Postagem nﾃ｣o encontrada!', HttpStatus.NOT_FOUND);
        
        return await this.postagemRepository.save(postagem);
    }

    async delete(id: number): Promise<DeleteResult> {
        
        let buscaPostagem = await this.findById(id);

        if (!buscaPostagem)
            throw new HttpException('Postagem nﾃ｣o encontrada!', HttpStatus.NOT_FOUND);

        return await this.postagemRepository.delete(id);

    }

}
```

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/10_CRUD_Tema_Relacionado_com_Postagem/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe PostagemService</b></a></div>

<br />

<h2>促 Passo 03 - Criar a Classe TemaController</h2>

Vamos criar a pasta **controllers**, dentro do nosso **Mﾃｳdulo Tema** (pasta tema):

1. Na pasta **tema**, clique com o botﾃ｣o direito do mouse e clique na opﾃｧﾃ｣o **New Folder** (Nova Pasta). 

2. O nome da pasta serﾃ｡ **controllers**. Apﾃｳs digitar o nome da pasta, pressione a tecla **enter** do seu teclado para concluir. 
2. A estrutura de pastas do Mﾃｳdulo Tema, ficarﾃ｡ igual a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/ltNxgbd.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Atenﾃｧﾃ｣o aos Detalhes ao criar a pasta controllers. Um erro muito comum ﾃｩ criar a pasta controllers fora da pasta do Mﾃｳdulo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Na sequﾃｪncia, vamos criar a Classe Controladora **TemaController** que chamaremos de **tema.controller.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="200px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Atenﾃｧﾃ｣o aos Detalhes ao criar Classe Controladora. Um erro muito comum ﾃｩ digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padrﾃｵes do Nest (nome_do_modulo.tipo_da_classe.ts) para evitar erros na sua aplicaﾃｧﾃ｣o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o botﾃ｣o direito do mouse sobre a **pasta controllers**, que foi criada dentro da pasta **tema**, como mostra a figura abaixo, e clique na opﾃｧﾃ｣o **New File** (Novo Arquivo).

2. O nome do arquivo serﾃ｡ **tema.controller.ts**, como mostra a figura abaixo. Apﾃｳs digitar o nome do arquivo, pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/MZoRYi0.png" title="source: imgur.com" /></div>

Veja abaixo a implementaﾃｧﾃ｣o da Classe **TemaController**:

```typescript
import { Body, Controller, Delete, Get, HttpCode, HttpStatus, Param, ParseIntPipe, Post, Put } from "@nestjs/common";
import { Tema } from "../entities/tema.entity";
import { TemaService } from "../services/tema.service";

@Controller("/tema")
export class TemaController {
  constructor(private readonly temaService: TemaService) { }

  @Get()
  @HttpCode(HttpStatus.OK)
  findAll(): Promise<Tema[]> {
    return this.temaService.findAll();
  }

  @Get('/:id')
  @HttpCode(HttpStatus.OK)
  findById(@Param('id', ParseIntPipe) id: number): Promise<Tema> {
    return this.temaService.findById(id);
  }

  @Get('/descricao/:descricao')
  @HttpCode(HttpStatus.OK)
  findBydescricao(@Param('descricao') descricao: string): Promise<Tema[]> {
    return this.temaService.findByDescricao(descricao);
  }

  @Post()
  @HttpCode(HttpStatus.CREATED)
  create(@Body() Tema: Tema): Promise<Tema> {
    return this.temaService.create(Tema);
  }

  @Put()
  @HttpCode(HttpStatus.OK)
  update(@Body() Tema: Tema): Promise<Tema> {
    return this.temaService.update(Tema);
  }

  @Delete('/:id')
  @HttpCode(HttpStatus.NO_CONTENT)
  delete(@Param('id', ParseIntPipe) id: number){
    return this.temaService.delete(id);
  }

}
```
Observe que a implementaﾃｧﾃ｣o ﾃｩ semelhante a Classe **PostagemController**.

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Request Methods</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documentaﾃｧﾃ｣o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/10_CRUD_Tema_Relacionado_com_Postagem/blogpessoal/src/tema/controllers/tema.controller.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe TemaController</b></a></div>

<br />

<h2>促 Passo 04 - Registrar as Classes TemaService e TemaController na Classe TemaModule</h2>

Na sequﾃｪncia, vamos registrar as nossas Classes **TemaService** e **TemaController**, no Mﾃｳdulo **TemaModule**. Esse passo ﾃｩ fundamental para o correto funcionamento da nossa aplicaﾃｧﾃ｣o.

1. Abra a Classe **TemaModule**, localizada na pasta **tema**, conforme indicada na imagem abaixo:

   <div align="center"><img src="https://i.imgur.com/zmVpvSO.png" title="source: imgur.com" /></div>

2. Implemente as alteraﾃｧﾃｵes, indicadas pelas setas na imagem abaixo:

 <div align="left"><img src="https://i.imgur.com/0UFAStC.png?1" title="source: imgur.com" /></div>

Vamos analisar as alteraﾃｧﾃｵes no cﾃｳdigo:

**Linha 3:** Importamos a Classe **TemaController**, criada anteriormente. 

**Linha 5:** Importamos a Classe **TemaService**, criada anteriormente. 

**Linha 9:** No array **providers** vamos adicionar a **Classe TemaService** do **Mﾃｳdulo Tema**. Desta forma a Classe de Serviﾃｧo poderﾃ｡ ser injetada em outras Classes dentro do Mﾃｳdulo Tema.

**Linha 10:** No array **controllers** vamos adicionar a **Classe TemaController** do **Mﾃｳdulo Tema**. Desta forma os endpoints da Classe Controladora estrﾃ｣o disponﾃｭveis para receber Requisiﾃｧﾃｵes HTTP.

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documentaﾃｧﾃ｣o: <i>Mﾃｳdulos no Nest</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/10_CRUD_Tema_Relacionado_com_Postagem/blogpessoal/src/tema/tema.module.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe TemaModule</b></a></div>

<br />

<h2>促 Passo 05 - Executar o projeto</h2>

1. Verifique se vocﾃｪ estﾃ｡ dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/67GK3fX.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso nﾃ｣o esteja em execuﾃｧﾃ｣o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado serﾃ｡ semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/bbHtrGO.png" title="source: imgur.com" /></div>

4.Observe que todos os endpoints do **Mﾃｳdulo Tema** foram disponibilizados no endereﾃｧo **/temas** 

<br />

<h2>促 Passo 06 - Testar o Mﾃｳdulo Tema no Insomnia</h2>

Vamos criar no Insomnia todas as requisiﾃｧﾃｵes necessﾃ｡rias para testar os 6 Mﾃｩtodos do Mﾃｳdulo Tema. Veja abaixo como ficam as 6 Requisiﾃｧﾃｵes:

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="80px"/> | <div align="left"> **DICA:** *Caso vocﾃｪ tenha alguma dﾃｺvida sobre como criar as Requisiﾃｧﾃｵes, consulte a Documentaﾃｧﾃ｣o do Mﾃｳdulo Postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="150px"/> | <div align="left"> **ATENﾃﾃグ:** *Depois de criar o Relacionamento entre Classes, todas as Consultas dos Mﾃｳdulos Postagem e Tema trarﾃ｣o os Objetos associados, ou seja, Cada Objeto da Classe Postagem trarﾃ｡ o Objeto Tema associado e cada Objeto da Classe Tema trarﾃ｡ a lista de Objetos Postagem associados nos Mﾃｩtodos de Consulta.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<h3>6.1. Criando a Pasta Tema</h3>

Vamos criar dentro da **Collection Blog Pessoal** a **Pasta Tema**, que guardarﾃ｡ todas as requisiﾃｧﾃｵes do **Mﾃｳdulo Tema**.

1. Na **Collection Blog Pessoal**, clique no botﾃ｣o <img src="https://i.imgur.com/Igkx9ev.png" title="source: imgur.com" width="25px"/>. No menu que serﾃ｡ aberto, clique na opﾃｧﾃ｣o **New Folder**.

<div align="center"><img src="https://i.imgur.com/h6kg0do.png" title="source: imgur.com" /></div>

2. Na janela que serﾃ｡ aberta, informe o nome da pasta (**Tema**) e clique no botﾃ｣o **Create** para concluir. 

<div align="center"><img src="https://i.imgur.com/xyJtXrF.png" title="source: imgur.com" width="90%"/></div>

<h3>6.2.Criando a Requisiﾃｧﾃ｣o - Consultar todos os Temas</h3>

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Tema** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/apLv4rG.png" title="source: imgur.com" /></div>

2. Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Tema**.

3. Dﾃｪ um duplo clique sobre a nova requisiﾃｧﾃ｣o (**New Request**), informe o nome da requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/Uwgh8Sw.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**GET**) na requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/nrDJWG3.png" title="source: imgur.com" /></div>

<h3>6.3. Criando a  Requisiﾃｧﾃ｣o - Consultar Tema por ID</h3>

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Tema** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/apLv4rG.png" title="source: imgur.com" /></div>

2. Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Tema**.

3. Dﾃｪ um duplo clique sobre a nova requisiﾃｧﾃ｣o (**New Request**), informe o nome da requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/iAkR3Cl.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**GET**) na requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/QOUXs6E.png" title="source: imgur.com" /></div>

<h3>6.4. Criando a  Requisiﾃｧﾃ｣o - Consultar Temas por Descriﾃｧﾃ｣o</h3>

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Tema** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/apLv4rG.png" title="source: imgur.com" /></div>

2. Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Tema**.

3. Dﾃｪ um duplo clique sobre a nova requisiﾃｧﾃ｣o (**New Request**), informe o nome da requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/K4jPoIL.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**GET**) na requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/A12LxBL.png" title="source: imgur.com" /></div>

<h3>6.5. Criando a  Requisiﾃｧﾃ｣o - Cadastrar Tema</h3>

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Tema** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/apLv4rG.png" title="source: imgur.com" /></div>

2. Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Tema**.

3. Dﾃｪ um duplo clique sobre a nova requisiﾃｧﾃ｣o (**New Request**), informe o nome da requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/B0uWXMh.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**POST**) na requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/TLBY2tJ.png" title="source: imgur.com" /></div>

5. No item **Body**, vamos alterar para **JSON**, como mostra a imagem abaixo. Desta forma poderemos enviar os dados do Objeto Tema no Corpo da Requisiﾃｧﾃ｣o, no formato JSON.

<div align="center"><img src="https://i.imgur.com/PxOpzFd.png" title="source: imgur.com" /></div>

6. Observe que o item **Body** serﾃ｡ renomeado para **JSON**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/8hDNIbh.png" title="source: imgur.com" /></div>

7. Configure a requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/mdzzEPb.png" title="source: imgur.com" /></div>

8. Observe que na requisiﾃｧﾃ｣o do tipo POST o Corpo da requisiﾃｧﾃ｣o (Request Body), deve ser preenchido com um JSON contendo os dados do tema que vocﾃｪ deseja persistir no Banco de dados, exceto o **id** que serﾃ｡ gerado pelo Banco de dados.

<h3>6.6. Criando a  Requisiﾃｧﾃ｣o - Atualizar Tema</h3>

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Tema** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/apLv4rG.png" title="source: imgur.com" /></div>

2. Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Tema**.

3. Dﾃｪ um duplo clique sobre a nova requisiﾃｧﾃ｣o (**New Request**), informe o nome da requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/eIrSW40.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**PUT**) na requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/z6dWHYj.png" title="source: imgur.com" /></div>

5. No item **Body**, vamos alterar para **JSON**, como mostra a imagem abaixo. Desta forma poderemos enviar os dados do Objeto Tema no Corpo da Requisiﾃｧﾃ｣o, no formato JSON.

<div align="center"><img src="https://i.imgur.com/PxOpzFd.png" title="source: imgur.com" /></div>

6. Observe que o item **Body** serﾃ｡ renomeado para **JSON**, como mostra a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/99TdRMH.png" title="source: imgur.com" /></div>

7. Observe que na requisiﾃｧﾃ｣o do tipo PUT o Corpo da requisiﾃｧﾃ｣o (Request Body), deve ser preenchido com um JSON contendo os dados do tema que vocﾃｪ deseja persistir no Banco de dados, inclusive o **id** que serﾃ｡ utilizado para localizar o tema no Banco de dados.

<h3>6.7. Criando a  Requisiﾃｧﾃ｣o - Deletar Tema</h3>

1. Clique com o botﾃ｣o direito do mouse sobre a **Pasta Tema** para abrir o menu e clique na opﾃｧﾃ｣o **New Request**.

<div align="center"><img src="https://i.imgur.com/apLv4rG.png" title="source: imgur.com" /></div>

2. Serﾃ｡ criada uma nova Requisiﾃｧﾃ｣o (New Request) dentro da pasta **Tema**.

3. Dﾃｪ um duplo clique sobre a nova requisiﾃｧﾃ｣o (**New Request**), informe o nome da requisiﾃｧﾃ｣o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/IlQN46K.png" title="source: imgur.com" /></div>

4. Selecione o Mﾃｩtodo HTTP que serﾃ｡ utilizado (**DELETE**) na requisiﾃｧﾃ｣o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/qvMhoEx.png" title="source: imgur.com" /></div>

5. Configure a requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/RLkJdjn.png" title="source: imgur.com" /></div>

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | **ATENﾃﾃグ:** *Ao Deletar um Objeto da Classe Tema, todos os Objetos da Classe Postagem associados tambﾃｩm serﾃ｣o Deletados. O inverso nﾃ｣o ﾃｩ verdadeiro.* |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<br />

<h2>促 Passo 07 - Atualizar as Requisiﾃｧﾃｵes Cadastrar e Atualizar Postagem no Insomnia</h2>

Como habilitamos o Relacionamento entre as Classes, para Cadastrarmos e Alterarmos as Postagens vamos precisar atender alguns requisitos:

- Os Temas devem ser persistidos antes de criarmos as Postagens.
- Nas requisiﾃｧﾃｵes Cadastrar e Atualizar Postagem, o JSON enviado no Corpo da Requisiﾃｧﾃ｣o deve conter um Objeto da Classe Tema identificado apenas pelo **Atributo id**.

<h3>7.1. Atualizaﾃｧﾃ｣o - Requisiﾃｧﾃ｣o Cadastrar Postagem</h3>

Vamos alterar o Corpo da requisiﾃｧﾃ｣o (Body), da Requisiﾃｧﾃ｣o Cadastrar Postagem, do Recurso Postagem.	
1. No Insominia, abra a pasta Postagem e clique sobre a requisiﾃｧﾃ｣o Cadastrar Postagem.

2. Altere o corpo da requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/OSjDATi.png" title="source: imgur.com" /></div>

No item marcado em amarelo na imagem acima, observe que estﾃ｡ sendo passado dentro do JSON um **Objeto da Classe Tema** chamado **tema**, identificado apenas pelo **Atributo id**.

A Resposta da Requisiﾃｧﾃ｣o serﾃ｡ semelhante a figura abaixo:

<div align="center"><img src="https://i.imgur.com/R3Bm151.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | **ATENﾃﾃグ:** *O Objeto Tema deve ser persistido no Banco de dados antes de ser inserido no JSON da requisiﾃｧﾃ｣o Cadastrar Postagem.* |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<h3>7.2. Atualizaﾃｧﾃ｣o - Requisiﾃｧﾃ｣o Atualizar Postagem</h3>

Vamos alterar o Corpo da requisiﾃｧﾃ｣o (Body), da Requisiﾃｧﾃ｣o Atualizar Postagem, do Recurso Postagem.	
1. No Insominia, abra a pasta Postagem e clique sobre a requisiﾃｧﾃ｣o Atualizar Postagem.

2. Altere o corpo da requisiﾃｧﾃ｣o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/Mh12Vjv.png" title="source: imgur.com" /></div>

No item marcado em amarelo na imagem acima, observe que estﾃ｡ sendo passado dentro do JSON um **Objeto da Classe Tema** chamado **tema**, identificado apenas pelo **Atributo id**.

A Resposta da Requisiﾃｧﾃ｣o serﾃ｡ semelhante a figura abaixo:

<div align="center"><img src="https://i.imgur.com/WdjFmCz.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | **ATENﾃﾃグ:** *O Objeto Tema deve ser persistido no Banco de dados antes de ser inserido no JSON da requisiﾃｧﾃ｣o Atualizar Postagem.* |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<br />

| <img src="https://i.imgur.com/L338M2G.png" title="source: imgur.com" width="245px"/> | **DESAFIO:** *O que acontecerﾃ｡ se vocﾃｪ inserir no JSON das requisiﾃｧﾃｵes Cadastrar e Atualizar Postagem, no Objeto da Classe Tema, chamado tema, um id que nﾃ｣o existe? Insira no Atributo id, do Objeto tema, um id como 100, por exemplo, e veja o que acontece.* |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<br />

<h2>促 Passo 08 - Atualizar os Mﾃｩtodos create e update na Classe PostagemService</h2>

Atualmente os Mﾃｩtodos **create** e **update** estﾃ｣o implementados na **Classe PostagemService** conforme os trechos abaixo:

**Mﾃｩtodo Create:**

<div align="left"><img src="https://i.imgur.com/LarxRND.png" title="source: imgur.com" /></div>

**Mﾃｩtodo Update:**

<div align="left"><img src="https://i.imgur.com/ge3IjsS.png" title="source: imgur.com" /></div>

Se vocﾃｪ fez o desafio acima, percebeu que estas implementaﾃｧﾃｵes nﾃ｣o conseguem checar se o **Objeto da Classe Tema existe**, logo se vocﾃｪ inserir um Objeto da Classe Tema que nﾃ｣o existe (um Id que nﾃ｣o existe no Banco de dados), devido ao Relacionamento entre as Classes, serﾃ｡ retornado o **HTTP Status 500 - Internal Server Error**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/9QGwdj6.png" title="source: imgur.com" /></div>

Para evitar este erro, faremos alguns ajustes no **Mﾃｳdulo Postagem** e na **Classe PostagemService**.

<h3>8.1. Registrar o Mﾃｳdulo TemaModule e a Classe TemaService no Mﾃｳdulo PostagemModule</h3>

Para utilizarmos a Classe de Serviﾃｧo **TemaService** dentro do **Mﾃｳdulo Postagem**, para checarmos se o Tema existe antes de persistir a Postagem, vamos registrar o Mﾃｳdulo **TemaModule** e a Classe de Serviﾃｧo **TemaService** no Mﾃｳdulo **PostagemModule**, como mostra o cﾃｳdigo abaixo:

<div align="left"><img src="https://i.imgur.com/vWMLCVH.png?1" title="source: imgur.com" /></div>

Vamos analisar as alteraﾃｧﾃｵes no cﾃｳdigo:

**Linha 3:** Importamos a Classe **TemaService**, do Mﾃｳdulo **Tema**. 

**Linha 5:** Importamos a Classe **TemaModule**, do Mﾃｳdulo Tema. 

**Linha 10:** No array **imports** vamos adicionar a **Classe TemaModule** do **Mﾃｳdulo Tema**. Desta forma teremos acesso a todas as Classes do Mﾃｳdulo Tema.

**Linha 11:** No array **providers** vamos adicionar a **Classe TemaService** do **Mﾃｳdulo Tema**. Desta forma a Classe de Serviﾃｧo **TemaService** poderﾃ｡ ser injetada em outras Classes dentro do Mﾃｳdulo Postagem.

<h3>8.2. Inserir uma Injeﾃｧﾃ｣o de Dependﾃｪncia da Classe TemaService na Classe PostagemService</h3>

Na **Classe PostagemService**, vamos criar uma Injeﾃｧﾃ｣o de Dependﾃｪncia da Classe TemaService, como mostra o cﾃｳdigo abaixo:

<div align="left"><img src="https://i.imgur.com/ik0YR9H.png?1" /></div>

**Linha 4:** Importamos a Classe **TemaService**, do Mﾃｳdulo **Tema**.

**Linha 12:** Para termos acesso aos **Mﾃｩtodos da Classe TemaService**, inserimos uma Injeﾃｧﾃ｣o de Dependﾃｪncia desta Classe, logo abaixo da Injeﾃｧﾃ｣o de Dependﾃｪncia da Interface **PostagemRepository**.

<h3>8.3. Atualizar o Mﾃｩtodo create da Classe PostagemService</h3>

Agora estamos prontos para atualizar o Mﾃｩtodo **create()**, como mostra a figura abaixo:

<div align="left"><img src="https://i.imgur.com/XXALtXe.png?1" title="source: imgur.com" /></div>

Vamos analisar as alteraﾃｧﾃｵes realizadas no cﾃｳdigo do Mﾃｩtodo:

**Linha 53:** Checamos se o Objeto tema foi inserido dentro do Objeto postagem, ou seja, se ele nﾃ｣o ﾃｩ nulo. Caso **seja nulo**, a postagem ﾃｩ persistida sem o Tema (linha 64). Caso **nﾃ｣o seja nulo**, vamos checar se o tema existe.

**Linha 55:** Criamos um Objeto da **Classe Tema**, chamado **tema**, para receber o resultado da execuﾃｧﾃ｣o do Mﾃｩtodo **findById(id: number)**, da Classe **TemaService**. O objetivo ﾃｩ checar se o Tema que serﾃ｡ associado ao Objeto Postagem existe, atravﾃｩs da busca pelo id, que foi inserido no JSON, no Corpo da Requisiﾃｧﾃ｣o **POST**. Observe que na chamada do Mﾃｩtodo **findById(id: number)** foi inserido o comando **await** (aguarde), que na prﾃ｡tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja encontrado), antes de retornar a execuﾃｧﾃ｣o do Mﾃｩtodo e o valor resolvido para a Classe que acionou o Mﾃｩtodo.

**Linha 57:** Verifica se o Objeto **tema ﾃｩ nulo**, ou seja, nﾃ｣o foi encontrado. Caso o usuﾃ｡rio digite um id que nﾃ｣o existe, o Objeto tema serﾃ｡ nulo, causando o erro **HTTP Status 500 - Internal Server Error** na nossa aplicaﾃｧﾃ｣o. Atravﾃｩs desta checagem simples evitamos este erro e retornamos o HTTP Status **NOT FOUND ｡ｪ 404** (Nﾃ｣o Encontrado!), na linha 58. Desta forma, o Usuﾃ｡rio poderﾃ｡ selecionar um outro tema.

**Linha 60:** Se o Objeto **tema nﾃ｣o for nulo**, a postagem serﾃ｡ persistida no Banco de dados.

<h3>8.4. Atualizar o Mﾃｩtodo update da Classe PostagemService</h3>

Para finalizar, vamos atualizar o Mﾃｩtodo **update()**, como mostra a figura abaixo:

<div align="left"><img src="https://i.imgur.com/ksJLvRu.png?1" title="source: imgur.com" /></div>

Vamos analisar as alteraﾃｧﾃｵes realizadas no cﾃｳdigo do Mﾃｩtodo:

**Linha 74:** Checamos se o Objeto tema foi inserido dentro do Objeto postagem, ou seja, se ele nﾃ｣o ﾃｩ nulo. Caso **seja nulo**, a postagem ﾃｩ persistida sem o Tema (linha 85). Caso **nﾃ｣o seja nulo**, vamos checar se o tema existe.

**Linha 76:** Criamos um Objeto da **Classe Tema**, chamado **tema**, para receber o resultado da execuﾃｧﾃ｣o do Mﾃｩtodo **findById(id: number)**, da Classe **TemaService**. O objetivo ﾃｩ checar se o Tema que serﾃ｡ associado ao Objeto Postagem existe, atravﾃｩs da busca pelo id, que foi inserido no JSON, no Corpo da Requisiﾃｧﾃ｣o **POST**.  Observe que na chamada do Mﾃｩtodo **findById(id: number)** foi inserido o comando **await** (aguarde), que na prﾃ｡tica significa espere que a **Promise** seja resolvida (o Objeto Postagem seja encontrado), antes de retornar a execuﾃｧﾃ｣o do Mﾃｩtodo e o valor resolvido para a Classe que acionou o Mﾃｩtodo.

**Linha 78:** Verifica se o Objeto **tema ﾃｩ nulo**, ou seja, nﾃ｣o foi encontrado. Caso o usuﾃ｡rio digite um id que nﾃ｣o existe, o Objeto tema serﾃ｡ nulo, causando o erro **HTTP Status 500 - Internal Server Error** na nossa aplicaﾃｧﾃ｣o. Atravﾃｩs desta checagem simples evitamos este erro e retornamos o HTTP Status **NOT FOUND ｡ｪ 404** (Nﾃ｣o Encontrado!), na linha 79. Desta forma, o Usuﾃ｡rio poderﾃ｡ selecionar um outro tema.

**Linha 80:** Se o Objeto **tema nﾃ｣o for nulo**, a postagem serﾃ｡ persistida no Banco de dados.

Refaﾃｧa o Desafio no Insomnia e veja que o **HTTP Status 500 - Internal Server Error** foi substituﾃｭdo pelo **HTTP Status 404 - NOT_FOUND**, indicando que o id nﾃ｣o foi encontrado.

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/10_CRUD_Tema_Relacionado_com_Postagem/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>Cﾃｳdigo fonte da Classe PostagemService</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/10_CRUD_Tema_Relacionado_com_Postagem" target="_blank"><b>Cﾃｳdigo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
