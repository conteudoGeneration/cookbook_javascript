<h1>Projeto 02 - Blog Pessoal - M√≥dulo Usu√°rio - Parte 01</h1>

O que veremos por aqui:

1. Apresenta√ß√£o do M√≥dulo Usuario
2. Criar o M√≥dulo Usuario
3. Criar a Classe Entidade Usuario
4. Criar o Relacionamento entre as Classes Postagem e Usuario
5. Criar a Classe M√≥dulo UsuarioModule
6. Registrar a Classe Usuario na Classe UsuarioModule
7. Registrar a Classe Usuario e UsuarioModule na Classe AppModule

<h2>1. O M√≥dulo Usuario</h2>

Nesta etapa vamos come√ßar a construir o M√≥dulo Usuario, que ser√° utilizado para autenticar e autorizar o acesso ao Blog Pessoal, assim que a Seguran√ßa da aplica√ß√£o for habilitada. Veja o Diagrama de Classes abaixo: 

<div align="center"><img src="https://i.imgur.com/Snn7wCQ.jpg" title="source: imgur.com" width="75%"/></div>

A **Classe Usuario** servir√° de modelo para construir a tabela **tb_usuarios** (Entidade) dentro do nosso Banco de dados **db_blogpessoal**. Os campos (atributos) da tabela ser√£o os mesmos que est√£o definidos no Diagrama de Classes acima. Al√©m de construirmos a Classe Usuario, tamb√©m faremos o Relacionamento com a Classe Postagem, constru√≠da anteriormente.

Na pr√≥xima etapa vamos construir as Classes **UsuarioService e UsuarioController**, que ir√° nos auxiliar na intera√ß√£o com o Banco de dados e onde ser√£o implementados os 5 m√©todos descritos no Diagrama de Classes acima. Observe que diferente dos M√≥dulos Postagem e Tema, **n√£o iremos implementar os M√©todos Delete** (apagar usuario) e o **M√©todo de busca espec√≠fica** (findByNome, por xemplo).

Depois de criar a Classe Entidade Usuario, vamos executar o projeto Blog Pessoal. Ap√≥s a execu√ß√£o veremos que ser√° criado no Banco de dados **db_blogpessoal** a tabela **tb_usuarios**. Veja abaixo como ficar√° a estrutura da nossa tabela atrav√©s do **Diagrama de Entidade e Relacionamentos (DER)**:

<div align="center"><img src="https://i.imgur.com/4u4Kvy9.jpg" title="source: imgur.com" width="60%"/></div>

O Dicion√°rio de dados da nossa tabela tb_usuarios ser√° o seguinte:

| Atributo | Tipo de dado  | Descri√ß√£o           | Chave |
| -------- | ------------- | ------------------- | ----- |
| **id**   | bigint        | Identificador √∫nico | PK    |
| nome     | varchar(255)  | Nome do usu√°rio     |       |
| usuario  | varchar(255)  | E-mail do usu√°rio   |       |
| senha    | varchar(255)  | Senha do usu√°rio    |       |
| foto     | varchar(5000) | Foto do usu√°rio     |       |

Al√©m de construirmos a Classe Entidade Usuario, tamb√©m faremos o Relacionamento com a Classe Postagem, constru√≠da anteriormente. Veja como ficar√° o Relacionamento entre as 3 Classes, ap√≥s a implementa√ß√£o, no Diagrama de Classes abaixo:

<div align="center"><img src="https://i.imgur.com/BOcR7EZ.jpg" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar o M√≥dulo Usuario. Todas as Classes constru√≠das no M√≥dulo Postagem dever√£o ser constru√≠das no M√≥dulo Usuario com as adapta√ß√µes pertinentes ao M√≥dulo Usuario.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="80px"/> | <div align="left"> **DICA:** *Caso voc√™ tenha alguma d√∫vida sobre como criar o M√≥dulo, executar o projeto, entre outras, consulte a Documenta√ß√£o do M√≥dulo Postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>üë£ Passo 01 - Criar o M√≥dulo Usuario</h2>

Vamos criar o M√≥dulo Usuario:

1. Na pasta **src**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

2. Digite o nome da pasta (**usuario**) e pressione a tecla **enter** do seu teclado para concluir. 

Na sequ√™ncia, vamos criar a pasta **entities**, dentro do nosso **M√≥dulo Usuario** (pasta tema):

1. Na pasta **tema**, clique com o bot√£o direito do mouse e clique na op√ß√£o **New Folder** (Nova Pasta). 

2. Digite o nome da pasta (**entities**) e pressione a tecla **enter** do seu teclado para concluir. 
2. A estrutura de pastas do M√≥dulo Usuario, ficar√° igual a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/imBxaI8.png" title="source: imgur.com" /></div>

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="90px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar a Classe Entidade. Um erro muito comum √© criar a pasta entities fora da pasta do M√≥dulo (usuario).* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

<h2>üë£ Passo 02 - Criar a Classe UsuarioModule na pasta Usuario</h2>

Agora vamos criar a Classe **UsuarioModule** que chamaremos de **usuario.module.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe M√≥dulo. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta usuario**, que foi criada dentro da pasta **src** e clique na op√ß√£o **New File** (Novo Arquivo).

2. Digite o nome do arquivo (**usuario.module.ts**) e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/0fx5VH6.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 03 - Criar a Classe Entidade Usuario</h2>

Antes de implementarmos o c√≥digo da Classe **UsuarioModule**, vamos criar a Classe Entidade **Usuario** que chamaremos de **usuario.entity.ts**.

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar Classe Entidade. Um erro muito comum √© digitar o nome da Classe de forma incorreta. O nome da Classe deve estar dentro dos padr√µes do Nest para evitar erros na sua aplica√ß√£o.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

1. Clique com o bot√£o direito do mouse sobre a **pasta entities**, que foi criada dentro da pasta **usuario**, e clique na op√ß√£o **New File** (Novo Arquivo).

2. Digite o nome do arquivo (**usuario.entity.ts**) e pressione a tecla **enter** do seu teclado para concluir. 

<div align="center"><img src="https://i.imgur.com/q95CsKU.png" title="source: imgur.com" /></div>

Agora vamos criar o c√≥digo da Classe **Usuario**:

```typescript
import { IsEmail, IsNotEmpty, MinLength } from "class-validator"
import { Column, Entity, OneToMany, PrimaryGeneratedColumn } from "typeorm"
import { Postagem } from "../../postagem/entities/postagem.entity"

@Entity({name: "tb_usuarios"})
export class Usuario {

    @PrimaryGeneratedColumn() 
    public id: number

    @IsNotEmpty()
    @Column({length: 255, nullable: false}) 
    public nome: string

    @IsEmail()
    @Column({length: 255, nullable: false })
    public usuario: string

    @IsNotEmpty()
    @MinLength(8)
    @Column({length: 255, nullable: false }) 
    public senha: string

    @Column({length: 5000 }) 
    public foto: string

    @OneToMany(() => Postagem, (postagem) => postagem.usuario)
    postagem: Postagem[]

}
```

Vamos analisar os novos itens implementados na Classe Entidade Usuario em rela√ß√£o as Classes Postagem e Tema:

- No Atributo usuario, foi inserido o decorator **@IsEmail()**, que tem a fun√ß√£o validar se foi enviado um endere√ßo de e-mail.
- No Atributo senha, foi inserido o decorator  **@MinLength(8)**, que tem a fun√ß√£o validar se a senha do usuario possui no m√≠nimo 8 caracteres. 

Observe que o Relacionamento com a Classe Entidade **Postagem** tamb√©m foi habilitado. Provavelmente o VSCode deve estar exibindo a mensagem de erro: **Property 'usuario' does not exist on type 'Postagem'**. Este erro desaparecer√° assim que voc√™ criar o Relacionamento na Classe Postagem com a Classe Usuario.

Na tabela abaixo voc√™ confere a convers√£o de **Tipo de dados TypeScript ü°™ MySQL, de acordo com o que foi definido no Diagrama de Classes acima:**

| Atributo      | Tipo de dado TypeScript | Tipo de dado MySQL |
| ------------- | ----------------------- | ------------------ |
| **id**        | number                  | int              |
| nome          | string           | varchar(255)    |
| usuario       |string            | varchar(255)  |
| senha         |string            | varchar(255)   |
| foto          | string           | varchar(5000)    |

| <img src="https://i.imgur.com/RfjtOFi.png" title="source: imgur.com" width="100px"/> | <div align="left">**DICA:** *Para relembrar os tipos de dados do TypeScript, <a href="https://www.typescriptlang.org/docs/handbook/2/everyday-types.html">clique aqui</a> e explore os principais tipos de dados oferecidos pelo TypeScript.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database" target="_blank"><b>Documenta√ß√£o: <i>Banco de dados com Nest</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/entities" target="_blank"><b>Documenta√ß√£o: <i>Entidades no TypeORM</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/6knlnLz.png" title="source: imgur.com" width="30px"/> <a href="https://github.com/typestack/class-validator" target="_blank"><b>Documenta√ß√£o: <i>Pacote Validation</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/12_Recurso_Usuario/blogpessoal/src/usuario/entities/usuario.entity.ts" target="_blank"><b>C√≥digo fonte da Classe Usuario</b></a>
<br /></div>
<br />

<h2>üë£ Passo 04 - Criar a Rela√ß√£o ManytoOne na Classe Postagem</h2>

No passo anterior, foi habilitado o Relacionamento da Classe Usuario com a Classe Postagem. A Classe Usuario √© o lado 1:N da rela√ß√£o, ou seja, **Um Usuario pode ter muitas Postagens**. Neste passo, vamos habilitar o Relacionamento na Classe Postagem, que ser√° o lado N:1 da rela√ß√£o, ou seja, **Muitas Postagens podem ter apenas um Usuario**. Para criar a Rela√ß√£o vamos inserir depois do √∫ltimo atributo da Classe Postagem (tema), as linhas destacadas em amarelo na imagem abaixo:

<div align="left"><img src="https://i.imgur.com/DL6pnjl.png" title="source: imgur.com" /></div>

O Relacionamento com a Classe Usuario foi criado logo depois do Relacionamento com a Classe Tema. Veja abaixo o c√≥digo completo da **Classe Entidade Postagem**:

```typescript
import { IsNotEmpty } from "class-validator"
import { Column, Entity, ManyToOne, PrimaryGeneratedColumn, UpdateDateColumn } from "typeorm"
import { Tema } from "../../tema/entities/tema.entity"
import { Usuario } from "../../usuario/entities/usuario.entity"

@Entity({name: "tb_postagens"})
export class Postagem {

    @PrimaryGeneratedColumn()    
    id: number

    @IsNotEmpty()
    @Column({length: 100, nullable: false})
    titulo: string

    @IsNotEmpty()
    @Column({length: 1000, nullable: false})
    texto: string

    @UpdateDateColumn()
    data: Date
    
    @ManyToOne(() => Tema, (tema) => tema.postagem, {
        onDelete: "CASCADE"
    })
    tema: Tema

    @ManyToOne(() => Usuario, (usuario) => usuario.postagem, {
        onDelete: "CASCADE"
    })
    usuario: Usuario

}
```

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao criar o Relacionamento entre as Classes. Observe que ap√≥s habilitar o Relacionamento entre Classes, novas importa√ß√µes de Classes ser√£o necess√°rias nas primeiras linhas da Classe Postagem.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/techniques/database#relations" target="_blank"><b>Documenta√ß√£o: <i>Relacionamento entre Classes</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/relations" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - Relacionamentos</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/many-to-one-one-to-many-relations" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - Relacionamentos One to Many e Many to One</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/12_Recurso_Usuario/blogpessoal/src/postagem/entities/postagem.entity.ts" target="_blank"><b>C√≥digo fonte da Classe Postagem</b></a>
<br /></div>
<br />

<h2>üë£ Passo 05 - Registrar a Classe Usuario na Classe UsuarioModule</h2>

Vamos implementar o c√≥digo da Classe **UsuarioModule** e registrar a Classe **Usuario**. Veja abaixo a implementa√ß√£o da Classe **UsuarioModule**:

```typescript
import { Module } from '@nestjs/common';
import { TypeOrmModule } from '@nestjs/typeorm';
import { Usuario } from './entities/usuario.entity';

@Module({
  imports: [TypeOrmModule.forFeature([Usuario])], 
  providers: [],
  controllers: [],
  exports: [],
})
export class UsuarioModule {}
```

Observe que o c√≥digo √© bem semelhante ao c√≥digo das Classes M√≥dulo **PostagemModule** e **TemaModule**.

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ATEN√á√ÉO:** *Se uma Classe for importada com o caminho absoluto (src/entities/usuario.entity.ts), os testes da aplica√ß√£o com o framework Jest n√£o ser√£o executados. O Jest n√£o reconhece caminho absoluto, apenas caminho relativo (./entities/usuario.entity.ts)* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<br />

<h2>üë£ Passo 06 - Registrar as Classes Usuario e UsuarioModule na Classe AppModule</h2>

Para finalizar, vamos registrar a Classe **Postagem** no M√≥dulo principal da  aplica√ß√£o, a Classe **AppModule**. 

1. Abra a Classe **AppModule**, localizada na pasta **src**, conforme indicada na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/Ga6jcLb.png" title="source: imgur.com" /></div>

2. Implemente as altera√ß√µes, indicadas pelas setas na imagem abaixo:

<div align="left"><img src="https://i.imgur.com/bibB7J0.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo:

**Linha 20:** No array **entities** vamos inserir todas as **Classes Entidades** do m√≥dulo. Insira no array a Classe **Usuario**, ao lado da Classe Tema, separadas por uma virgula.

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *Se uma Classe Entidade n√£o for registrada no M√≥dulo principal da aplica√ß√£o (AppModule), a tabela associada a Entidade n√£o ser√° criada no Banco de dados.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

**Linha 26:** No array **imports** vamos inserir o M√≥dulo **UsuarioModule**.  Insira no array a Classe **UsuarioModule**, abaixo da Classe AuthModule, separadas por uma virgula.

| <img src="https://i.imgur.com/oScAYGc.png" title="source: imgur.com" width="80px"/> | <div align="left"> **ATEN√á√ÉO:** *Se um M√≥dulo n√£o for registrado no M√≥dulo principal da aplica√ß√£o (AppModule), n√£o ser√° poss√≠vel criar um Relacionamento com as Classes Entidades deste M√≥dulo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | <div align="left"> **ALERTA DE BSM:** *Mantenha a Aten√ß√£o aos Detalhes ao Registrar novas Classes no M√≥dulo App. Observe que ap√≥s registrar uma nova Classe, novas importa√ß√µes de Classes ser√£o necess√°rias nas primeiras linhas da Classe AppModule.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />


<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/modules" target="_blank"><b>Documenta√ß√£o: <i>M√≥dulos no Nest</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/bQGvf3h.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/12_Recurso_Usuario/blogpessoal/src/app.module.ts" target="_blank"><b>C√≥digo fonte da Classe AppModule</b></a></div>

<br />

<h2>üë£ Passo 07 - Executar o projeto</h2>

1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/67GK3fX.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, o resultado ser√° semelhante ao da figura abaixo:

<div align="center"><img src="https://i.imgur.com/Fy3P1Wp.png" title="source: imgur.com" /></div>

4.Aparentemente n√£o mudou nada, mas vamos checar o Banco de dados...

<br />

<h2>üë£ Passo 08 - Checar o Banco de dados</h2>

1. Abra o **MySQL Workbench** 
1. Verifique se a tabela **tb_usuarios** foi criada no Banco de dados **db_blogpessoal**, como mostra a figura abaixo:

   <div align="center"><img src="https://i.imgur.com/bUS1F44.png" title="source: imgur.com" /></div>
1. Verifique se a **Chave Estrangeira (usuarioId)** foi criada na Tabela **tb_postagens**, no Banco de dados **db_blogpessoal**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/0Dvmvew.png" title="source: imgur.com" /></div>

<br /><br />
    

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
