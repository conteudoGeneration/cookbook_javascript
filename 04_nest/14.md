<h1>Introdu√ß√£o a Seguran√ßa de Software</h1>

<div align="center"><img src="https://i.imgur.com/iyARgVe.png" title="source: imgur.com" /></div>

No mundo da tecnologia, em especial na Internet, nenhuma aplica√ß√£o em execu√ß√£o na Nuvem pode ficar sem algum tipo de Seguran√ßa habilitada, devido aos in√∫meros perigos existentes no mundo virtual como ataques Hackers, invas√µes de Servidores, roubos de dados, entre outros. No ecossistema NestJS, a seguran√ßa da aplica√ß√£o √© implementada com a ajuda das **Bibliotecas Passport e JWT**.

Antes de falarmos sobre as 2 Bibliotecas, vamos entender alguns conceitos fundamentais sobre Seguran√ßa da aplica√ß√£o no Protocolo HTTP:

<h2>1. Seguran√ßa da Aplica√ß√£o</h2>

Neste t√≥pico vamos estudar 3 conceitos importantes da Seguran√ßa da Informa√ß√£o:

<h3>1.1. Autentica√ß√£o</h3>

<div align="center"><img src="https://i.imgur.com/oljXzoD.png" title="source: imgur.com" /></div>

√â o primeiro processo da Seguran√ßa da Informa√ß√£o, popularmente conhecido como Login no sistema. √â o momento em que o usu√°rio informa o seu usu√°rio de acesso (e-mail) e a sua senha, e o sistema far√° a checagem se estas informa√ß√µes est√£o corretas.


<h3>1.2. Token</h3>

<div align="center"><img src="https://i.imgur.com/ETfJYCg.png?1" title="source: imgur.com" /></div>

Parte integrante da Autentica√ß√£o, um **Token** √© um dado, que aparentemente n√£o tem significado ou uso por si s√≥, mas quando combinado com o sistema de seguran√ßa correto, torna-se parte vital da seguran√ßa de seu aplicativo. A autentica√ß√£o baseada em token funciona garantindo que cada solicita√ß√£o a um servidor seja acompanhada por um token assinado que o servidor verifica quanto √† autenticidade e s√≥ ent√£o responde √† solicita√ß√£o. Um bom exemplo do uso do Token, s√£o os aplicativos de Internet Banking, que em todas as transa√ß√µes financeiras um novo token √© gerado para autorizar a opera√ß√£o.

A imagem acima, ilustra a valida√ß√£o de um **Token Bearer**, que verifica se o Token de Autoriza√ß√£o do Usu√°rio enviado no cabe√ßalho da requisi√ß√£o, est√° correto. Como ele est√° dentro do padr√£o Bearer, o sistema libera o envio da requisi√ß√£o para a Classe Controladora espec√≠fica. A valida√ß√£o de um Token funciona como um funil, onde s√≥ passam as Requisi√ß√µes que possuem Tokens v√°lidos.

<h3>1.3. Autoriza√ß√£o</h3>

<div align="center"><img src="https://i.imgur.com/kazNpLz.png" title="source: imgur.com" /></div>

√â o segundo processo da Seguran√ßa da Informa√ß√£o, popularmente conhecido como Direitos de acesso (Roles) no sistema. √â o momento em que o sistema checar√° o que o usu√°rio pode e n√£o pode fazer no sistema, ou seja, as suas permiss√µes dentro do sistema (Quais m√≥dulos e endpoints podem ser acessados?).

<br />

<h2>3. Conhecendo o HTTP Authentication</h2>

O **IETF (*Internet Engineering Task Force*)** tem como miss√£o identificar e propor solu√ß√µes para as quest√µes/problemas relacionados √† utiliza√ß√£o da Internet, al√©m de propor a padroniza√ß√£o das tecnologias e protocolos envolvidos. O mesmo define a estrutura de autentica√ß√£o HTTP que pode ser usada por um servidor para definir uma solicita√ß√£o do cliente. Numa autentica√ß√£o por token, o servidor responde ao cliente com uma mensagem do tipo **HTTP Status 401 (N√£o autorizado)** e fornece informa√ß√µes de como autorizar com um cabe√ßalho de resposta **WWW-Authenticate** contendo ao menos uma solicita√ß√£o. Um cliente que deseja autenticar-se com um servidor pode fazer isso incluindo um campo de cabe√ßalho de solicita√ß√£o **WWW-Authenticate** com as credenciais. No Diagrama de Sequ√™ncia abaixo pode se observar este relacionamento:

<div align="center"><img src="https://i.imgur.com/skGtKqr.png" title="source: imgur.com" /></div>

No caso de uma **Autoriza√ß√£o ‚ÄúBearer‚Äù** (como a mostra a figura acima), a troca deve acontecer por meio de uma conex√£o HTTP (TLS) para ser segura. Se um servidor recebe credenciais v√°lidas, mas que n√£o s√£o adequadas para ter acesso a um determinado recurso, o servidor responder√° com o c√≥digo de status **HTTP Status 403 (Proibido!)**.  Ao contr√°rio de **HTTP Status 401(N√£o autorizado)**, a autentica√ß√£o √© imposs√≠vel para este usu√°rio. 

Essa Autoriza√ß√£o √© enviada no **Cabe√ßalho da Requisi√ß√£o HTTP**, na chave **Authorization**, atrav√©s de uma string que cont√©m as credenciais para autenticar um agente usu√°rio em um servidor.  Aqui o tipo √© novamente necess√°rio, seguido pelas credenciais, que podem ser codificadas ou criptografadas dependendo do esquema de autentica√ß√£o usado. No caso acima foi utilizado o **Esquema de Autentica√ß√£o Bearer** que ser√° explicado na sequencia.

> **Cabe√ßalho HTTP:** Os cabe√ßalhos HTTP permitem que o cliente e o servidor passem  informa√ß√µes adicionais com a solicita√ß√£o ou a resposta HTTP. Um  cabe√ßalho de solicita√ß√£o √© composto por seu nome *case-insensitive* (n√£o diferencia letras mai√∫sculas e min√∫sculas), chamada de **key** (chave), seguido por dois pontos ':' e pelo seu valor (sem quebras de linha), chamado **value** (valor). 
>
> **WWW-Authenticate:** Define o m√©todo de autentica√ß√£o que deve ser utilizado para conseguir acesso ao recurso.
>
> **Authorization:** Cont√©m as credenciais (token) para autenticar um User-Agent com o servidor.

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status/401" target="_blank"><b>Documenta√ß√£o: HTTP Status Code 401 - Unauthorized</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status/403" target="_blank"><b>Documenta√ß√£o: HTTP Status Code 403 - Forbidden</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers/WWW-Authenticate" target="_blank"><b>Documenta√ß√£o: Cabe√ßalho HTTP WWW-Authenticate</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers/Authorization" target="_blank"><b>Documenta√ß√£o: Cabe√ßalho de Requisi√ß√£o HTTP Authorization</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers" target="_blank"><b>Documenta√ß√£o: Cabe√ßalhos HTTP</b></a></div>

<br />

<h3>3.1. Esquema Bearer</h3>

A estrutura geral de autentica√ß√£o HTTP √© usado por v√°rios esquemas de autentica√ß√£o. Os esquemas podem divergir na for√ßa da seguran√ßa e na disponibilidade do software cliente ou servidor. Os esquemas mais comuns de autentica√ß√£o s√£o o **Basic** e o **Bearer**, mas existem outros esquemas oferecidos por servi√ßos de hospedagem, como AWS, Google ou Microsoft.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left">**ATEN√á√ÉO:** Para melhor compreens√£o no momento, vamos focar apenas no entendimento do formato Bearer, que √© considerado um dos esquemas mais populares. Vale mencionar que para aprender os demais √© necess√°rio tempo e muita dedica√ß√£o.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

No projeto Blog Pessoal utilizaremos o esquema **Bearer**, que segundo a sua documenta√ß√£o, consiste em um conjunto de caracteres codificados posicionados ap√≥s a palavra **"Bearer "** (o espa√ßo em branco ap√≥s a palavra Bearer √© obrigat√≥rio), formando um ***Authorization Token*** para ser passado ao sistema. No trecho de c√≥digo abaixo, podemos ver um exemplo simples de um **Token Bearer**:

```json
Bearer eyJhbGciOiJIUnR5cCI6IkpXVCJ9.eyJ1c2VybiciIaWNjY5MJleHAiOjE2NTk3NTU3NjB9.xvlBIb2TSofhpImWKrdqfgwCVf7w
```

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | ALERTA DE BSM: Mantenha a Aten√ß√£o aos Detalhes ao escrever o Token no formato Bearer, o mesmo √© representado pela palavra "*Bearer* " com um espa√ßo em branco na frente + um conjunto de caracteres codificados, que s√£o fornecidos ao se autenticar no sistema. |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Headers/Authorization" target="_blank"><b>Documenta√ß√£o: Cabe√ßalho de Requisi√ß√£o HTTP Authorization</b></a></div>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://www.rfc-editor.org/rfc/rfc6750.html" target="_blank"><b>Documenta√ß√£o: Esquema de autentica√ß√£o Bearer</b></a></div>

<br />

<h3>3.2. Token JWT</h3>

Existem diversas maneiras de gerar um **Token Bearer**, no Projeto Blog Pessoal, utilizaremos o padr√£o **JWT - JSON WEB Token**. O JWT √© um padr√£o de mercado, muito popular e amplamente utilizado, que define como transmitir e armazenar objetos JSON de forma compacta e segura entre diferentes aplica√ß√µes. Os dados nele contidos  podem ser validados a qualquer momento pois o token √© assinado digitalmente. Na imagem abaixo, vemos a estrutura de um Token JWT:

<div align="center"><img src="https://i.imgur.com/QHRc3WG.png" title="source: imgur.com" /></div>

Um Token JWT √© formado por tr√™s se√ß√µes: **Header, Payload e Signature.**

O **Header** (cabe√ßalho do token) √© um objeto JSON que define as informa√ß√µes sobre o tipo do token (typ), nesse caso JWT, e o algor√≠tmo de criptografia usado em sua  assinatura (alg), normalmente **HMAC SHA256**. No c√≥digo abaixo, vemos um exemplo de cabe√ßalho:

```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

O **Payload** √© um objeto JSON que cont√©m as **claims** (informa√ß√µes) da entidade tratada, normalmente o usu√°rio autenticado.

Essas claims podem ser de 3 tipos:

| Tipo         | Descri√ß√£o                                                    |
| ------------ | ------------------------------------------------------------ |
| **Reserved** | S√£o os atributos n√£o obrigat√≥rios (mas recomendados), que s√£o usados na valida√ß√£o do token pelos protocolos de seguran√ßa das APIs. |
| **Public**   | S√£o os atributos que usamos em nossas aplica√ß√µes. Normalmente armazenamos as informa√ß√µes do usu√°rio autenticado na aplica√ß√£o. |
| **Private**  | S√£o os atributos definidos especialmente para compartilhar informa√ß√µes entre aplica√ß√µes, tais como nome do usu√°rio e os direitos de acesso (**Roles:** admin, usuario comum, entre outros). |

Na tabela abaixo, temos a lista com as principais Claims utilizadas no payload:

| Claim                | Descri√ß√£o                                                    |
| -------------------- | ------------------------------------------------------------ |
| **sub (subject)**    | Entidade √† quem o token pertence.                            |
| **iss (issuer)**     | Emissor do token.                                            |
| **exp (expiration)** | Timestamp de quando o token ir√° expirar.                     |
| **iat (issued at)**  | Timestamp de quando o token foi criado.                      |
| **aud (audience)**   | Destinat√°rio do token, representa a aplica√ß√£o que ir√° us√°-lo. |

<br />

No c√≥digo abaixo, vemos um exemplo de payload:

```json
{
  "username": "admin@email.com.br",
  "sub": "blogpessoal",
  "iat": 1659642790,
  "exp": 1659729190
}
```

Observe que a Claim iat e a Claim exp s√£o inseridas pelo gerador do Token.

<br />

| <img src="https://i.imgur.com/vVDBDG0.png" title="source: imgur.com" width="100px"/> | ALERTA DE BSM: Mantenha a Aten√ß√£o aos Detalhes ao criar o Token JWT. Por seguran√ßa recomenda-se n√£o armazenar informa√ß√µes confidenciais ou sens√≠veis no payload do token como a senha, por exemplo. |
| ------------------------------------------------------------ | :----------------------------------------------------------- |

<br />

A **Signature** (assinatura) √© a concatena√ß√£o da string gerada a partir da **codifica√ß√£o do Header** atrav√©s do algoritmo de codifica√ß√£o **base64UrlEncode**, um **ponto final** (.), a string gerada a partir da **codifica√ß√£o do Payload** atrav√©s do algoritmo de codifica√ß√£o **base64UrlEncode**, um **ponto final** (.) e a chave secreta (**Secret Key**). A String Gerada a partir desta concatena√ß√£o, ser√° criptografada com o algoritmo **HMAC SHA256**, gerando a assinatura do Token JWT. Veja o modelo de gera√ß√£o da assinatura na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/pwEUNz3.png" title="source: imgur.com" /></div>

Observe que as sess√µes s√£o concatenadas com um ponto (.), separando as sess√µes, seguindo a estrutura: **header.payload.secretKey**.

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="100px"/> | <div align="left">**ATEN√á√ÉO:** N√£o se preocupe em aprender como cada um destes algoritmos de codifica√ß√£o e criptografia funcionam internamente. O mais importante agora √© saber que eles existem e como us√°-los.</div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

Na imagem abaixo vemos o Token JWT da primeira imagem deste t√≥pico decodificado:

<div align="center"><img src="https://i.imgur.com/fj6noCZ.png" title="source: imgur.com" /></div>

Para decodificar o Token JWT, foi utilizada a **Ferramenta Debugger do JWT**. Com ela √© poss√≠vel **decodificar o cabe√ßalho e o payload**, como mostra a figura abaixo:

<div align="center"><img src="https://i.imgur.com/nNY51bK.png" title="source: imgur.com" /></div>

Para decodificar o Token JWT, insira a parte **encriptada do Token** (tudo menos a palavra Bearer) no campo **Encoded**, marque o item **secret base64 encoded** e conferir o resultado no campo **Decoded**. A  Assinatura n√£o √© t√£o simples de decodificar, porqu√™ al√©m de usar o Algoritmo **HMAC SHA256**, tamb√©m seria necess√°rio criar um algoritmo espec√≠fico para checagem de Chave P√∫blica e Chave Privada, al√©m de conhecer a Secret Key previamente.

<br />

<div align="left"><img src="https://i.imgur.com/WeNdbPo.png" title="source: imgur.com" width="35px"/> <a href="https://jwt.io/introduction" target="_blank"><b>Documenta√ß√£o: JWT - JSON WEB Token</b></a></div>

<div align="left"><img src="https://i.imgur.com/WeNdbPo.png" title="source: imgur.com" width="35px"/> <a href="https://jwt.io/#debugger-io" target="_blank"><b>Ferramenta: JWT Debugger</b></a></div>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://pt.wikipedia.org/wiki/Base64" target="_blank"><b>Artigo: Modelo Base 64</b></a> - Como funciona o modelo de Codifica√ß√£o Base 64.</div>

<div align="left"><img src="https://i.imgur.com/RlHVydi.png" title="source: imgur.com" width="25px"/> <a href="https://pt.wikipedia.org/wiki/HMAC" target="_blank"><b>Artigo: Modelo HMAC SHA256</b></a> - Como funciona o modelo de Codifica√ß√£o HMAC SHA256.</div>

<br />

O Token gerado ser√° enviado no Header (cabe√ßalho) de todas as Requisi√ß√µes com endpoints protegidos. Sem o token n√£o for enviado, todos os endpoints protegidos por autentica√ß√£o retornar√£o como resposta o status acesso negado (**UNAUTHORIZED ü°™ 401**).

<br />

<h2>3. Biblioteca Passport</h2>

Analisando nosso projeto Blog Pessoal podemos perceber que nossa API, at√© este momento, n√£o possui nenhuma seguran√ßa, ou seja, qualquer pessoa acessa todos os endpoints de todos os m√≥dulos livremente. A maioria das aplica√ß√µes que s√£o desenvolvidas cont√©m informa√ß√µes vitais como: dados pessoais, dados banc√°rios, entre outros, e portanto precisamos garantir que a aplica√ß√£o e estes dados estejam devidamente protegidos de acesso n√£o autorizados. Para criar esta prote√ß√£o nos aplicativos NestJS podemos contar com a Biblioteca JavaScript chamada **Passport**.

<div align="left"><img src="https://i.imgur.com/51OZ5ug.png" title="source: imgur.com" width="30px"/> <a href="https://www.passportjs.org/docs/" target="_blank"><b>Documenta√ß√£o: Passport</b></a></div>

O Passport √© uma biblioteca NodeJS muito popular, amplamente utilizada para fins de **autentica√ß√£o dos usu√°rios**. O Passport oferece mais de 500 estrat√©gias de autentica√ß√£o diferentes, que v√£o desde ao tradicional usuario e senha, at√© autentica√ß√£o com o Google. Essas estrat√©gias basicamente implementam diferentes mecanismos de autentica√ß√£o. 

Nos aplicativos Web modernos, a autentica√ß√£o pode ser realizada de v√°rias maneiras. A autentica√ß√£o mais comum √© o famoso login, onde os usu√°rios fornecem um nome de usu√°rio (geralmente o e-mail) e uma senha. As redes sociais, criaram o chamado **login √∫nico (SSO - Single sign-on)** usando o Facebook, o Google, o Github, entre outros como meio de autentica√ß√£o. Inova√ß√µes recentes permitem que as pessoas fa√ßam login usando impress√£o digital ou reconhecimento facial. 

> **SSO:** Single sign-on √© um esquema de autentica√ß√£o que permite que um usu√°rio efetue login com um √∫nico usu√°rio e senha em qualquer um dos v√°rios sistemas de software relacionados, mas independentes.

Para oferecer suporte a aplicativos da Web, bem como aplicativos m√≥veis e desktop nativos, a l√≥gica do lado do servidor pode ser exposta como uma API que √© invocada por aplicativos executados em um desktop, dispositivo m√≥vel ou em um navegador executando JavaScript do lado do cliente. O acesso √†s API's √© protegido por credenciais baseadas em token, normalmente emitidos durante o processo de autentica√ß√£o. O Passport fornece uma estrutura flex√≠vel que permite que um aplicativo fa√ßa uso de qualquer um desses mecanismos de autentica√ß√£o. 

<h3>2.1 Modelos de Autentica√ß√£o</h3>

Existem v√°rios modelos de autentica√ß√£o, na imagem abaixo, vemos os modelos mais utilizados:

<div align="center"><img src="https://i.imgur.com/tSIBSoU.png?1" title="source: imgur.com" /></div>

**Autentica√ß√£o baseada em sess√£o:** Utiliza cookies do navegador junto com ‚Äúsess√µes‚Äù de back-end para gerenciar usu√°rios conectados e desconectados.     

**Autentica√ß√£o Baseada em Token:** √â um m√©todo de autentica√ß√£o sem estado em que um token √© armazenado no navegador (geralmente no **Local Storage**). Esse token possui informa√ß√µes sobre um usu√°rio e s√≥ pode ser decodificado usando um segredo armazenado no servidor (chave ou secret key). 

> **Local Storage:** Amplamente utilizado por pessoas desenvolvedoras Front-end, √© um mecanismo b√°sico para se guardar  informa√ß√µes do usu√°rio no Navegador. O Local Storage mant√©m o dado gravado mesmo se o Navegador for fechado e reaberto. Isso facilita criar alguns comportamentos de interface durante o uso do usu√°rio.

**Autentica√ß√£o OAuth:** √â um m√©todo de autentica√ß√£o moderno em que um aplicativo usa outro aplicativo para autenticar seus pr√≥prios usu√°rios. Em outras palavras, trata-se de autentica√ß√£o em que um servi√ßo existente (como o Google) lida com a autentica√ß√£o e o armazenamento de usu√°rios enquanto seu aplicativo aproveita esse fluxo para autenticar usu√°rios.

No projeto Blog Pessoal vamos utilizar a **Autentica√ß√£o Baseada em Token JWT**.

<h3>2.2 Strategies (Estrat√©gias)</h3>

As estrat√©gias s√£o respons√°veis por autenticar as solicita√ß√µes, o que elas realizam atrav√©s da implementa√ß√£o de um mecanismo de autentica√ß√£o. Os mecanismos de autentica√ß√£o definem como codificar uma credencial, como uma senha, em uma Requisi√ß√£o. Eles tamb√©m especificam o procedimento necess√°rio para verificar a autenticidade dessa credencial. Se a credencial for verificada com sucesso, a solicita√ß√£o ser√° autenticada. 

No projeto Blog Pessoal usaremos as **Estrat√©gias Local e JWT**. 

<h4>2.2.1 Local Strategy</h4>

A **Estrat√©gia Local faz a autentica√ß√£o atrav√©s de um usu√°rio e uma senha**. 

O Passport Local executa uma s√©rie de etapas conforme abaixo:

1. Autentica√ß√£o de um usu√°rio por suas credenciais. Essas credenciais podem ser nome de usu√°rio/senha e/ou tokens JWT ou qualquer outro token de identidade.
2. Gerencia o estado de autentica√ß√£o emitindo um token JWT. 
3. Anexa as informa√ß√µes sobre o usu√°rio no Corpo da Resposta.

Para facilitar as coisas, o m√≥dulo @nestjs/passport envolve todo o padr√£o de uso do Passport em constru√ß√µes familiares do NestJS. Isso torna menos complexo o processo de implementa√ß√£o da autentica√ß√£o NestJS Passport. Na imagem abaixo, vemos o processo de Autentica√ß√£o do Passport Local Strategy:

<div align="center"><img src="https://i.imgur.com/8SSnS1z.png" title="source: imgur.com" /></div>

1. O Usu√°rio informa as suas credenciais (usu√°rio e senha);
2. Uma **Requisi√ß√£o HTTP do tipo POST** √© gerada e as credenciais s√£o enviadas no Corpo da Requisi√ß√£o, no formato JSON;
3. O Passport recebe a Requisi√ß√£o e verifica se possui os **atributos username e password**. Os nomes dos atributos podem ser personalizados na implementa√ß√£o do Local Strategy. Caso encontre os 2 atributos, ambos ser√£o enviados para o **Passport Local Strategy**.
4. O **Passport Local Strategy** √© o autenticador da  aplica√ß√£o, ou seja, ele far√° a pesquisa no Banco de dados para **validar o usu√°rio e a senha**, al√©m de **gerar o payload**, que ser√° enviado para a Classe **JwtService**, da Biblioteca **JWT** do Nest, respons√°vel por gerar o **Token JWT** do Usu√°rio.
5. A Classe **JwtService** recebe o payload, gera o Token JWT e envia para o **Passport Local Strategy** anexar o Token no Corpo da Resposta da Requisi√ß√£o de Login. 
6. Ap√≥s a valida√ß√£o, caso as credenciais sejam validadas, o **Passport Local Strategy** gera uma Resposta para a Requisi√ß√£o confirmando a autentica√ß√£o (**OK ü°™ 200**) e envia no Corpo da Resposta o **TokenJWT** que foi gerado.
7. Caso o usuario ou a senha n√£o sejam validados, o **Passport Local Strategy** gera uma Resposta para a Requisi√ß√£o negando o acesso ao usu√°rio (**UNAUTHORIZED ü°™ 401**).

<br />

<div align="left"><img src="https://i.imgur.com/51OZ5ug.png" title="source: imgur.com" width="30px"/> <a href="https://www.passportjs.org/packages/passport-local/" target="_blank"><b>Documenta√ß√£o: Passport Local Strategy</b></a></div>

<br />

<h4>2.2.2 JWT Strategy</h4>

A Estrat√©gia JWT **faz a valida√ß√£o do Token JWT** nos endpoints protegidos da aplica√ß√£o. Um ponto muito importante que deve ser destacado em rela√ß√£o ao Passport JWT √© que **ele n√£o cria o Token JWT**, ele apenas valida o Token. Observe no t√≥pico anterior, que o Token JWT ser√° criado pela **Biblioteca JWT do Nest**, durante o processo de autentica√ß√£o local. 

O Passport JWT executa uma s√©rie de etapas conforme abaixo:

1. O Passport JWT extrai o Token do Cabe√ßalho da Requisi√ß√£o.    
1. Valida o Token
1. Autoriza o usu√°rio a visitar o recurso fornecido.

Para facilitar as coisas, o m√≥dulo @nestjs/passport envolve todo o padr√£o de uso do Passport em constru√ß√µes familiares do NestJS. Isso torna menos complexo o processo de implementa√ß√£o do NestJS Passport. Na imagem abaixo, vemos um resumo do Processo de valida√ß√£o do Token ao Criar uma nova Postagem no projeto Blog Pessoal:

<div align="center"><img src="https://i.imgur.com/fMXynSo.png" title="source: imgur.com" /></div>

1. O Usu√°rio cria uma nova postagem;
2. Uma **Requisi√ß√£o HTTP do tipo POST** √© gerada e os dados da postagem s√£o enviadas no Corpo da Requisi√ß√£o, no formato JSON. Al√©m disso, o **Token JWT recebido na autentica√ß√£o √© enviado no Cabe√ßalho da Requisi√ß√£o, na chave Authorization**;
3. O Passport recebe a Requisi√ß√£o e verifica se a **chave Authorization foi preenchida** com um **Token Bearer**. Caso encontre o Token, o mesmo ser√° enviado para o **Passport JWT Strategy**.
4. O **Passport JWT Strategy** recebe o **Token JWT** do Usu√°rio e inicia o processo de valida√ß√£o.
5. Ap√≥s a valida√ß√£o, o **Passport JWT Strategy** autoriza o acesso ao endpoint caso o **Token seja validado** e o **endpoint /postagens** gera uma Resposta para a Requisi√ß√£o confirmando a cria√ß√£o da Nova Postagem (**CREATED ü°™ 201**) e envia no Corpo da Resposta os dados da Nova Postagem.
6. Caso o Token JWT n√£o seja validado,  o **Passport JWT Strategy** gera uma Resposta para a Requisi√ß√£o negando o acesso ao usu√°rio (**UNAUTHORIZED ü°™ 401**).

Nos pr√≥ximos t√≥picos vamos implementar o Passport...

<br />

<div align="left"><img src="https://i.imgur.com/51OZ5ug.png" title="source: imgur.com" width="30px"/> <a href="https://www.passportjs.org/packages/passport-jwt/" target="_blank"><b>Documenta√ß√£o: Passport JWT Strategy</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
