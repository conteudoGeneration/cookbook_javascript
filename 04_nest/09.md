<h1>Projeto 02 - Blog Pessoal - Classe PostagemController e PostagemService - M√©todo Consultar Postagens por T√≠tulo</h1>



O que veremos por aqui:

1. Criar o M√©todo findByTitulo(titulo: string) na Classe PostagemService
2. Criar o M√©todo findByTitulo(titulo: string) na Classe PostagemController
3. Testar o M√©todo no Insomnia

<br />

<h2>1. O M√≥dulo Postagem</h2>



Nas etapas anteriores, come√ßamos a construir as Classes **PostagemService** e **PostagemController** e implementamos os M√©todos:

- **findAll()**  ü°™ Retorna todos os Objetos da Classe Postagem persistidos no Banco de dados.
- **findById(id: number)** ü°™ Retorna um Objeto espec√≠fico da Classe Postagem persistidos no Banco de dados. A Postagem √© identificada pelo atributo id.

Vamos continuar a constru√ß√£o das nossas duas Classes implementando o **M√©todo findByTitulo( titulo: string )**, que retornar√° todos os Objetos da Classe Postagem persistidos no Banco  de dados, cujo atributo titulo contenha a string enviada no par√¢metro  titulo do M√©todo.

<div align="center"><img src="https://i.imgur.com/EIm56Zk.png" title="source: imgur.com" width="75%"/></div>

<br />

<h2>üë£ Passo 01 - Criar o M√©todo findByTitulo na Classe PostagemService</h2>



Vamos implementar o M√©todo **findByTitulo(titulo: string)** na Classe PostagemService. Tra√ßando um paralelo com o SQL, seria o equivalente a instru√ß√£o: <code>SELECT * FROM tb_postagens where titulo like "%titulo%";</code>.

1. Abra a Classe **Postagem Service**, localizada na pasta **src/postagem/services**.

<div align="center"><img src="https://i.imgur.com/K9AHCEo.png?1" title="source: imgur.com" /></div>

2. Insira o c√≥digo abaixo depois do M√©todo **findById(id: number)**.

<div align="left"><img src="https://i.imgur.com/QsCHVaU.png" title="source: imgur.com" /></div>

**Vamos analisar o c√≥digo do M√©todo:**

**Linha 31:** Criamos o M√©todo Ass√≠ncrono (async), chamado **findByTitulo(titulo: string)**, que promete retornar uma **Promise** contendo um array de Objetos da Classe Postagem. Como o **M√©todo findByTitulo(titulo: string)** lista todos os Objetos que atendam ao crit√©rio da consulta, assim como no M√©todo findAll(), ser√° necess√°rio criar um array para armazenar todos os Objetos encontrados.

Observe que o M√©todo **findByTitulo(titulo: string)** possui um par√¢metro do tipo **string**, chamado **titulo**. Esta vari√°vel receber√° a string que voc√™ deseja procurar no Atributo titulo de todas as Postagens persistidas. Qualquer postagem, cujo **Atributo titulo contenha a string enviada no par√¢metro** (seja no inicio, no meio ou no fim), ser√° adicionada no array resultante do M√©todo. O par√¢metro titulo ser√° enviado pelo M√©todo da **Classe PostagemController**. 

**Linha 32:** Retorna a execu√ß√£o do M√©todo **find()**, da Interface **postagemRepository**. O resultado da execu√ß√£o do M√©todo **find()**, ser√° um array de Objetos Postagem, selecionados de acordo com o(s) crit√©rio(s) da clausula where.  

Observe que na instru√ß√£o **return** foi inserido o comando **await** (aguarde), que na pr√°tica significa espere que a **Promise** seja resolvida (os Objetos Postagem sejam encontrados), antes de retornar a execu√ß√£o do M√©todo e o valor resolvido para a Classe que acionou o M√©todo.

**Linhas 33 e 34:** Declaramos a clausula where, com o crit√©rio **ILike(`%${titulo}%`)**, ou seja, **localize a Postagem cujo atributo titulo contenha, em qualquer parte, a string titulo enviada no par√¢metro do M√©todo findByTitulo(titulo: string)**. 

Observe que na consulta acima, utilizamos a clausula **ILike** ao inv√©s do tradicional **Like**. A diferen√ßa entre eles √© a seguinte:

| Clausula  | Descri√ß√£o                                                    |
| --------- | ------------------------------------------------------------ |
| **Like**  | O Like n√£o ignora se a string est√° em mai√∫sculo ou min√∫sculo, ou seja, ele faz uma busca literal. <br />**Exemplo:** GENERATION √© diferente de generation. |
| **ILike** | O ILike (Insensitive Like), ignora se a string foi digitada com letras mai√∫sculas ou min√∫sculas. Na pr√°tica o que o ILike faz √© converter a string digitada e o conte√∫do do Atributo para letras mai√∫sculas e s√≥ ent√£o ele compara as duas.<br />**Exemplo:** GENERATION √© igual a generation. |

3. Ap√≥s a implementa√ß√£o do M√©todo **findByTitulo(titulo: string)**, observe que a linha 3 do c√≥digo, ser√° atualizada com um novo pacote, como mostra a figura abaixo (indicado em amarelo):

<div align="left"><img src="https://i.imgur.com/bVyzoEE.png" title="source: imgur.com" /></div>

<br />

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores Customizados - Classe de Servi√ßo</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/OtnA0bd.png" title="source: imgur.com" width="25px"/> <a href="https://typeorm.io/find-options" target="_blank"><b>Documenta√ß√£o: <i>TypeORM - M√©todo de busca find()</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank"><b>Documenta√ß√£o: Promise</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/async_function" target="_blank"><b>Documenta√ß√£o: Async</b></a></div>

<div align="left"><img src="https://i.imgur.com/r9lrbPG.png" title="source: imgur.com" width="30px"/> <a href="https://developer.mozilla.org/pt-BR/docs/Web/JavaScript/Reference/Operators/await" target="_blank"><b>Documenta√ß√£o: Await</b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/06_Listar_Postagens_por_Titulo/blogpessoal/src/postagem/services/postagem.service.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemService</b></a>
<br /><br />


<br />

<h2>üë£ Passo 02 - Criar o M√©todo findByTitulo na Classe PostagemController</h2>



Vamos implementar o M√©todo **findByTitulo(titulo: string)** na Classe PostagemController, que tem como objetivo executar o M√©todo com o mesmo nome na Classe de Servi√ßo PostagemService. 

1. Abra a Classe **PostagemController**, localizada na pasta **src/postagem/controllers**.

<div align="center"><img src="https://i.imgur.com/HaoDWSZ.png?1" title="source: imgur.com" /></div>

2. Insira o c√≥digo depois do M√©todo **findById(id: number)**.

<div align="left"><img src="https://i.imgur.com/cMiocf7.png" title="source: imgur.com" /></div>

Vamos analisar o c√≥digo do M√©todo:

**Linha 21:** O decorador **@Get('/titulo/:titulo')** mapeia todas as Requisi√ß√µes **HTTP GET**, enviadas para um endere√ßo espec√≠fico **(/titulo/:titulo)**, chamado **endpoint**, dentro do M√≥dulo Postagem, para um M√©todo espec√≠fico que responder√° a Requisi√ß√£o. Em outras palavras, ele indica que o M√©todo **findByTitulo(@Param('titulo') titulo: string)**, responder√° a todas as requisi√ß√µes do tipo **HTTP GET**, enviadas no endere√ßo **http://localhost:4000/postagens/titulo/:titulo**, onde **:titulo** √© o crit√©rio de busca da consulta.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="120px"/> | <div align="left"> **ATEN√á√ÉO:** *O Endere√ßo deste Endpoint ser√° composto pelo Endere√ßo do M√≥dulo (/postagens) + a vari√°vel de caminho indicada no decorador @Get (/titulo/:titulo). Lembre-se que n√£o pode existir dois ou mais m√©todos do tipo GET com o mesmo endere√ßo.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 22:** O decorador **@HttpCode(HttpStatus.OK)** indica que o M√©todo **findByTitulo(@Param('titulo') titulo: string)**, ter√° como **Resposta HTTP** padr√£o **OK ü°™ 200**, ou seja, quando a Resposta da Requisi√ß√£o for positiva, o status  **OK ü°™ 200**. Caso a Resposta seja negativa (algo deu errado), a Resposta depender√° do erro.

**Linha 23:** Criamos o M√©todo **findByTitulo(@Param('titulo') titulo: string)**, que promete retornar uma **Promise** (que ser√° enviada pela Classe PostagemService), com um array de Objetos da Classe Postagem. 

**@Param('titulo'):** Este decorador **insere o valor enviado na vari√°vel de caminho titulo (:titulo)**, no par√¢metro do M√©todo **findByTitulo(@Param('titulo') titulo: string)**;

**Exemplo:**

http://localhost:4000/postagens/titulo/palavra

Neste exemplo, o par√¢metro **titulo: string**, do M√©todo **findByTitulo(@Param('titulo') titulo: string)**, receber√° a string **"palavra"** (par√¢metro que ser√° enviado para a Classe PostagemService), que foi inserido na vari√°vel de caminho **/:titulo**.

<br />

| <img src="https://i.imgur.com/hOgWvSc.png" title="source: imgur.com" width="60px"/> | <div align="left"> **ATEN√á√ÉO:** *Por quest√µes de boas pr√°ticas e legibilidade do c√≥digo, a Vari√°vel de Caminho e o Par√¢metro do M√©todo devem possuir o mesmo nome.* </div> |
| ------------------------------------------------------------ | ------------------------------------------------------------ |

<br />

**Linha 24:** Executa o m√©todo **findByTitulo(titulo: string)**, **M√©todo da Classe PostagemService**, que retornar√° **um array de Objetos da Classe Postagem**, persistido no Banco de dados, segundo o crit√©rio de busca implementado. 

<br />

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Methods" target="_blank"><b>Documenta√ß√£o: HTTP Request Methods</b></a></div>

<div align="left"><img src="https://i.imgur.com/cDPH4tl.png" title="source: imgur.com" width="30px"/> <a href=" https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Status" target="_blank"><b>Documenta√ß√£o: HTTP Status Code</b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/controllers" target="_blank"><b>Documenta√ß√£o: <i>Classe Controladora</i></b></a></div>

<div align="left"><img src="https://i.imgur.com/O6PILGE.png" title="source: imgur.com" width="25px"/> <a href="https://docs.nestjs.com/providers" target="_blank"><b>Documenta√ß√£o: <i>Provedores - Classe Controladora</i></b></a></div>

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="35px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/blob/06_Listar_Postagens_por_Titulo/blogpessoal/src/postagem/controllers/postagem.controller.ts" target="_blank"><b>C√≥digo fonte da Classe PostagemController</b></a></div>

<br />


<h2>üë£ Passo 03 - Executar o projeto</h2>



1. Verifique se voc√™ est√° dentro da pasta do projeto, como mostra a figura abaixo:


<div align="center"><img src="https://i.imgur.com/JgNkmDv.png" title="source: imgur.com" /></div>

2. Digite o comando ***npm run start:dev***, para compilar e executar o nosso projeto **blogpessoal**, caso n√£o esteja em execu√ß√£o. 

```bash
npm run start:dev
```

3. Se tudo deu certo, observe na imagem abaixo, na regi√£o indicada em amarelo, que o endpoint do tipo **GET**, apontando para o caminho (rota) **/postagens/titulo/:titulo**, foi disponibilizado.

<div align="center"><img src="https://i.imgur.com/wCYbWmf.png" title="source: imgur.com" /></div>

<br />

<h2>üë£ Passo 04 - Testar no Insomnia</h2>



Agora vamos criar a Requisi√ß√£o para o M√©todo **findByTitulo(titulo: string)**:

1. Clique com o bot√£o direito do mouse sobre a **Pasta Postagem** para abrir o menu e clique na op√ß√£o **New HTTP Request**.

<div align="center"><img src="https://i.imgur.com/KvRI8b2.png" title="source: imgur.com" /></div>

2. Ser√° criada uma nova Requisi√ß√£o (New Request) dentro da pasta **Postagem**.

   <div align="center"><img src="https://i.imgur.com/CA70WQn.png" title="source: imgur.com" /></div>

3. D√™ um duplo clique sobre a nova requisi√ß√£o (**New Request**), informe o nome da requisi√ß√£o (indicado na imagem abaixo na cor amarela) e pressione a tecla **enter** do seu teclado.

<div align="center"><img src="https://i.imgur.com/nWwhslQ.png" title="source: imgur.com" /></div>

4. Selecione o M√©todo HTTP que ser√° utilizado (**GET**) na requisi√ß√£o, indicado na imagem abaixo na cor verde. 

<div align="center"><img src="https://i.imgur.com/mWPpKHD.png" title="source: imgur.com" /></div>

5. Configure a requisi√ß√£o conforme a imagem abaixo:

<div align="center"><img src="https://i.imgur.com/1Ukklwq.png" title="source: imgur.com" /></div>

6. No item marcado em amarelo na imagem acima, informe o endere√ßo (endpoint) da Requisi√ß√£o. A requisi√ß√£o **Consultar Postagem por Titulo** foi configurada da seguinte maneira:

- A primeira parte do endere√ßo (http://localhost:4000) √© o endere√ßo do nosso servidor local. Quando a aplica√ß√£o estiver na nuvem, ele ser√° substitu√≠do pelo endere√ßo da nuvem.
- A segunda parte do endere√ßo √© o **endpoint** configurado no decorador ***@Controller***, em nosso caso **/postagens**.  
- A terceira parte (**/titulo/postagem**), titulo √© apenas um indicativo do conte√∫do da vari√°vel que dever√° ser preenchida. A palavra ***postagem*** √© o conte√∫do da vari√°vel de caminho (**@Param('titulo')**) **titulo**. Informe o texto que voc√™ deseja pesquisar no atributo titulo das postagens.

7. Para testar a requisi√ß√£o, com a aplica√ß√£o rodando, clique no bot√£o <img src="https://i.imgur.com/sy0V8Nx.png" title="source: imgur.com" width="50px"/>.

8. O resultado da requisi√ß√£o voc√™ confere na imagem abaixo:

<div align="center"><img src="https://i.imgur.com/iUfzYul.png" title="source: imgur.com" width="75%"/></div>

9. Observe que a aplica√ß√£o al√©m de exibir os dados de todos os Objetos da Classe Postagem persistidos no Banco de dados, no Corpo da Resposta, respeitando o crit√©rio informado na consulta (palavra postagem), ela tamb√©m retornar√° um **HTTP Status 200 ü°™ OK** (indicado em verde na imagem acima), informando que a Requisi√ß√£o foi bem sucedida!

<br />

<div align="left"><img src="https://i.imgur.com/JACNZiR.png" title="source: imgur.com" width="25px"/> <a href="https://github.com/rafaelq80/backend_blogpessoal_nest/tree/06_Listar_Postagens_por_Titulo" target="_blank"><b>C√≥digo fonte do projeto</b></a></div>

<br /><br />

<div align="left"><a href="README.md"><img src="https://i.imgur.com/XMgF3gl.png" title="source: imgur.com" width="3%"/>Voltar</a></div>
